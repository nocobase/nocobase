---
pkg: '@nocobase/plugin-workflow-webhook'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# Webhook

## מבוא

טריגר Webhook מספק כתובת URL שניתן לקרוא לה על ידי מערכות צד שלישי באמצעות בקשות HTTP. כאשר מתרחש אירוע צד שלישי, הוא שולח בקשת HTTP לכתובת URL זו כדי להפעיל את ביצוע תהליך העבודה. הוא מתאים להתראות שיזמו מערכות חיצוניות, כגון קריאות חוזרות של תשלומים (payment callbacks), הודעות וכדומה.

## יצירת תהליך עבודה

בעת יצירת תהליך עבודה, בחרו בסוג "אירוע Webhook":

![20241210105049](https://static-docs.nocobase.com/20241210105049.png)

:::info{title="טיפ"}
ההבדל בין תהליכי עבודה "סינכרוניים" ל"אסינכרוניים" הוא שתהליך עבודה סינכרוני ממתין לסיום ביצוע תהליך העבודה לפני החזרת תגובה, בעוד שתהליך עבודה אסינכרוני מחזיר מיד את התגובה שהוגדרה בטריגר וממתין בתור לביצוע ברקע.
:::

## הגדרות טריגר

![20241210105441](https://static-docs.nocobase.com/20241210105441.png)

### Webhook URL

כתובת ה-URL של טריגר ה-Webhook נוצרת אוטומטית על ידי המערכת ומקושרת לתהליך עבודה זה. תוכלו ללחוץ על הכפתור מימין כדי להעתיק אותה ולהדביק אותה במערכת הצד השלישי.

רק שיטת ה-HTTP מסוג POST נתמכת; שיטות אחרות יחזירו שגיאת `405`.

### אבטחה

אימות בסיסי של HTTP (HTTP Basic Authentication) נתמך כרגע. תוכלו להפעיל אפשרות זו ולהגדיר שם משתמש וסיסמה. כללו את שם המשתמש והסיסמה בכתובת ה-URL של ה-Webhook במערכת הצד השלישי כדי ליישם אימות אבטחה עבור ה-Webhook (לפרטים על התקן, ראו: [MDN: HTTP authentication](https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#basic_authentication_scheme)).

כאשר מוגדרים שם משתמש וסיסמה, המערכת תאמת אם שם המשתמש והסיסמה בבקשה תואמים. אם הם לא סופקו או אינם תואמים, תוחזר שגיאת `401`.

### ניתוח נתוני בקשה

כאשר צד שלישי קורא ל-Webhook, הנתונים הנישאים בבקשה צריכים לעבור ניתוח לפני שניתן יהיה להשתמש בהם בתהליך העבודה. לאחר הניתוח, הם הופכים למשתנה טריגר שניתן להתייחס אליו בצמתים הבאים.

ניתוח בקשת ה-HTTP מחולק לשלושה חלקים:

1.  **כותרות בקשה**

    כותרות בקשה הן בדרך כלל זוגות מפתח-ערך פשוטים מסוג מחרוזת. ניתן להגדיר ישירות את שדות הכותרת שבהם תצטרכו להשתמש, כגון `Date`, `X-Request-Id` וכדומה.

2.  **פרמטרי בקשה**

    פרמטרי בקשה הם פרמטרי השאילתה בכתובת ה-URL, כגון הפרמטר `query` ב-`http://localhost:13000/api/webhook:trigger/1hfmkioou0d?query=1`. תוכלו להדביק כתובת URL לדוגמה מלאה או רק את חלק פרמטרי השאילתה וללחוץ על כפתור הניתוח כדי לנתח אוטומטית את זוגות המפתח-ערך.

    ![20241210111155](https://static-docs.nocobase.com/20241210111155.png)

    ניתוח אוטומטי ימיר את חלק הפרמטרים של כתובת ה-URL למבנה JSON וייצור נתיבים כמו `query[0]`, `query[0].a` בהתבסס על היררכיית הפרמטרים. ניתן לשנות ידנית את שם הנתיב אם הוא אינו עונה על הצרכים שלכם, אך בדרך כלל אין צורך בכך. הכינוי (alias) הוא שם התצוגה של המשתנה בעת השימוש בו, והוא אופציונלי. הניתוח גם ייצור רשימה מלאה של פרמטרים מהדוגמה; תוכלו למחוק כל פרמטר שאינכם צריכים.

3.  **גוף בקשה**

    גוף הבקשה הוא חלק ה-Body של בקשת ה-HTTP. נכון לעכשיו, נתמכים רק גופי בקשה עם `Content-Type` מסוג `application/json`. תוכלו להגדיר ישירות את הנתיבים לניתוח, או להזין דוגמת JSON וללחוץ על כפתור הניתוח לניתוח אוטומטי.

    ![20241210112529](https://static-docs.nocobase.com/20241210112529.png)

    ניתוח אוטומטי ימיר את זוגות המפתח-ערך במבנה ה-JSON לנתיבים. לדוגמה, `{"a": 1, "b": {"c": 2}}` ייצור נתיבים כמו `a`, `b` ו-`b.c`. הכינוי (alias) הוא שם התצוגה של המשתנה בעת השימוש בו, והוא אופציונלי. הניתוח גם ייצור רשימה מלאה של פרמטרים מהדוגמה; תוכלו למחוק כל פרמטר שאינכם צריכים.

### הגדרות תגובה

הגדרת תגובת ה-Webhook שונה בין תהליכי עבודה סינכרוניים לאסינכרוניים. עבור תהליכי עבודה אסינכרוניים, התגובה מוגדרת ישירות בטריגר. עם קבלת בקשת Webhook, היא מחזירה מיד את התגובה המוגדרת למערכת הצד השלישי ולאחר מכן מבצעת את תהליך העבודה. עבור תהליכי עבודה סינכרוניים, עליכם להוסיף צומת תגובה בתוך התהליך כדי לטפל בה בהתאם לדרישות העסקיות (לפרטים, ראו: [צומת תגובה](#צומת-תגובה)).

בדרך כלל, התגובה לאירוע Webhook שהופעל באופן אסינכרוני כוללת קוד סטטוס `200` וגוף תגובה `ok`. תוכלו גם להתאים אישית את קוד הסטטוס, הכותרות וגוף התגובה לפי הצורך.

![20241210114312](https://static-docs.nocobase.com/20241210114312.png)

## צומת תגובה

הפניה: [צומת תגובה](../nodes/response.md)

## דוגמה

בתהליך עבודה של Webhook, תוכלו להחזיר תגובות שונות בהתבסס על תנאים עסקיים שונים, כפי שמוצג באיור למטה:

![20241210120655](https://static-docs.nocobase.com/20241210120655.png)

השתמשו בצומת ענף מותנה כדי לקבוע אם סטטוס עסקי מסוים מתקיים. אם כן, החזירו תגובת הצלחה; אחרת, החזירו תגובת כישלון.