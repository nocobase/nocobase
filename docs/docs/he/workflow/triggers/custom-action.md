---
pkg: '@nocobase/plugin-workflow-custom-action-trigger'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::



# אירוע פעולה מותאמת אישית

## מבוא

NocoBase כוללת פעולות נתונים נפוצות מובנות (הוספה, מחיקה, עדכון, צפייה וכו'). כאשר פעולות אלו אינן מספקות מענה לצרכים עסקיים מורכבים, ניתן להשתמש באירועי פעולה מותאמים אישית בתוך תהליך עבודה. על ידי קישור אירוע זה לכפתור "הפעל תהליך עבודה" בבלוק דף, לחיצת המשתמש תפעיל תהליך עבודה של פעולה מותאמת אישית.

## יצירת תהליך עבודה

בעת יצירת תהליך עבודה, בחרו ב"אירוע פעולה מותאמת אישית":

![Create "Custom Action Event" workflow](https://static-docs.nocobase.com/20240509091820.png)

## הגדרות טריגר

### סוג הקשר (Context)

> v.1.6.0+

סוג ההקשר קובע לאילו כפתורים בבלוקים שונים ניתן לקשר את תהליך העבודה:

*   **ללא הקשר:** אירוע גלובלי שניתן לקשר לכפתורי פעולה בסרגל הפעולות ובבלוקי נתונים.
*   **רשומה בודדת:** ניתן לקשר לכפתורי פעולה בבלוקי נתונים כמו שורות טבלה, טפסים ופרטים.
*   **רשומות מרובות:** ניתן לקשר לכפתורי פעולות בכמות גדולה (Bulk Actions) בטבלה.

![Trigger Configuration_Context Type](https://static-docs.nocobase.com/20250215135808.png)

### אוסף

כאשר סוג ההקשר הוא רשומה בודדת או רשומות מרובות, עליכם לבחור את ה**אוסף** אליו יש לקשר את מודל הנתונים:

![Trigger Configuration_Select Collection](https://static-docs.nocobase.com/20250215135919.png)

### נתוני אסוציאציה לשימוש

אם אתם צריכים להשתמש בנתוני האסוציאציה של שורת הנתונים המפעילה בתוך תהליך העבודה, תוכלו לבחור כאן שדות אסוציאציה עמוקים:

![Trigger Configuration_Select Association Data to be Used](https://static-docs.nocobase.com/20250215135955.png)

שדות אלו ייטענו אוטומטית מראש לתוך הקשר של תהליך העבודה לאחר הפעלת האירוע, כך שיהיו זמינים לשימוש בתהליך העבודה.

## הגדרות פעולה

הגדרות כפתורי הפעולה בבלוקים שונים משתנות בהתאם לסוג ההקשר שהוגדר בתהליך העבודה.

### ללא הקשר

> v.1.6.0+

בסרגל הפעולות ובבלוקי נתונים אחרים, ניתן להוסיף כפתור "הפעל תהליך עבודה":

![Add Action Button to Block_Action Bar](https://static-docs.nocobase.com/20250215221738.png)

![Add Action Button to Block_Calendar](https://static-docs.nocobase.com/20250215221942.png)

![Add Action Button to Block_Gantt Chart](https://static-docs.nocobase.com/20250215221810.png)

לאחר הוספת הכפתור, קשרו אליו את תהליך העבודה ללא הקשר שיצרתם קודם לכן. הנה דוגמה באמצעות כפתור בסרגל הפעולות:

![Bind Workflow to Button_Action Bar](https://static-docs.nocobase.com/20250215222120.png)

![Select Workflow to Bind_No Context](https://static-docs.nocobase.com/20250215222234.png)

### רשומה בודדת

בכל בלוק נתונים, ניתן להוסיף כפתור "הפעל תהליך עבודה" לסרגל הפעולות של רשומה בודדת, למשל בטפסים, שורות טבלה, פרטים ועוד:

![Add Action Button to Block_Form](https://static-docs.nocobase.com/20240509165428.png)

![Add Action Button to Block_Table Row](https://static-docs.nocobase.com/20240509165340.png)

![Add Action Button to Block_Details](https://static-docs.nocobase.com/20240509165545.png)

לאחר הוספת הכפתור, קשרו אליו את תהליך העבודה שיצרתם קודם לכן:

![Bind Workflow to Button](https://static-docs.nocobase.com/20240509165631.png)

![Select Workflow to Bind](https://static-docs.nocobase.com/20240509165658.png)

לאחר מכן, לחיצה על כפתור זה תפעיל את אירוע הפעולה המותאמת אישית:

![Result of Clicking the Button](https://static-docs.nocobase.com/20240509170453.png)

### רשומות מרובות

> v.1.6.0+

בסרגל הפעולות של בלוק טבלה, בעת הוספת כפתור "הפעל תהליך עבודה", תופיע אפשרות נוספת לבחירת סוג ההקשר: "ללא הקשר" או "רשומות מרובות":

![Add Action Button to Block_Table](https://static-docs.nocobase.com/20250215222507.png)

כאשר נבחר "ללא הקשר", מדובר באירוע גלובלי, וניתן לקשר אליו רק תהליכי עבודה מסוג "ללא הקשר".

כאשר נבחר "רשומות מרובות", ניתן לקשר תהליך עבודה מסוג רשומות מרובות, אשר יכול לשמש לפעולות בכמות גדולה לאחר בחירת מספר רשומות (נכון לעכשיו, נתמך רק בטבלאות). טווח תהליכי העבודה הזמינים מוגבל לאלו שהוגדרו להתאים ל**אוסף** של בלוק הנתונים הנוכחי:

![20250215224436](https://static-docs.nocobase.com/20250215224436.png)

בעת לחיצה על הכפתור להפעלה, יש לסמן מראש חלק משורות הנתונים בטבלה; אחרת, תהליך העבודה לא יופעל:

![20250215224736](https://static-docs.nocobase.com/20250215224736.png)

## דוגמה

לדוגמה, יש לנו **אוסף** "דוגמאות". עבור דוגמאות במצב "נאסף", עלינו לספק פעולת "שלח לבדיקה". פעולה זו תבדוק תחילה את המידע הבסיסי של הדוגמה, לאחר מכן תיצור רשומת "תיעוד בדיקה", ולבסוף תשנה את מצב הדוגמה ל"נשלח לבדיקה". מכיוון שסדרת תהליכים זו אינה ניתנת להשלמה באמצעות לחיצות כפתור פשוטות של "הוספה, מחיקה, עדכון, צפייה", ניתן להשתמש באירוע פעולה מותאמת אישית כדי ליישם אותה.

ראשית, צרו **אוסף** "דוגמאות" ו**אוסף** "תיעוד בדיקות", והזינו נתוני בדיקה בסיסיים ל**אוסף** הדוגמאות:

![Example_Samples Collection](https://static-docs.nocobase.com/20240509172234.png)

לאחר מכן, צרו **תהליך עבודה** מסוג "אירוע פעולה מותאמת אישית". אם אתם זקוקים למשוב מיידי יחסית מתהליך הפעולה, תוכלו לבחור במצב סינכרוני (במצב סינכרוני לא ניתן להשתמש בצמתים אסינכרוניים כמו טיפול ידני):

![Example_Create Workflow](https://static-docs.nocobase.com/20240509173106.png)

בהגדרות הטריגר, בחרו ב"דוגמאות" עבור ה**אוסף**:

![Example_Trigger Configuration](https://static-docs.nocobase.com/20240509173148.png)

סדרו את הלוגיקה בתהליך בהתאם לדרישות העסקיות. לדוגמה, אפשרו שליחה לבדיקה רק כאשר פרמטר המדד גדול מ-`90`; אחרת, הציגו הודעה רלוונטית:

![Example_Business Logic Arrangement](https://static-docs.nocobase.com/20240509174159.png)

:::info{title=טיפ}
צומת "[הודעת תגובה](../nodes/response-message.md)" יכול לשמש באירועי פעולה מותאמים אישית סינכרוניים, כדי להחזיר הודעת הנחיה ללקוח. הוא אינו ניתן לשימוש במצב אסינכרוני.
:::

לאחר הגדרת התהליך והפעלתו, חזרו לממשק הטבלה והוסיפו כפתור "הפעל תהליך עבודה" לעמודת הפעולות בטבלה:

![Example_Add Action Button](https://static-docs.nocobase.com/20240509174525.png)

לאחר מכן, בתפריט ההגדרות של הכפתור, בחרו ב"קשר תהליך עבודה" ופתחו את חלון הקופץ של ההגדרות:

![Example_Open Bind Workflow Pop-up](https://static-docs.nocobase.com/20240509174633.png)

הוסיפו את תהליך העבודה שהופעל קודם לכן:

![Example_Select Workflow](https://static-docs.nocobase.com/20240509174723.png)

לאחר השליחה, שנו את טקסט הכפתור לשם הפעולה, למשל "שלח לבדיקה". תהליך ההגדרה הושלם.

כדי להשתמש בכך, בחרו כל נתוני דוגמה בטבלה ולחצו על כפתור "שלח לבדיקה" כדי להפעיל את אירוע הפעולה המותאמת אישית. כפי שהוגדר בלוגיקה קודם לכן, אם פרמטר המדד של הדוגמה קטן מ-90, תוצג ההודעה הבאה לאחר הלחיצה:

![Example_Indicator Does Not Meet Submission Criteria](https://static-docs.nocobase.com/20240509175026.png)

אם פרמטר המדד גדול מ-90, התהליך יבוצע כרגיל, תיצור רשומת "תיעוד בדיקה" ומצב הדוגמה ישתנה ל"נשלח לבדיקה":

![Example_Submission Successful](https://static-docs.nocobase.com/20240509175247.png)

בשלב זה, אירוע פעולה מותאמת אישית פשוט הושלם. בדומה לכך, עבור עסקים עם פעולות מורכבות כמו עיבוד הזמנות או הגשת דוחות, ניתן ליישם זאת באמצעות אירועי פעולה מותאמים אישית.

## קריאה חיצונית

הפעלת אירועי פעולה מותאמים אישית אינה מוגבלת לפעולות בממשק המשתמש; ניתן להפעיל אותם גם באמצעות קריאות HTTP API. באופן ספציפי, אירועי פעולה מותאמים אישית מספקים סוג פעולה חדש לכל פעולות ה**אוסף** להפעלת תהליכי עבודה: `trigger`, שניתן לקרוא לו באמצעות ה-API הסטנדרטי של NocoBase.

**תהליך עבודה** המופעל על ידי כפתור, כפי שבדוגמה, ניתן לקרוא לו כך:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' \
  "http://localhost:3000/api/samples:trigger/<:id>?triggerWorkflows=workflowKey"
```

מכיוון שפעולה זו מיועדת לרשומה בודדת, בעת קריאה לנתונים קיימים, עליכם לציין את ה-ID של שורת הנתונים, ולהחליף את החלק `<:id>` ב-URL.

אם הקריאה מיועדת לטופס (כמו הוספה או עדכון), עבור טופס שיוצר נתונים חדשים ניתן לא להעביר ID, אך יש להעביר את הנתונים שנשלחו כנתוני הקשר לביצוע:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Sample 1",
    "indicator": 91
  }'
  "http://localhost:3000/api/samples:trigger?triggerWorkflows=workflowKey"
```

עבור טופס עדכון, יש להעביר גם את ה-ID של שורת הנתונים וגם את הנתונים המעודכנים:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Sample 1",
    "indicator": 91
  }'
  "http://localhost:3000/api/samples:trigger/<:id>?triggerWorkflows=workflowKey"
```

אם הועברו גם ID וגם נתונים, שורת הנתונים המתאימה ל-ID תיטען תחילה, ולאחר מכן התכונות מאובייקט הנתונים שהועבר ישמשו לדריסה של שורת הנתונים המקורית כדי לקבל את הקשר נתוני ההפעלה הסופי.

:::warning{title="שימו לב"}
אם הועברו נתוני אסוציאציה, הם גם יידרסו. יש לנהוג בזהירות יתרה בעת טיפול בנתונים נכנסים אם הוגדרה טעינה מראש של פריטי נתוני אסוציאציה, כדי למנוע דריסה בלתי צפויה של נתוני אסוציאציה.
:::

בנוסף, פרמטר ה-URL `triggerWorkflows` הוא מפתח **תהליך העבודה**; מספר מפתחות **תהליך עבודה** מופרדים בפסיקים. מפתח זה ניתן להשגה על ידי ריחוף עם העכבר מעל שם **תהליך העבודה** בחלק העליון של קנבס **תהליך העבודה**:

![Workflow_Key_View Method](https://static-docs.nocobase.com/20240426135108.png)

לאחר קריאה מוצלחת, יופעל אירוע הפעולה המותאמת אישית עבור **אוסף** ה-`samples` המתאים.

:::info{title="טיפ"}
מכיוון שקריאות חיצוניות דורשות גם זיהוי משתמש, בעת קריאה באמצעות HTTP API, בדומה לבקשות הנשלחות מממשק רגיל, עליכם לספק פרטי אימות. זה כולל את כותרת הבקשה `Authorization` או פרמטר `token` (הטוקן שהתקבל לאחר התחברות), ואת כותרת הבקשה `X-Role` (שם התפקיד הנוכחי של המשתמש).
:::

אם אתם צריכים להפעיל אירוע עבור נתוני אסוציאציה מסוג "אחד לרבים" (to-one association data) ("רבים לרבים" אינו נתמך כרגע) בפעולה זו, תוכלו להשתמש ב-`!` בפרמטר כדי לציין את נתוני ההפעלה של שדה האסוציאציה:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' \
  "http://localhost:3000/api/posts:trigger/<:id>?triggerWorkflows=workflowKey!category"
```

לאחר קריאה מוצלחת, יופעל אירוע הפעולה המותאמת אישית עבור **אוסף** ה-`categories` המתאים.

:::info{title="טיפ"}
בעת הפעלת אירוע פעולה באמצעות קריאת HTTP API, עליכם לשים לב גם למצב ההפעלה של **תהליך העבודה** ולוודא שהגדרות ה**אוסף** תואמות; אחרת, הקריאה עלולה להיכשל או לגרום לשגיאה.
:::