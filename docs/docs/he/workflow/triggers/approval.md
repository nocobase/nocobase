---
pkg: '@nocobase/plugin-workflow-approval'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# אישור

## מבוא

אישור הוא סוג של תהליך עבודה שתוכנן במיוחד עבור משימות שיזומות ומטופלות באופן ידני, במטרה לקבוע את סטטוס הנתונים הרלוונטיים. הוא משמש בדרך כלל לאוטומציה משרדית או לתהליכי קבלת החלטות ידניים אחרים, לדוגמה, ניתן ליצור ולנהל תהליכי עבודה ידניים עבור תרחישים כמו "בקשות חופשה", "אישורי החזר הוצאות" ו"אישורי רכש חומרי גלם".

תוסף האישור מספק סוג תהליך עבודה (טריגר) ייעודי בשם "אישור (אירוע)" וצומת "אישור" ייעודי עבור תהליך זה. בשילוב עם אוספים מותאמים אישית ובלוקים מותאמים אישית הייחודיים ל-NocoBase, תוכלו ליצור ולנהל במהירות ובגמישות מגוון תרחישי אישור.

## יצירת תהליך עבודה

בעת יצירת תהליך עבודה, בחרו בסוג "אישור" כדי ליצור תהליך אישור:

![טריגר אישור_יצירת תהליך אישור](https://static-docs.nocobase.com/f52dda854f46a669e0c1c7fb487a17ea.png)

לאחר מכן, בממשק הגדרות תהליך העבודה, לחצו על הטריגר כדי לפתוח חלון קופץ להגדרות נוספות.

## הגדרות טריגר

### קישור אוסף

תוסף האישור של NocoBase תוכנן מתוך מחשבה על גמישות וניתן להשתמש בו עם כל אוסף מותאם אישית. משמעות הדבר היא שהגדרות האישור אינן דורשות הגדרה מחדש של מודל הנתונים, אלא עושות שימוש חוזר ישיר באוסף קיים. לכן, לאחר הכניסה להגדרות הטריגר, עליכם לבחור תחילה אוסף כדי לקבוע יצירה או עדכון של נתונים מאיזה אוסף יפעילו את תהליך העבודה הזה:

![טריגר אישור_הגדרות טריגר_בחירת אוסף](https://static-docs.nocobase.com/872dda419b1e28d2752b8f601132c82d.png)

לאחר מכן, בטופס ליצירה (או עריכה) של נתונים עבור האוסף המתאים, קשרו את תהליך העבודה הזה לכפתור השליחה:

![יזום אישור_קישור תהליך עבודה](https://static-docs.nocobase.com/2872ff108c61d7bf6d0bfb19886774c6.png)

לאחר מכן, שליחת הטופס על ידי המשתמש תפעיל את תהליך העבודה של האישור המתאים. הנתונים שנשלחו לא רק נשמרים באוסף המתאים, אלא גם נשמרים כ'תמונת מצב' (snapshot) בזרם האישור, לשימוש ובדיקה על ידי המאשרים הבאים.

### משיכה

אם תהליך אישור מאפשר למשתמש שיזם אותו למשוך את הבקשה, עליכם להפעיל את כפתור "משיכה" בהגדרות ממשק המשתמש המייזם:

![טריגר אישור_הגדרות טריגר_אפשר משיכה](https://static-docs.nocobase.com/20251029232544.png)

לאחר ההפעלה, אישור שיזום באמצעות תהליך עבודה זה יכול להימשך על ידי המשתמש המייזם לפני שכל מאשר יטפל בו. עם זאת, לאחר שמאשר כלשהו בצומת אישור עוקב טיפל בבקשה, לא ניתן יהיה למשוך אותה עוד.

:::info{title=הערה}
לאחר הפעלה או מחיקה של כפתור המשיכה, עליכם ללחוץ על שמירה ושליחה בחלון הקופץ של הגדרות הטריגר כדי שהשינויים ייכנסו לתוקף.
:::

### הגדרות ממשק טופס המשתמש המייזם

לבסוף, עליכם להגדיר את ממשק הטופס של המשתמש המייזם. ממשק זה ישמש לפעולות שליחה בעת יזום מבלוק מרכז האישורים ובעת יזום מחדש לאחר משיכה. לחצו על כפתור ההגדרות כדי לפתוח את החלון הקופץ:

![טריגר אישור_הגדרות טריגר_טופס מייזם](https://static-docs.nocobase.com/ca8b7e362d912138cf7d73bb60b37ac1.png)

ניתן להוסיף לממשק המשתמש המייזם טופס מילוי המבוסס על האוסף המקושר, או להוסיף טקסט הסבר (Markdown) לצורך הנחיה והכוונה. הטופס הוא חובה; אחרת, המשתמש המייזם לא יוכל לבצע פעולות כלשהן לאחר הכניסה לממשק זה.

לאחר הוספת בלוק טופס, בדומה לממשק הגדרות טופס רגיל, ניתן להוסיף רכיבי שדות מהאוסף המתאים ולסדר אותם כרצונכם כדי לארגן את התוכן שיש למלא בטופס:

![טריגר אישור_הגדרות טריגר_טופס מייזם_הגדרות שדות](https://static-docs.nocobase.com/5a1e7f9c9d8de092c7b55585dad7d633.png)

בנוסף לכפתור השליחה הישירה, ניתן גם להוסיף כפתור פעולה "שמור כטיוטה" כדי לתמוך בתהליך שמירה זמנית:

![טריגר אישור_הגדרות טריגר_טופס מייזם_הגדרות פעולה](https://static-docs.nocobase.com/2f4850d2078e94538995a9df70d3d2d1.png)

## צומת אישור

בתהליך עבודה של אישור, עליכם להשתמש בצומת "אישור" הייעודי כדי להגדיר את הלוגיקה התפעולית עבור המאשרים לטיפול (אישור, דחייה או החזרה) באישור שיזום. צומת "אישור" יכול לשמש רק בתהליכי עבודה של אישור. עיינו ב[צומת אישור](../nodes/approval.md) לפרטים נוספים.

## הגדרות יזום אישור

לאחר הגדרה והפעלה של תהליך עבודה של אישור, ניתן לקשור אותו לכפתור השליחה של הטופס באוסף המתאים, כדי לאפשר למשתמשים ליזום אישור בעת השליחה:

![יזום אישור_קישור תהליך עבודה](https://static-docs.nocobase.com/2872ff108c61d7bf6d0bfb19886774c6.png)

לאחר קישור תהליך העבודה, כאשר משתמש שולח את הטופס הנוכחי, יזום אישור.

:::info{title=הערה}
נכון לעכשיו, כפתור יזום אישור תומך רק בכפתור 'שלח' (או 'שמור') בטופס יצירה או עדכון. הוא אינו תומך בכפתור 'שלח לתהליך עבודה' (כפתור זה יכול להיות מקושר רק ל'אירוע לאחר פעולה').
:::

## מרכז משימות לביצוע

מרכז המשימות לביצוע מספק נקודת כניסה אחידה למשתמשים לצפייה וטיפול במשימותיהם. אישורים שיזמו על ידי המשתמש הנוכחי ומשימותיו הממתינות ניתנים לגישה דרך מרכז המשימות לביצוע בסרגל הכלים העליון, וסוגים שונים של משימות לביצוע ניתנים לצפייה דרך ניווט הקטגוריות בצד שמאל.

![20250310161203](https://static-docs.nocobase.com/20250310161203.png)

### הבקשות שיזמתי

#### צפייה באישורים שיזמתי

![20250310161609](https://static-docs.nocobase.com/20250310161609.png)

#### יזום ישיר של אישור חדש

![20250310161658](https://static-docs.nocobase.com/20250310161658.png)

### המשימות שלי לביצוע

#### רשימת משימות לביצוע

![20250310161934](https://static-docs.nocobase.com/20250310161934.png)

#### פרטי משימה לביצוע

![20250310162111](https://static-docs.nocobase.com/20250310162111.png)

## API HTTP

### המייזם

#### יזום מאוסף

כדי ליזום מבלוק נתונים, ניתן לבצע קריאה כזו (באמצעות כפתור היצירה של אוסף ה-`posts` כדוגמה):

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Hello, world!",
    "content": "This is a test post."
  }'
  "http://localhost:3000/api/posts:create?triggerWorkflows=workflowKey"
```

כאן, פרמטר ה-URL `triggerWorkflows` הוא מפתח תהליך העבודה; מספר מפתחות תהליך עבודה מופרדים בפסיקים. ניתן לקבל מפתח זה על ידי ריחוף עם העכבר מעל שם תהליך העבודה בחלק העליון של קנבס תהליך העבודה:

![תהליך עבודה_מפתח_שיטת צפייה](https://static-docs.nocobase.com/20240426135108.png)

לאחר קריאה מוצלחת, תהליך העבודה של האישור עבור אוסף ה-`posts` המתאים יופעל.

:::info{title="הערה"}
מכיוון שקריאות חיצוניות דורשות גם זיהוי משתמש, בעת קריאה באמצעות API HTTP, בדומה לבקשות הנשלחות מממשק רגיל, יש לספק מידע אימות, כולל כותרת ה-`Authorization` או פרמטר ה-`token` (האסימון המתקבל בכניסה), וכותרת ה-`X-Role` (שם התפקיד הנוכחי של המשתמש).
:::

אם עליכם להפעיל אירוע עבור נתונים קשורים ביחס של אחד לאחד בפעולה זו (אחד לרבים אינו נתמך כרגע), ניתן להשתמש ב-`!` בפרמטר כדי לציין את נתוני הטריגר עבור שדה הקישור:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Hello, world!",
    "content": "This is a test post.",
    "category": {
      "title": "Test category"
    }
  }'
  "http://localhost:3000/api/posts:create?triggerWorkflows=workflowKey!category"
```

לאחר קריאה מוצלחת לעיל, אירוע האישור עבור אוסף ה-`categories` המתאים יופעל.

:::info{title="הערה"}
בעת הפעלת אירוע לאחר פעולה באמצעות API HTTP, עליכם לשים לב גם למצב ההפעלה של תהליך העבודה והאם הגדרות האוסף תואמות; אחרת, הקריאה עלולה להיכשל או שתתרחש שגיאה.
:::

#### יזום ממרכז האישורים

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "collectionName": "<collection name>",
    "workflowId": <workflow id>,
    "data": { "<field>": "<value>" },
    "status": <initial approval status>,
  }'
  "http://localhost:3000/api/approvals:create"
```

**פרמטרים**

*   `collectionName`: שם אוסף היעד ליזום האישור. חובה.
*   `workflowId`: מזהה תהליך העבודה המשמש ליזום האישור. חובה.
*   `data`: שדות רשומת האוסף שנוצרו בעת יזום האישור. חובה.
*   `status`: סטטוס הרשומה שנוצרה בעת יזום האישור. חובה. ערכים אפשריים כוללים:
    *   `0`: טיוטה, מציין שמירה ללא שליחה לאישור.
    *   `1`: שלח לאישור, מציין שהמייזם שולח את בקשת האישור, ונכנס לתהליך האישור.

#### שמירה ושליחה

כאשר אישור שיזום (או נמשך) נמצא במצב טיוטה, ניתן לשמור או לשלוח אותו שוב באמצעות ה-API הבא:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "data": { "<field>": "<value>" },
    "status": 2
  }'
  "http://localhost:3000/api/approvals:update/<approval id>"
```

#### קבלת רשימת אישורים שיזמתי

```bash
curl -X GET -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' \
  "http://localhost:3000/api/approvals:listMine"
```

#### משיכה

המייזם יכול למשוך רשומה הנמצאת כרגע בתהליך אישור באמצעות ה-API הבא:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  "http://localhost:3000/api/approvals:withdraw/<approval id>"
```

**פרמטרים**

*   `<approval id>`: מזהה רשומת האישור למשיכה. חובה.

### המאשר

לאחר שתהליך העבודה של האישור נכנס לצומת אישור, נוצרת משימה לביצוע עבור המאשר הנוכחי. המאשר יכול להשלים את משימת האישור דרך הממשק או באמצעות קריאה ל-API HTTP.

#### קבלת רשומות אישור

משימות לביצוע הן רשומות אישור. ניתן לקבל את כל רשומות האישור של המשתמש הנוכחי באמצעות ה-API הבא:

```bash
curl -X GET -H 'Authorization: Bearer <your token>' \
  "http://localhost:3000/api/approvalRecords:listMine"
```

כאן, `approvalRecords` הוא משאב אוסף, ולכן ניתן להשתמש בתנאי שאילתה נפוצים כמו `filter`, `sort`, `pageSize` ו-`page`.

#### קבלת רשומת אישור בודדת

```bash
curl -X GET -H 'Authorization: Bearer <your token>' \
  "http://localhost:3000/api/approvalRecords:get/<record id>"
```

#### אישור ודחייה

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -d \
  '{
    "status": 2,
    "comment": "Looks good to me.",
    "data": { "<field to modify>": "<value>" }
  }'
  "http://localhost:3000/api/approvalRecords:submit/<record id>"
```

**פרמטרים**

*   `<record id>`: מזהה הרשומה לטיפול אישור. חובה.
*   `status`: השדה מציין את סטטוס טיפול האישור. `2` מציין "אושר", `-1` מציין "נדחה". חובה.
*   `comment`: הערות לטיפול האישור. אופציונלי.
*   `data`: שינויים ברשומת האוסף בצומת האישור הנוכחי לאחר אישור. אופציונלי (תקף רק בעת אישור).

#### החזרה <Badge>v1.9.0+</Badge>

לפני גרסה v1.9.0, החזרה השתמשה באותו API כמו "אישור" ו"דחייה", כאשר `"status": 1` ייצג החזרה.

החל מגרסה v1.9.0, להחזרה יש API נפרד:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -d \
  '{
    "returnToNodeKey": "<node key>",
  }'
  "http://localhost:3000/api/approvalRecords:return/<record id>"
```

**פרמטרים**

*   `<record id>`: מזהה הרשומה לטיפול אישור. חובה.
*   `returnToNodeKey`: מפתח צומת היעד להחזרה. אופציונלי. כאשר טווח של צמתים ניתנים להחזרה מוגדר בצומת, ניתן להשתמש בפרמטר זה כדי לציין לאיזה צומת להחזיר. אם לא הוגדר, אין צורך להעביר פרמטר זה, והוא יחזור כברירת מחדל לנקודת ההתחלה כדי שהמייזם ישלח מחדש.

#### האצלה

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -d \
  '{
    "assignee": <user id>,
  }'
  "http://localhost:3000/api/approvalRecords:delegate/<record id>"
```

**פרמטרים**

*   `<record id>`: מזהה הרשומה לטיפול אישור. חובה.
*   `assignee`: מזהה המשתמש שאליו תואצל המשימה. חובה.

#### הוספת חותם

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -d \
  '{
    "assignees": [<user id>],
    "order": <order>,
  }'
  "http://localhost:3000/api/approvalRecords:add/<record id>"
```

**פרמטרים**

*   `<record id>`: מזהה הרשומה לטיפול אישור. חובה.
*   `assignees`: רשימת מזהי משתמשים להוספה כחותמים. חובה.
*   `order`: סדר החותם שנוסף. `-1` מציין לפני "אני", `1` מציין אחרי "אני".