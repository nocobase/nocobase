---
pkg: '@nocobase/plugin-workflow-date-calculation'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# חישוב תאריכים

## מבוא

צומת חישוב תאריכים מציע תשע פונקציות חישוב, הכוללות הוספת פרק זמן, הפחתת פרק זמן, פלט מעוצב של מחרוזת תאריך/שעה, והמרת יחידות משך זמן. לכל פונקציה יש סוגי קלט ופלט ספציפיים, והיא יכולה גם לקבל תוצאות מצמתים אחרים כמשתני פרמטרים. הצומת משתמש בגישת צינור חישוב (calculation pipeline) כדי לשרשר את תוצאות הפונקציות המוגדרות, ובסופו של דבר לקבל פלט רצוי.

## יצירת צומת

בממשק הגדרות תהליך העבודה, לחצו על כפתור הפלוס ("+") בזרימה כדי להוסיף צומת "חישוב תאריכים".

![צומת חישוב תאריכים_יצירת צומת](https://static-docs.nocobase.com/[图片].png)

## הגדרות צומת

![צומת חישוב תאריכים_הגדרות צומת](https://static-docs.nocobase.com/20240817184423.png)

### ערך קלט

ערך הקלט יכול להיות משתנה או קבוע תאריך. המשתנה יכול להיות הנתונים שהפעילו את תהליך העבודה הזה, או התוצאה של צומת קודם בתהליך העבודה. עבור קבוע, ניתן לבחור כל תאריך.

### סוג ערך קלט

מתייחס לסוג ערך הקלט. ישנם שני ערכים אפשריים.

*   סוג תאריך: פירושו שערך הקלט יכול בסופו של דבר להיות מומר לסוג תאריך-שעה, כגון חותמת זמן מספרית או מחרוזת המייצגת זמן.
*   סוג מספרי: מכיוון שסוג ערך הקלט משפיע על בחירת שלבי חישוב הזמן הבאים, יש לבחור נכון את סוג ערך הקלט.

### שלבי חישוב

כל שלב חישוב מורכב מפונקציית חישוב והגדרות הפרמטרים שלה. הוא מאמץ עיצוב מבוסס צינור (pipeline), כאשר התוצאה מחישוב הפונקציה הקודמת משמשת כערך הקלט לחישוב הפונקציה הבאה. בדרך זו, ניתן להשלים סדרה של חישובי והמרות זמן.

לאחר כל שלב חישוב, סוג הפלט גם הוא קבוע וישפיע על הפונקציות הזמינות לשלב החישוב הבא. החישוב יכול להימשך רק אם הסוגים תואמים. אחרת, תוצאת שלב מסוים תהיה הפלט הסופי של הצומת.

## פונקציות חישוב

### הוספת פרק זמן

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   הכמות להוספה, שיכולה להיות מספר או משתנה מובנה מהצומת.
    -   יחידת זמן.
-   סוג ערך פלט: תאריך
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 00:00:00`, הכמות היא `1`, והיחידה היא "יום", תוצאת החישוב תהיה `2024-7-16 00:00:00`.

### הפחתת פרק זמן

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   הכמות להפחתה, שיכולה להיות מספר או משתנה מובנה מהצומת.
    -   יחידת זמן.
-   סוג ערך פלט: תאריך
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 00:00:00`, הכמות היא `1`, והיחידה היא "יום", תוצאת החישוב תהיה `2024-7-14 00:00:00`.

### חישוב הפרש זמנים

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   התאריך שעמו יש לחשב את ההפרש, שיכול להיות קבוע תאריך או משתנה מהקשר תהליך העבודה.
    -   יחידת זמן.
    -   האם לקחת ערך מוחלט.
    -   פעולת עיגול: ניתן לבחור בין שמירת נקודות עשרוניות, עיגול רגיל, עיגול כלפי מעלה ועיגול כלפי מטה.
-   סוג ערך פלט: מספרי
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 00:00:00`, אובייקט ההשוואה הוא `2024-7-16 06:00:00`, היחידה היא "יום", לא נלקח ערך מוחלט, ונקודות עשרוניות נשמרות, תוצאת החישוב תהיה `-1.25`.

:::info{title=טיפ}
כאשר ערך מוחלט ועיגול מוגדרים בו-זמנית, הערך המוחלט נלקח תחילה, ולאחר מכן מיושם העיגול.
:::

### קבלת ערך זמן ביחידה ספציפית

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   יחידת זמן.
-   סוג ערך פלט: מספרי
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 00:00:00` והיחידה היא "יום", תוצאת החישוב תהיה `15`.

### הגדרת תאריך לתחילת יחידה ספציפית

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   יחידת זמן.
-   סוג ערך פלט: תאריך
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 14:26:30` והיחידה היא "יום", תוצאת החישוב תהיה `2024-7-15 00:00:00`.

### הגדרת תאריך לסוף יחידה ספציפית

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   יחידת זמן.
-   סוג ערך פלט: תאריך
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 14:26:30` והיחידה היא "יום", תוצאת החישוב תהיה `2024-7-15 23:59:59`.

### בדיקת שנה מעוברת

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   ללא פרמטרים
-   סוג ערך פלט: בוליאני
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 14:26:30`, תוצאת החישוב תהיה `true`.

### עיצוב כמחרוזת

-   מקבל סוג ערך קלט: תאריך
-   פרמטרים
    -   פורמט, עיינו ב-[Day.js: Format](https://day.js.org/docs/en/display/format)
-   סוג ערך פלט: מחרוזת
-   דוגמה: כאשר ערך הקלט הוא `2024-7-15 14:26:30` והפורמט הוא `the time is YYYY/MM/DD HH:mm:ss`, תוצאת החישוב תהיה `the time is 2024/07/15 14:26:30`.

### המרת יחידה

-   מקבל סוג ערך קלט: מספרי
-   פרמטרים
    -   יחידת זמן לפני ההמרה.
    -   יחידת זמן לאחר ההמרה.
    -   פעולת עיגול: ניתן לבחור בין שמירת נקודות עשרוניות, עיגול רגיל, עיגול כלפי מעלה ועיגול כלפי מטה.
-   סוג ערך פלט: מספרי
-   דוגמה: כאשר ערך הקלט הוא `2`, היחידה לפני ההמרה היא "שבוע", היחידה לאחר ההמרה היא "יום", ונקודות עשרוניות אינן נשמרות, תוצאת החישוב תהיה `14`.

## דוגמה

![צומת חישוב תאריכים_דוגמה](https://static-docs.nocobase.com/20240817184137.png)

נניח שיש אירוע קידום מכירות, ואנחנו רוצים להוסיף שדה של זמן סיום קידום מכירות לכל מוצר בעת יצירתו. זמן סיום זה הוא בשעה 23:59:59 ביום האחרון של השבוע שלאחר זמן יצירת המוצר. לכן, אנו יכולים ליצור שתי פונקציות זמן ולהריץ אותן בגישת צינור (pipeline):

-   חישוב הזמן לשבוע הבא
-   איפוס התוצאה ל-23:59:59 ביום האחרון של אותו שבוע.

בדרך זו, נקבל את ערך הזמן הרצוי ונעביר אותו לצומת הבא, לדוגמה, צומת שינוי אוסף, כדי להוסיף את זמן סיום הקידום לאוסף.