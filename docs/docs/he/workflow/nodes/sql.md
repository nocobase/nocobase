---
pkg: '@nocobase/plugin-workflow-sql'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# פעולת SQL

## מבוא

בתרחישים מיוחדים מסוימים, צמתי פעולת אוסף פשוטים שהוזכרו לעיל עשויים שלא להיות מסוגלים לטפל בפעולות מורכבות. במקרים כאלה, אפשר להשתמש ישירות בצומת SQL כדי שהמסד נתונים יבצע ישירות פקודות SQL מורכבות לטיפול בנתונים.

ההבדל בין זה לבין חיבור ישיר למסד הנתונים מחוץ ליישום לצורך פעולות SQL הוא שבתוך תהליך עבודה, אפשר להשתמש במשתנים מהקשר התהליך כפרמטרים בפקודת ה-SQL.

## התקנה

תוסף מובנה, אין צורך בהתקנה.

## יצירת צומת

בממשק הגדרות תהליך העבודה, לחצו על כפתור הפלוס ("+") בזרימה כדי להוסיף צומת "פעולת SQL":

![SQL פעולה_הוספה](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

## הגדרות צומת

![SQL צומת_הגדרות צומת](https://static-docs.nocobase.com/20240904002334.png)

### מקור נתונים

בחרו את מקור הנתונים לביצוע ה-SQL.

מקור הנתונים חייב להיות מסוג מסד נתונים, כמו מקור הנתונים הראשי, PostgreSQL, או מקורות נתונים אחרים התואמים ל-Sequelize.

### תוכן SQL

ערכו את פקודת ה-SQL. נכון לעכשיו, נתמכת רק פקודת SQL אחת.

הכניסו את המשתנים הנדרשים באמצעות כפתור המשתנים בפינה הימנית העליונה של העורך. לפני הביצוע, משתנים אלו יוחלפו בערכיהם המתאימים באמצעות החלפת טקסט. הטקסט שיתקבל ישמש אז כפקודת ה-SQL הסופית ויישלח למסד הנתונים לביצוע שאילתה.

## תוצאת ביצוע צומת

החל מגרסה `v1.3.15-beta`, תוצאת ביצוע צומת SQL היא מערך של נתונים טהורים. לפני כן, זו הייתה מבנה ההחזרה המקורי של Sequelize שכלל מטא-נתונים של שאילתה (ראו: [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query)).

לדוגמה, השאילתה הבאה:

```sql
select count(id) from posts;
```

תוצאה לפני `v1.3.15-beta`:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

תוצאה אחרי `v1.3.15-beta`:

```json
[
    { "count": 1 }
]
```

## שאלות נפוצות

### איך משתמשים בתוצאה של צומת SQL?

אם נעשה שימוש בפקודת `SELECT`, תוצאת השאילתה תישמר בצומת בפורמט JSON של Sequelize. ניתן לנתח ולהשתמש בה באמצעות תוסף [JSON-query](./json-query.md).

### האם פעולת SQL מפעילה אירועי אוסף?

**לא**. פעולת ה-SQL שולחת את פקודת ה-SQL ישירות למסד הנתונים לעיבוד. פעולות `CREATE` / `UPDATE` / `DELETE` הקשורות מתרחשות במסד הנתונים, בעוד שאירועי אוסף מתרחשים בשכבת היישום של Node.js (מטופלים על ידי ה-ORM), ולכן אירועי אוסף לא יופעלו.