---
pkg: '@nocobase/plugin-workflow-aggregate'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# שאילתת אגרגציה

## מבוא

משמש לביצוע שאילתות פונקציות אגרגציה על נתונים ב**אוסף** העונים לתנאים מסוימים, ומחזיר את התוצאות הסטטיסטיות המתאימות. הוא משמש לעיתים קרובות לעיבוד נתונים סטטיסטיים הקשורים לדוחות.

היישום של הצומת מבוסס על פונקציות אגרגציה של מסדי נתונים. נכון לעכשיו, הוא תומך רק בסטטיסטיקות על שדה בודד ב**אוסף**. התוצאה המספרית של הסטטיסטיקה תישמר בפלט של הצומת לשימוש על ידי צמתים עוקבים.

## התקנה

**תוסף** מובנה, אין צורך בהתקנה.

## יצירת צומת

בממשק התצורה של **תהליך העבודה**, לחצו על כפתור הפלוס ('+') בזרם כדי להוסיף צומת "שאילתת אגרגציה":

![יצירת צומת שאילתת אגרגציה](https://static-docs.nocobase.com/7f9d806ebf5064f80c30f8b67f316f0f.png)

## תצורת צומת

![צומת שאילתת אגרגציה_תצורת צומת](https://static-docs.nocobase.com/57362f747b9992230567c6bb5e986fd2.png)

### פונקציית אגרגציה

תומך ב-5 פונקציות אגרגציה מ-SQL: `COUNT`, `SUM`, `AVG`, `MIN` ו-`MAX`. בחרו אחת מהן לביצוע שאילתת אגרגציה על הנתונים.

### סוג יעד

ניתן לבחור את היעד של שאילתת האגרגציה בשני מצבים. האחד הוא לבחור ישירות את **אוסף** היעד ואחד מהשדות שלו. השני הוא לבחור את ה**אוסף** הקשור ביחס של אחד לרבים ואת השדה שלו, באמצעות אובייקט נתונים קיים בהקשר של **תהליך העבודה**, כדי לבצע את שאילתת האגרגציה.

### ייחודיים (Distinct)

זהו ה-`DISTINCT` ב-SQL. השדה לביטול כפילויות זהה לשדה ה**אוסף** שנבחר. בחירת שדות שונים לשניהם אינה נתמכת כרגע.

### תנאי סינון

בדומה לתנאי הסינון בשאילתת **אוסף** רגילה, ניתן להשתמש במשתני הקשר מ**תהליך העבודה**.

## דוגמה

יעד האגרגציה "נתוני **אוסף**" קל יחסית להבנה. כאן, נשתמש ב"ספירת המספר הכולל של מאמרים בקטגוריה לאחר הוספת מאמר חדש" כדוגמה כדי להציג את השימוש ביעד האגרגציה "נתוני **אוסף** מקושרים".

ראשית, צרו שני **אוספים**: "מאמרים" ו"קטגוריות". ל**אוסף** "מאמרים" יש שדה יחס מסוג רבים-לאחד המצביע על **אוסף** "קטגוריות", ונוצר גם שדה יחס הפוך מסוג אחד-לרבים מ"קטגוריות" ל"מאמרים":

| שם שדה   | סוג           |
| -------- | -------------- |
| כותרת     | טקסט בשורה בודדת       |
| קטגוריה | רבים-לאחד (קטגוריות) |

| שם שדה   | סוג           |
| -------- | -------------- |
| שם קטגוריה | טקסט בשורה בודדת     |
| מאמרים | אחד-לרבים (מאמרים) |

לאחר מכן, צרו **תהליך עבודה** המופעל על ידי אירוע **אוסף**. בחרו להפעיל אותו לאחר הוספת נתונים חדשים ל**אוסף** "מאמרים".

לאחר מכן, הוסיפו צומת שאילתת אגרגציה וקבעו את תצורתו באופן הבא:

![צומת שאילתת אגרגציה_דוגמה_תצורת צומת](https://static-docs.nocobase.com/542272e686c6c0a567373d1b37ddda78.png)

בצורה זו, לאחר הפעלת **תהליך העבודה**, צומת שאילתת האגרגציה יספור את מספר כל המאמרים בקטגוריה של המאמר שנוסף זה עתה וישמור זאת כתוצאת הצומת.

:::info{title=טיפ}
אם עליכם להשתמש בנתוני היחסים ממעורר אירועי ה**אוסף**, עליכם להגדיר את השדות הרלוונטיים בסעיף "טעינה מוקדמת של נתונים מקושרים" במעורר, אחרת לא ניתן יהיה לבחור אותם.
:::