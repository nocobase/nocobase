---
pkg: '@nocobase/plugin-workflow-request'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# בקשת HTTP

## מבוא

כאשר אתם צריכים לתקשר עם מערכת ווב אחרת, אתם יכולים להשתמש בצומת בקשת HTTP. צומת זה, בעת ביצועו, שולח בקשת HTTP לכתובת המוגדרת בהתאם לתצורה שלו. הוא יכול לשאת נתונים בפורמט JSON או `application/x-www-form-urlencoded` כדי לאפשר אינטראקציה עם מערכות חיצוניות.

אם אתם מכירים כלי שליחת בקשות כמו Postman, תוכלו לשלוט במהירות בשימוש בצומת בקשת HTTP. בניגוד לכלים אלה, כל הפרמטרים בצומת בקשת HTTP יכולים להשתמש במשתני הקשר (context variables) מתוך תהליך העבודה הנוכחי, מה שמאפשר שילוב אורגני עם תהליכים עסקיים של המערכת.

## התקנה

תוסף מובנה, אין צורך בהתקנה.

## יצירת צומת

בממשק הגדרות תהליך העבודה, לחצו על כפתור הפלוס ("+") בתהליך כדי להוסיף צומת "בקשת HTTP":

![הוספת בקשת HTTP](https://static-docs.nocobase.com/46f2a6fc3f6869c80f8fbd362a54e644.png)

## הגדרות צומת

![צומת בקשת HTTP_הגדרות](https://static-docs.nocobase.com/2fcb29af66b892fa704add52e2974a52.png)

### שיטת בקשה

שיטות בקשת HTTP אפשריות: `GET`, `POST`, `PUT`, `PATCH` ו-`DELETE`.

### כתובת URL לבקשה

כתובת ה-URL של שירות ה-HTTP, אשר חייבת לכלול את חלק הפרוטוקול (`http://` או `https://`). מומלץ להשתמש ב-`https://`.

### פורמט נתוני בקשה

זהו ה-`Content-Type` בכותרת הבקשה. לפורמטים הנתמכים, ראו את סעיף "[גוף הבקשה](#request-body)".

### הגדרות כותרת הבקשה

זוגות מפתח-ערך עבור קטע כותרת הבקשה (Header). הערכים הרלוונטיים יכולים להשתמש במשתנים מהקשר תהליך העבודה.

:::info{title=טיפ}
כותרת הבקשה `Content-Type` מוגדרת באמצעות פורמט נתוני הבקשה. אין צורך למלא אותה כאן, וכל דריסה תהיה חסרת תוקף.
:::

### פרמטרי בקשה

זוגות מפתח-ערך עבור קטע ה-query של הבקשה. הערכים הרלוונטיים יכולים להשתמש במשתנים מהקשר תהליך העבודה.

### גוף הבקשה

חלק ה-Body של הבקשה. פורמטים שונים נתמכים בהתאם ל-`Content-Type` שנבחר.

#### `application/json`

תומך בטקסט בפורמט JSON סטנדרטי. ניתן להוסיף משתנים מהקשר תהליך העבודה באמצעות כפתור המשתנים בפינה הימנית העליונה של עורך הטקסט.

:::info{title=טיפ}
משתנים חייבים לשמש בתוך מחרוזת JSON, לדוגמה: `{ "a": "{{$context.data.a}}" }`.
:::

#### `application/x-www-form-urlencoded`

פורמט זוגות מפתח-ערך. הערכים יכולים להשתמש במשתנים מהקשר תהליך העבודה. כאשר משתנים כלולים, הם יפורשו כתבנית מחרוזת וישורשרו לערך המחרוזת הסופי.

#### `application/xml`

תומך בטקסט בפורמט XML סטנדרטי. ניתן להוסיף משתנים מהקשר תהליך העבודה באמצעות כפתור המשתנים בפינה הימנית העליונה של עורך הטקסט.

#### `multipart/form-data` <Badge>v1.8.0+</Badge>

תומך בזוגות מפתח-ערך עבור נתוני טופס. ניתן להעלות קבצים כאשר סוג הנתונים מוגדר כאובייקט קובץ. קבצים ניתנים לבחירה רק באמצעות משתנים מאובייקטי קבצים קיימים בהקשר, כגון תוצאות שאילתה על אוסף קבצים, או נתונים קשורים מאוסף קבצים משויך.

:::info{title=טיפ}
בעת בחירת נתוני קובץ, ודאו שהמשתנה מתאים לאובייקט קובץ יחיד, ולא לרשימת קבצים (בשאילתת יחסים רבים-לרבים או אחד-לרבים, ערך שדה היחסים יהיה מערך).
:::

### הגדרות פסק זמן

כאשר בקשה אינה מגיבה במשך זמן רב, ניתן להשתמש בהגדרת פסק הזמן כדי לבטל את ביצועה. אם הבקשה חורגת מפסק הזמן, תהליך העבודה הנוכחי יופסק בטרם עת עם סטטוס כשל.

### התעלמות מכשלים

צומת הבקשה רואה בקודי סטטוס HTTP סטנדרטיים בין `200` ל-`299` (כולל) כסטטוס הצלחה, וכל השאר נחשבים ככישלון. אם האפשרות "התעלם מבקשות כושלות והמשך תהליך עבודה" מסומנת, הצמתים הבאים בתהליך העבודה ימשיכו להתבצע גם אם הבקשה נכשלת.

## שימוש בתוצאת התגובה

תוצאת התגובה של בקשת HTTP ניתנת לניתוח באמצעות צומת [שאילתת JSON](./json-query.md) לשימוש בצמתים הבאים.

החל מגרסה `v1.0.0-alpha.16`, שלושה חלקים מתוצאת התגובה של צומת הבקשה יכולים לשמש כמשתנים נפרדים:

*   קוד סטטוס תגובה
*   כותרות תגובה
*   נתוני תגובה

![צומת בקשת HTTP_שימוש בתוצאת תגובה](https://static-docs.nocobase.com/20240529110610.png)

קוד סטטוס התגובה הוא בדרך כלל קוד סטטוס HTTP סטנדרטי בצורה מספרית, כגון `200`, `403` וכו' (כפי שסופק על ידי נותן השירות).

כותרות התגובה (Response headers) הן בפורמט JSON. הן הכותרות והן נתוני התגובה בפורמט JSON עדיין דורשים ניתוח באמצעות צומת JSON לפני שניתן יהיה להשתמש בהם.

## דוגמה

לדוגמה, אנו יכולים להשתמש בצומת הבקשה כדי להתחבר לפלטפורמת ענן לשליחת הודעות SMS. תצורת API לשליחת SMS בענן יכולה להיראות כך (יהיה עליכם לעיין בתיעוד ה-API הספציפי כדי להתאים את הפרמטרים):

![צומת בקשת HTTP_הגדרות](https://static-docs.nocobase.com/20240515124004.png)

כאשר תהליך העבודה מפעיל צומת זה, הוא יקרא ל-API של שירות ה-SMS עם התוכן המוגדר. אם הבקשה תצליח, תישלח הודעת SMS דרך שירות ה-SMS בענן.