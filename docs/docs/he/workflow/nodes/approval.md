---
pkg: '@nocobase/plugin-workflow-approval'
---
:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::


# אישור

## מבוא

בתהליך עבודה של אישור, יש צורך להשתמש בצומת "אישור" ייעודי כדי להגדיר את הלוגיקה התפעולית למאשרים לטפל (לאשר, לדחות או להחזיר) באישור שהופעל. צומת "אישור" יכול לשמש רק בתהליכי אישור.

:::info{title=טיפ}
ההבדל מצומת "טיפול ידני" רגיל: צומת "טיפול ידני" רגיל מיועד לתרחישים כלליים יותר, כגון הזנת נתונים ידנית או קבלת החלטות ידנית לגבי המשך התהליך בסוגים שונים של תהליכי עבודה. "צומת אישור" הוא צומת טיפול מיוחד המיועד אך ורק לתהליכי אישור, הוא מטפל רק בנתונים של האישור שהופעל, ולא ניתן להשתמש בו בתהליכי עבודה אחרים.
:::

## יצירת צומת

לחצו על כפתור הפלוס ("+") בתהליך, הוסיפו צומת "אישור", ולאחר מכן בחרו באחד ממצבי המעבר כדי ליצור את צומת האישור:

![יצירת צומת אישור](https://static-docs.nocobase.com/20251107000938.png)

## תצורת צומת

### מצב מעבר

קיימים שני מצבי מעבר:

1.  **מצב מעבר ישיר**: משמש בדרך כלל לתהליכים פשוטים יותר. אם צומת האישור עובר או לא, זה רק קובע אם התהליך מסתיים. אם הוא לא עובר, התהליך יוצא ישירות.

    ![צומת אישור_מצב מעבר_מעבר ישיר](https://static-docs.nocobase.com/20251107001043.png)

2.  **מצב הסתעפות**: משמש בדרך כלל ללוגיקת נתונים מורכבת יותר. לאחר שצומת האישור מפיק תוצאה כלשהי, ניתן להמשיך לבצע צמתים אחרים בתוך ענף התוצאה שלו.

    ![צומת אישור_מצב מעבר_מצב הסתעפות](https://static-docs.nocobase.com/20251107001234.png)

    לאחר שצומת זה "אושר", בנוסף לביצוע ענף המעבר, גם התהליך הבא ימשיך. לאחר פעולת "דחייה", כברירת מחדל ניתן גם להמשיך את התהליך הבא, או שניתן להגדיר בצומת לסיים את התהליך לאחר ביצוע הענף.

:::info{title=טיפ}
לא ניתן לשנות את מצב המעבר לאחר יצירת הצומת.
:::

### מאשרים

המאשרים הם קבוצת המשתמשים האחראים לפעולת האישור של צומת זה. זה יכול להיות משתמש אחד או יותר. המקור לבחירה יכול להיות ערך סטטי שנבחר מרשימת המשתמשים, או ערך דינמי המצוין על ידי משתנה:

![צומת אישור_מאשרים](https://static-docs.nocobase.com/20251107001433.png)

בעת בחירת משתנה, ניתן לבחור רק את המפתח הראשי או מפתח זר של נתוני משתמש מההקשר ומתוצאות הצומת. אם המשתנה הנבחר הוא מערך במהלך הביצוע (יחס של אחד-לרבים), אזי כל משתמש במערך ימוזג לקבוצת המאשרים כולה.

בנוסף לבחירה ישירה של משתמשים או משתנים, ניתן גם לסנן באופן דינמי משתמשים מתאימים כמאשרים, בהתבסס על תנאי שאילתה של אוסף המשתמשים:

![תצורת מאשרים לפי שאילתה](https://static-docs.nocobase.com/20251107001703.png)

### מצב הסכמה

אם יש רק מאשר אחד בזמן הביצוע הסופי (כולל המקרה לאחר הסרת כפילויות של משתנים מרובים), ללא קשר למצב ההסכמה שנבחר, רק משתמש זה יבצע את פעולת האישור, והתוצאה תיקבע אך ורק על ידו.

כאשר ישנם מספר משתמשים בקבוצת המאשרים, בחירת מצבי הסכמה שונים מייצגת שיטות טיפול שונות:

1.  **כל אחד**: מספיק שאדם אחד יאשר כדי שהצומת יעבור, ורק אם כולם ידחו, הצומת יידחה.
2.  **חתימה משותפת**: כולם חייבים לאשר כדי שהצומת יעבור, ודי שאדם אחד ידחה כדי שהצומת יידחה.
3.  **הצבעה**: מספר האנשים שמאשרים חייב לעלות על יחס מוגדר כדי שהצומת יעבור; אחרת, הצומת יידחה.

לגבי פעולת ההחזרה, בכל מצב, אם משתמש כלשהו בקבוצת המאשרים מטפל בה כהחזרה, אזי הצומת יצא ישירות מהתהליך.

### סדר טיפול

באופן דומה, כאשר ישנם מספר משתמשים בקבוצת המאשרים, בחירת סדרי טיפול שונים מייצגת שיטות טיפול שונות:

1.  **מקביל**: כל המאשרים יכולים לטפל בכל סדר שהוא; סדר הטיפול אינו משנה.
2.  **סדרתי**: המאשרים מטפלים ברצף לפי הסדר בקבוצת המאשרים. המאשר הבא יכול לטפל רק לאחר שהקודם לו הגיש.

בין אם מוגדר "סדרתי" ובין אם לאו, התוצאה שנוצרת לפי סדר הטיפול בפועל תפעל גם לפי הכללים ב"מצב הסכמה" שהוזכר לעיל. הצומת ישלים את ביצועו ברגע שיתקיימו התנאים המתאימים.

### יציאה מתהליך העבודה לאחר סיום ענף הדחייה

כאשר "מצב מעבר" מוגדר ל"מצב הסתעפות", ניתן לבחור לצאת מתהליך העבודה לאחר סיום ענף הדחייה. לאחר סימון אפשרות זו, יופיע סימן "✗" בסוף ענף הדחייה, המציין כי צמתים עוקבים לא ימשיכו לאחר סיום ענף זה:

![צומת אישור_יציאה לאחר דחייה](https://static-docs.nocobase.com/20251107001839.png)

### תצורת ממשק מאשרים

תצורת ממשק המאשרים משמשת כדי לספק ממשק פעולה למאשרים כאשר תהליך עבודה של אישור מגיע לצומת זה. לחצו על כפתור התצורה כדי לפתוח את החלון הקופץ:

![צומת אישור_תצורת ממשק_חלון קופץ](https://static-docs.nocobase.com/20251107001958.png)

בחלון הקופץ של התצורה, ניתן להוסיף בלוקים כגון תוכן הגשה מקורי, פרטי אישור, טופס טיפול וטקסט הנחיה מותאם אישית:

![צומת אישור_תצורת ממשק_הוספת בלוקים](https://static-docs.nocobase.com/20251107002604.png)

#### תוכן הגשה מקורי

בלוק פרטי תוכן האישור הוא בלוק הנתונים שהוגש על ידי היוזם. בדומה לבלוק נתונים רגיל, ניתן להוסיף רכיבי שדות מטבלת הנתונים ולסדר אותם בחופשיות כדי לארגן את התוכן שהמאשרים צריכים לראות:

![צומת אישור_תצורת ממשק_בלוק פרטים](https://static-docs.nocobase.com/20251107002925.png)

#### טופס טיפול

בבלוק טופס הפעולה, ניתן להוסיף כפתורי פעולה הנתמכים על ידי צומת זה, כולל "אישור", "דחייה", "החזרה", "העברה" ו"הוספת חותם":

![צומת אישור_תצורת ממשק_בלוק טופס פעולה](https://static-docs.nocobase.com/20251107003015.png)

בנוסף, ניתן להוסיף לטופס הפעולה שדות שניתנים לשינוי על ידי המאשר. שדות אלו יוצגו בטופס הפעולה כאשר המאשר מטפל באישור. המאשר יכול לשנות את ערכי השדות הללו, ולאחר ההגשה, גם הנתונים לאישור וגם תמונת המצב של הנתונים המתאימים בתהליך האישור יעודכנו בו זמנית.

![צומת אישור_תצורת ממשק_טופס פעולה_שינוי שדות תוכן אישור](https://static-docs.nocobase.com/20251107003206.png)

#### "אישור" ו"דחייה"

מבין כפתורי פעולת האישור, "אישור" ו"דחייה" הן פעולות מכריעות. לאחר ההגשה, הטיפול של המאשר בצומת זה הושלם. שדות נוספים שיש למלא בעת ההגשה, כגון "הערה", ניתן להוסיף בחלון הקופץ "תצורת טיפול" של כפתור הפעולה.

![צומת אישור_תצורת ממשק_טופס פעולה_תצורת טיפול](https://static-docs.nocobase.com/20251107003314.png)

#### "החזרה"

"החזרה" היא גם פעולה מכרעת. בנוסף לאפשרות להגדיר הערות, ניתן גם להגדיר צמתים שניתן להחזיר אליהם:

![צומת אישור_תצורת ממשק_החזרה_צמתים להחזרה](https://static-docs.nocobase.com/20251107003555.png)

#### "העברה" ו"הוספת חותם"

"העברה" ו"הוספת חותם" הן פעולות לא מכריעות, המשמשות להתאמה דינמית של המאשרים בתהליך האישור. "העברה" היא למסור את משימת האישור של המשתמש הנוכחי למשתמש אחר לטיפול. "הוספת חותם" היא להוסיף מאשר לפני או אחרי המאשר הנוכחי, והמאשר החדש ימשיך את תהליך האישור יחד.

לאחר הפעלת כפתורי הפעולה "העברה" או "הוספת חותם", יש לבחור "טווח הקצאת עובדים" בתפריט התצורה של הכפתור כדי להגדיר את טווח המשתמשים שניתן להקצות כמאשרים חדשים:

![צומת אישור_תצורת ממשק_טופס פעולה_טווח הקצאת עובדים](https://static-docs.nocobase.com/20241226232321.png)

בדומה לתצורת המאשרים המקורית של הצומת, טווח הקצאת העובדים יכול להיות גם מאשרים שנבחרו ישירות, או מבוסס על תנאי שאילתה של אוסף המשתמשים. בסופו של דבר הוא ימוזג לקבוצה אחת, ולא יכלול משתמשים שכבר נמצאים בקבוצת המאשרים.

:::warning{title=חשוב}
אם כפתור פעולה הופעל או בוטל, או אם טווח הקצאת העובדים שונה, עליכם לשמור את תצורת הצומת לאחר סגירת החלון הקופץ של תצורת ממשק הפעולה. אחרת, השינויים בכפתור הפעולה לא ייכנסו לתוקף.
:::

## תוצאת צומת

לאחר השלמת האישור, הסטטוס והנתונים הרלוונטיים יתועדו בתוצאת הצומת, וניתן להשתמש בהם כמשתנים על ידי צמתים עוקבים.

![תוצאת צומת](https://static-docs.nocobase.com/20250614095052.png)

### סטטוס אישור צומת

מייצג את סטטוס הטיפול של צומת האישור הנוכחי. התוצאה היא ערך מנייה.

### נתונים לאחר אישור

אם המאשר שינה את תוכן האישור בטופס הפעולה, הנתונים ששונו יתועדו בתוצאת הצומת, לשימוש על ידי צמתים עוקבים. אם יש צורך להשתמש בשדות יחס, יש להגדיר טעינה מוקדמת עבור שדות היחס בטריגר.

### רשומות אישור

> v1.8.0+

רשומת טיפול האישור היא מערך, המכיל את רשומות הטיפול של כל המאשרים בצומת זה. כל רשומת טיפול כוללת את השדות הבאים:

| שדה | סוג | תיאור |
| --- | --- | --- |
| `id` | `number` | מזהה ייחודי לרשומת הטיפול |
| `userId` | `number` | מזהה המשתמש שטיפל ברשומה זו |
| `status` | `number` | סטטוס טיפול |
| `comment` | `string` | הערה בזמן הטיפול |
| `updatedAt` | `string` | זמן עדכון רשומת הטיפול |

ניתן להשתמש בשדות אלו כמשתנים בצמתים עוקבים לפי הצורך.