:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::

# שימוש במשתנים

## מושגי יסוד

בדומה למשתנים בשפות תכנות, **משתנים** בתהליך עבודה הם כלי חשוב לחיבור וארגון תהליכים.

כאשר כל צומת מבוצע לאחר הפעלת תהליך עבודה, חלק מפריטי התצורה יכולים להשתמש במשתנים. מקור המשתנים הללו הוא הנתונים מהצמתים הקודמים (upstream) של הצומת הנוכחי, והם כוללים את הקטגוריות הבאות:

- נתוני הקשר של ההפעלה (Trigger context data): במקרים כמו הפעלות פעולה (action triggers) או הפעלות אוסף (collection triggers), אובייקט נתונים של שורה בודדת יכול לשמש כמשתנה על ידי כל הצמתים. הפרטים הספציפיים משתנים בהתאם ליישום של כל טריגר.
- נתוני צומת קודם: כאשר התהליך מגיע לכל צומת, אלו נתוני התוצאה של הצמתים שהושלמו קודם לכן.
- משתנים מקומיים: כאשר צומת נמצא בתוך מבני ענף מיוחדים, הוא יכול להשתמש במשתנים מקומיים ספציפיים לאותו ענף. לדוגמה, במבנה לולאה, ניתן להשתמש באובייקט הנתונים של כל איטרציה.
- משתני מערכת: פרמטרים מובנים של המערכת, כגון השעה הנוכחית.

השתמשנו בתכונת המשתנים מספר פעמים ב[תחילת העבודה](../getting-started.md). לדוגמה, בצומת חישוב, אנו יכולים להשתמש במשתנים כדי להתייחס לנתוני הקשר של ההפעלה לצורך חישובים:

![צומת חישוב המשתמש בפונקציות ומשתנים](https://static-docs.nocobase.com/837e4851a4c70a1932542caadef3431b.png)

בצומת עדכון, השתמשו בנתוני הקשר של ההפעלה כמשתנה עבור תנאי הסינון, והתייחסו לתוצאה של צומת החישוב כמשתנה עבור ערך השדה שיש לעדכן:

![משתני צומת עדכון נתונים](https://static-docs.nocobase.com/2e147c934c70a1932542caadef3431b.png)

## מבנה נתונים

משתנה הוא מבנה JSON פנימי, ובדרך כלל ניתן להשתמש בחלק ספציפי מהנתונים באמצעות נתיב ה-JSON שלו. מכיוון שמשתנים רבים מבוססים על מבנה ה**אוסף** של NocoBase, נתוני קשר (association data) יהיו בנויים היררכית כתכונות אובייקט, וייצרו מבנה דמוי עץ. לדוגמה, אנו יכולים לבחור את הערך של שדה ספציפי מנתוני הקשר של הנתונים שנשאלו. בנוסף, כאשר לנתוני הקשר יש מבנה 'רבים לרבים' (to-many), המשתנה עשוי להיות מערך.

בעת בחירת משתנה, לרוב יהיה עליכם לבחור את תכונת הערך ברמה האחרונה, שהיא בדרך כלל טיפוס נתונים פשוט כמו מספר או מחרוזת. עם זאת, כאשר יש מערך בהיררכיית המשתנים, התכונה ברמה האחרונה תמופה גם היא למערך. רק אם הצומת המתאים תומך במערכים, ניתן יהיה לעבד את נתוני המערך כראוי. לדוגמה, בצומת חישוב, למנועי חישוב מסוימים יש פונקציות המטפלות במערכים באופן ספציפי. דוגמה נוספת היא בצומת לולאה, שבו אובייקט הלולאה יכול להיות גם מערך.

לדוגמה, כאשר צומת שאילתה שולף מספר פריטי נתונים, תוצאת הצומת תהיה מערך המכיל מספר שורות של נתונים הומוגניים:

```json
[
  {
    "id": 1,
    "title": "Title 1"
  },
  {
    "id": 2,
    "title": "Title 2"
  }
]
```

עם זאת, כאשר משתמשים בו כמשתנה בצמתים הבאים, אם המשתנה שנבחר הוא בצורה `Node data/Query node/Title`, תקבלו מערך הממופה לערכי השדות המתאימים:

```json
["Title 1", "Title 2"]
```

אם מדובר במערך רב-ממדי (כגון שדה קשר רבים-לרבים), תקבלו מערך חד-ממדי עם השדה המתאים משוטח (flattened).

## משתני מערכת מובנים

### שעת המערכת

מקבל את שעת המערכת ברגע ביצוע הצומת. אזור הזמן של שעה זו הוא אזור הזמן שהוגדר בשרת.

### פרמטרי טווח תאריכים

ניתן להשתמש בהם בעת הגדרת תנאי סינון לשדות תאריך בצמתי שאילתה, עדכון ומחיקה. הם נתמכים רק עבור השוואות 'שווה ל-'. גם נקודת ההתחלה וגם נקודת הסיום של טווח התאריכים מבוססות על אזור הזמן שהוגדר בשרת.

![פרמטרי טווח תאריכים](https://static-docs.nocobase.com/20240817175354.png)