:::tip
מסמך זה תורגם על ידי בינה מלאכותית. לכל אי דיוק, אנא עיין ב[גרסה האנגלית](/en)
:::

# סוכן AI · Viz: מדריך הגדרת תרחיש CRM


# סוכן AI · Viz: מדריך הגדרת תרחיש CRM

> באמצעות דוגמת ה-CRM, למדו כיצד לגרום לאנליסט התובנות מבוסס ה-AI שלכם להבין באמת את העסק שלכם ולממש את מלוא הפוטנציאל שלו.

## 1. מבוא: לגרום ל-Viz לעבור מ"לראות נתונים" ל"להבין עסקים"

בתוך מערכת NocoBase, **Viz** הוא אנליסט תובנות AI מובנה.
הוא יכול לזהות את הקשר הדף (כמו לידים, הזדמנויות, חשבונות), ולייצר גרפי מגמה, גרפי משפך וכרטיסי KPI.
אך כברירת מחדל, הוא מחזיק רק ביכולות השאילתה הבסיסיות ביותר:

| כלי | תיאור פונקציה | אבטחה |
| --- | --- | --- |
| Get Collection Names | קבלת רשימת אוספים | ✅ מאובטח |
| Get Collection Metadata | קבלת מבנה שדות | ✅ מאובטח |

כלים אלה מאפשרים ל-Viz רק "לזהות מבנה", אך עדיין לא "להבין תוכן" באמת.
כדי לאפשר לו לייצר תובנות, לזהות חריגות ולנתח מגמות, עליכם **להרחיב אותו עם כלי ניתוח מתאימים יותר**.

בהדגמת ה-CRM הרשמית, השתמשנו בשתי שיטות:

*   **Overall Analytics (מנוע ניתוח כללי)**: פתרון מבוסס תבניות, מאובטח וניתן לשימוש חוזר;
*   **SQL Execution (מנוע ניתוח מיוחד)**: מציע גמישות רבה יותר אך כרוך בסיכונים גדולים יותר.

אלה אינן האפשרויות היחידות; הן דומות יותר ל**פרדיגמת עיצוב**:

> אתם יכולים לעקוב אחר העקרונות שלה כדי ליצור יישום המתאים יותר לעסק שלכם.

---

## 2. המבנה של Viz: אישיות יציבה + משימות גמישות

כדי להבין כיצד להרחיב את Viz, עליכם קודם כל להבין את העיצוב הפנימי השכבתי שלו:

| שכבה | תיאור | דוגמה |
| --- | --- | --- |
| **הגדרת תפקיד** | האישיות ושיטת הניתוח של Viz: הבנה ← שאילתה ← ניתוח ← ויזואליזציה | קבוע |
| **הגדרת משימה** | הנחיות מותאמות אישית ושילובי כלים עבור תרחיש עסקי ספציפי | ניתן לשינוי |
| **הגדרת כלי** | הגשר של Viz לקריאה למקורות נתונים חיצוניים או לתהליכי עבודה | ניתן להחלפה חופשית |

עיצוב שכבות זה מאפשר ל-Viz לשמור על אישיות יציבה (לוגיקת ניתוח עקבית), ובמקביל להסתגל במהירות לתרחישים עסקיים שונים (CRM, ניהול בתי חולים, ניתוח ערוצים, תפעול ייצור...).

---

## 3. דפוס ראשון: מנוע ניתוח מבוסס תבניות (מומלץ)

### 3.1 עקרונות כלליים

**Overall Analytics** הוא מנוע הניתוח המרכזי בהדגמת ה-CRM.
הוא מנהל את כל שאילתות ה-SQL באמצעות **אוסף תבניות ניתוח נתונים (data_analysis)**.
Viz אינו כותב SQL ישירות, אלא **קורא לתבניות מוגדרות מראש** כדי לייצר תוצאות.

זרימת הביצוע היא כדלקמן:

```mermaid
flowchart TD
    A[Viz מקבל משימה] --> B[קורא לתהליך עבודה של Overall Analytics]
    B --> C[מתאים תבנית בהתבסס על הדף/משימה הנוכחיים]
    C --> D[מבצע SQL של תבנית (קריאה בלבד)]
    D --> E[מחזיר תוצאת נתונים]
    E --> F[Viz מייצר תרשים + פרשנות קצרה]
```

בדרך זו, Viz יכול לייצר תוצאות ניתוח מאובטחות וסטנדרטיות תוך שניות, ומנהלי מערכת יכולים לנהל ולבדוק באופן מרכזי את כל תבניות ה-SQL.

---

### 3.2 מבנה אוסף התבניות (data_analysis)

| שם שדה | סוג | תיאור | דוגמה |
| --- | --- | --- | --- |
| **id** | Integer | מפתח ראשי | 1 |
| **name** | Text | שם תבנית ניתוח | Leads Data Analysis |
| **collection** | Text | אוסף מקביל | Lead |
| **sql** | Code | הצהרת SQL לניתוח (קריאה בלבד) | `SELECT stage, COUNT(*) FROM leads GROUP BY stage` |
| **description** | Markdown | תיאור או הגדרת תבנית | "ספירת לידים לפי שלב" |
| **createdAt / createdBy / updatedAt / updatedBy** | שדה מערכת | פרטי ביקורת | נוצר אוטומטית |

#### דוגמאות לתבניות בהדגמת ה-CRM

| שם | אוסף | תיאור |
| --- | --- | --- |
| Account Data Analysis | Account | ניתוח נתוני חשבונות |
| Contact Data Analysis | Contact | ניתוח אנשי קשר |
| Leads Data Analysis | Lead | ניתוח מגמות לידים |
| Opportunity Data Analysis | Opportunity | משפך שלבי הזדמנויות |
| Task Data Analysis | Todo Tasks | סטטיסטיקת מצב משימות לביצוע |
| Users (Sales Reps) Data Analysis | Users | השוואת ביצועי נציגי מכירות |

---

### 3.3 יתרונות דפוס זה

| מימד | יתרון |
| --- | --- |
| **אבטחה** | כל ה-SQL מאוחסן ונבדק, מונע יצירת שאילתות ישירות. |
| **תחזוקה** | תבניות מנוהלות באופן מרכזי ומתעדכנות באופן אחיד. |
| **שימושיות חוזרת** | אותה תבנית יכולה לשמש למספר משימות. |
| **ניידות** | ניתן להעביר בקלות למערכות אחרות, דורש רק את אותו מבנה אוסף. |
| **חווית משתמש** | משתמשים עסקיים אינם צריכים לדאוג ל-SQL; הם רק צריכים ליזום בקשת ניתוח. |

> 📘 אוסף `data_analysis` זה לא חייב להיקרא בשם זה.
> המפתח הוא: **לאחסן לוגיקת ניתוח באופן מבוסס תבניות**, ולקרוא לה באופן אחיד על ידי תהליך עבודה.

---

### 3.4 כיצד לגרום ל-Viz להשתמש בזה

בהגדרת המשימה, אתם יכולים לומר ל-Viz במפורש:

```markdown
היי Viz,

אנא נתחו את הנתונים של המודול הנוכחי.

**עדיפות:** השתמשו בכלי Overall Analytics כדי לקבל תוצאות ניתוח מאוסף התבניות.
**אם לא נמצאה תבנית מתאימה:** ציינו כי חסרה תבנית והציעו למנהל המערכת להוסיף אחת.

דרישות פלט:
- צרו תרשים נפרד עבור כל תוצאה;
- כללו תיאור קצר של 2–3 משפטים מתחת לתרשים;
- אל תמציאו נתונים או הנחות.
```

בדרך זו, Viz יקרא אוטומטית לתהליך העבודה, יתאים את ה-SQL המתאים ביותר מאוסף התבניות וייצר את התרשים.

---

## 4. דפוס שני: מפעיל SQL מיוחד (יש להשתמש בזהירות)

### 4.1 תרחישים ישימים

כאשר אתם זקוקים לניתוח חקרני, שאילתות אד-הוק, או אגרגציות JOIN של מספר אוספים, אתם יכולים לגרום ל-Viz לקרוא לכלי **SQL Execution**.

מאפייני כלי זה הם:

*   Viz יכול לייצר שאילתות `SELECT` ישירות;
*   המערכת מבצעת ומחזירה את התוצאה;
*   Viz אחראי על הניתוח והוויזואליזציה.

משימה לדוגמה:

> "אנא נתחו את מגמת שיעורי המרת הלידים לפי אזור במהלך 90 הימים האחרונים."

במקרה זה, Viz עשוי לייצר:

```sql
SELECT region, COUNT(id) AS leads, SUM(converted)::float/COUNT(id) AS rate
FROM leads
WHERE created_at > now() - interval '90 day'
GROUP BY region;
```

---

### 4.2 סיכונים והמלצות הגנה

| נקודת סיכון | אסטרטגיית הגנה |
| --- | --- |
| יצירת פעולות כתיבה | הגבלה כפויה ל-`SELECT` |
| גישה לאוספים לא קשורים | אימות קיום שם האוסף |
| סיכון ביצועים עם אוספים גדולים | הגבלת טווח זמן, שימוש ב-LIMIT למספר שורות |
| עקיבות פעולות | הפעלת רישום שאילתות וביקורת |
| בקרת הרשאות משתמש | רק מנהלי מערכת יכולים להשתמש בכלי זה |

> המלצות כלליות:
>
> *   משתמשים רגילים צריכים להפעיל רק ניתוח מבוסס תבניות (Overall Analytics);
> *   רק מנהלי מערכת או אנליסטים בכירים צריכים להיות מורשים להשתמש ב-SQL Execution.

---

## 5. אם אתם רוצים לבנות "Overall Analytics" משלכם

להלן גישה כללית ופשוטה שאתם יכולים לשכפל לכל מערכת (ללא תלות ב-NocoBase):

### שלב 1: עיצוב אוסף התבניות

שם האוסף יכול להיות כל דבר (לדוגמה, `analysis_templates`).
הוא רק צריך לכלול את השדות: `name`, `sql`, `collection`, ו-`description`.

### שלב 2: כתיבת שירות או תהליך עבודה של "קבל תבנית ← בצע"

לוגיקה:

1.  קבלת המשימה או הקשר הדף (לדוגמה, האוסף הנוכחי);
2.  התאמת תבנית;
3.  ביצוע ה-SQL של התבנית (קריאה בלבד);
4.  החזרת מבנה נתונים סטנדרטי (שורות + שדות).

### שלב 3: לגרום ל-AI לקרוא לממשק זה

הנחיית המשימה יכולה להיכתב כך:

```
אנא קראו תחילה לכלי ניתוח התבניות. אם לא נמצא ניתוח תואם בתבניות, השתמשו במפעיל ה-SQL.
אנא ודאו שכל השאילתות הן לקריאה בלבד וצרו תרשימים להצגת התוצאות.
```

> בדרך זו, מערכת סוכן ה-AI שלכם תהיה בעלת יכולות ניתוח דומות להדגמת ה-CRM, אך תהיה עצמאית לחלוטין וניתנת להתאמה אישית.

---

## 6. שיטות עבודה מומלצות והמלצות עיצוב

| המלצה | תיאור |
| --- | --- |
| **תעדוף ניתוח מבוסס תבניות** | מאובטח, יציב וניתן לשימוש חוזר |
| **SQL Execution רק כתוספת** | מוגבל לניפוי באגים פנימי או שאילתות אד-הוק |
| **תרשים אחד, נקודה מרכזית אחת** | פלט ברור, הימנעו מעומס יתר |
| **שמות תבניות ברורים** | שם לפי דף/תחום עסקי, לדוגמה, `Leads-Stage-Conversion` |
| **הסברים תמציתיים וברורים** | לוו כל תרשים בסיכום של 2–3 משפטים |
| **ציינו כאשר חסרה תבנית** | הודיעו למשתמש "לא נמצאה תבנית מתאימה" במקום פלט ריק |

---

## 7. מהדגמת ה-CRM לתרחיש שלכם

בין אם אתם עוסקים ב-CRM לבתי חולים, ייצור, לוגיסטיקת מחסנים או גיוס סטודנטים, כל עוד אתם יכולים לענות על שלוש השאלות הבאות, Viz יכול להביא ערך למערכת שלכם:

| שאלה | דוגמה |
| --- | --- |
| **1. מה אתם רוצים לנתח?** | מגמות לידים / שלבי עסקה / שיעור ניצול ציוד |
| **2. היכן הנתונים?** | איזה אוסף, אילו שדות |
| **3. כיצד אתם רוצים להציג זאת?** | גרף קווי, משפך, עוגה, טבלת השוואה |

ברגע שהגדרתם את התכנים הללו, אתם רק צריכים:

*   לכתוב את לוגיקת הניתוח לאוסף התבניות;
*   לצרף את הנחיית המשימה לדף;
*   ו-Viz יוכל "להשתלט" על ניתוח הדוחות שלכם.

---

## 8. סיכום: קחו את הפרדיגמה איתכם

"Overall Analytics" ו-"SQL Execution" הם רק שתי דוגמאות ליישום.
חשוב יותר הוא הרעיון שמאחוריהם:

> **לגרום לסוכן ה-AI להבין את הלוגיקה העסקית שלכם, ולא רק לבצע הנחיות.**

בין אם אתם משתמשים ב-NocoBase, במערכת פרטית, או בתהליך עבודה שכתבתם בעצמכם, אתם יכולים לשכפל מבנה זה:

*   תבניות מרוכזות;
*   קריאות מתהליכי עבודה;
*   ביצוע קריאה בלבד;
*   הצגת AI.

בדרך זו, Viz אינו עוד רק "AI שיכול לייצר תרשימים", אלא אנליסט אמיתי שמבין את הנתונים שלכם, את ההגדרות שלכם ואת העסק שלכם.