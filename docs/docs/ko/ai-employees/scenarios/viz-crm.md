
:::tip
이 문서는 AI로 번역되었습니다. 부정확한 내용이 있을 경우 [영어 버전](/en)을 참조하세요
:::


# AI 직원 · Viz: CRM 시나리오 설정 가이드

> CRM 예시를 통해 AI 인사이트 분석가가 비즈니스를 진정으로 이해하고 잠재력을 최대한 발휘하도록 돕는 방법을 알아보세요.

## 1. 서론: Viz가 '데이터 보기'를 넘어 '비즈니스 이해'로 나아가도록 돕기

NocoBase 시스템에서 **Viz**는 사전 구축된 AI 인사이트 분석가입니다.
Viz는 페이지 컨텍스트(예: 리드, 기회, 계정)를 인식하여 추세 차트, 깔때기형 차트, KPI 카드를 생성할 수 있습니다.
하지만 기본적으로 Viz는 가장 기본적인 쿼리 기능만 가지고 있습니다.

| 도구                      | 기능 설명           | 보안성  |
| ----------------------- | --------------- | ---- |
| Get Collection Names    | 컬렉션 목록 가져오기    | ✅ 안전 |
| Get Collection Metadata | 필드 구조 가져오기      | ✅ 안전 |

이러한 도구들은 Viz가 '구조를 인식'하는 데만 도움을 줄 뿐, '내용을 진정으로 이해'하지는 못합니다.
Viz가 인사이트를 생성하고, 이상 징후를 발견하며, 추세를 분석하도록 하려면 **더 적합한 분석 도구를 확장**해야 합니다.

공식 CRM 데모에서는 두 가지 방식을 사용했습니다.

*   **Overall Analytics (범용 분석 엔진)**: 템플릿화되어 안전하고 재사용 가능한 솔루션입니다.
*   **SQL Execution (특정 분석 엔진)**: 자유도가 높지만, 그만큼 위험도 큽니다.

이 두 가지가 유일한 옵션은 아니며, 오히려 **디자인 패러다임**에 가깝습니다.

> 이 원리를 따라 비즈니스에 더 적합한 구현을 만들 수 있습니다.

---

## 2. Viz의 구조: 안정적인 페르소나 + 유연한 작업

Viz를 확장하는 방법을 이해하려면 먼저 Viz의 내부가 계층적으로 설계되어 있다는 것을 알아야 합니다.

| 계층       | 설명                                    | 예시         |
| -------- | ------------------------------------- | ---------- |
| **역할 정의** | Viz의 페르소나 및 분석 방법: 이해 → 쿼리 → 분석 → 시각화 | 고정         |
| **작업 정의** | 특정 비즈니스 시나리오에 맞춘 프롬프트 및 도구 조합        | 수정 가능      |
| **도구 구성** | Viz가 외부 데이터 소스 또는 워크플로우를 호출하는 연결 다리 | 자유롭게 교체 가능 |

이러한 계층적 설계 덕분에 Viz는 안정적인 개성(일관된 분석 로직)을 유지하면서,
동시에 다양한 비즈니스 시나리오(CRM, 병원 관리, 채널 분석, 생산 운영 등)에 빠르게 적응할 수 있습니다.

## 3. 패턴 1: 템플릿 기반 분석 엔진 (권장)

### 3.1 원리 개요

**Overall Analytics**는 CRM 데모의 핵심 분석 엔진입니다.
이 엔진은 **데이터 분석 템플릿 컬렉션(data_analysis)**을 통해 모든 SQL 쿼리를 관리합니다.
Viz는 SQL을 직접 작성하지 않고, **미리 정의된 템플릿을 호출**하여 결과를 생성합니다.

실행 흐름은 다음과 같습니다.

```mermaid
flowchart TD
    A[Viz, 작업 수신] --> B[Overall Analytics 워크플로우 호출]
    B --> C[현재 페이지/작업에 따라 템플릿 매칭]
    C --> D[템플릿 SQL 실행 (읽기 전용)]
    D --> E[데이터 결과 반환]
    E --> F[Viz, 차트 생성 + 간략한 해석]
```

이러한 방식으로 Viz는 몇 초 내에 안전하고 표준화된 분석 결과를 생성할 수 있으며,
관리자는 모든 SQL 템플릿을 중앙에서 관리하고 검토할 수 있습니다.

---

### 3.2 템플릿 컬렉션 구조 (data_analysis)

| 필드명                                               | 타입       | 설명            | 예시                                                 |
| ------------------------------------------------- | -------- | ------------- | -------------------------------------------------- |
| **id**                                            | Integer  | 기본 키           | 1                                                  |
| **name**                                          | Text     | 분석 템플릿 이름      | Leads Data Analysis                                |
| **collection**                                    | Text     | 해당 컬렉션         | Lead                                               |
| **sql**                                           | Code     | 분석 SQL 문 (읽기 전용) | `SELECT stage, COUNT(*) FROM leads GROUP BY stage` |
| **description**                                   | Markdown | 템플릿 설명 또는 정의   | "단계별 리드 수 통계"                                        |
| **createdAt / createdBy / updatedAt / updatedBy** | 시스템 필드    | 감사 정보         | 자동 생성                                               |

#### CRM 데모의 템플릿 예시

| 이름                             | 컬렉션      | 설명             |
| -------------------------------- | ----------- | -------------- |
| Account Data Analysis            | Account     | 계정 데이터 분석     |
| Contact Data Analysis            | Contact     | 연락처 분석        |
| Leads Data Analysis              | Lead        | 리드 추세 분석     |
| Opportunity Data Analysis        | Opportunity | 기회 단계 깔때기     |
| Task Data Analysis               | Todo Tasks  | 할 일 상태 통계    |
| Users (Sales Reps) Data Analysis | Users       | 영업 담당자 성과 비교 |

---

### 3.3 이 패턴의 장점

| 측면       | 장점                               |
| -------- | -------------------------------- |
| **보안성**  | 모든 SQL이 저장되고 검토되므로, 직접 쿼리를 생성하는 것을 방지합니다. |
| **유지보수성** | 템플릿을 중앙에서 관리하고 일괄적으로 업데이트합니다.        |
| **재사용성**  | 동일한 템플릿을 여러 작업에서 재사용할 수 있습니다.       |
| **이식성**  | 동일한 컬렉션 구조만 있다면 다른 시스템으로 쉽게 마이그레이션할 수 있습니다. |
| **사용자 경험** | 비즈니스 사용자는 SQL에 대해 신경 쓸 필요 없이 분석 요청만 하면 됩니다. |

> 📘 이 `data_analysis` 컬렉션의 이름이 반드시 이럴 필요는 없습니다.
> 핵심은 **분석 로직을 템플릿 형태로 저장**하고, 워크플로우가 이를 일괄적으로 호출하는 것입니다.

---

### 3.4 Viz가 이를 사용하도록 하는 방법

작업 정의에서 Viz에게 다음과 같이 명확하게 지시할 수 있습니다.

```markdown
Viz님,

현재 모듈의 데이터를 분석해 주세요.

**우선 사용:** Overall Analytics 도구를 사용하여 템플릿 컬렉션에서 분석 결과를 가져오세요.
**일치하는 템플릿을 찾지 못한 경우:** 템플릿이 없음을 알리고 관리자에게 추가를 제안하세요.

출력 요구 사항:
- 각 결과에 대해 개별 차트를 생성합니다.
- 차트 아래에 2~3문장의 간략한 설명을 추가합니다.
- 데이터를 조작하거나 가설을 세우지 않습니다.
```

이렇게 하면 Viz는 워크플로우를 자동으로 호출하여 템플릿 컬렉션에서 가장 적합한 SQL을 매칭하고 차트를 생성합니다.

---

## 4. 패턴 2: 특정 SQL 실행기 (주의해서 사용)

### 4.1 적용 시나리오

탐색적 분석, 임시 쿼리 또는 여러 컬렉션 JOIN 집계가 필요할 때 Viz가 **SQL Execution** 도구를 호출하도록 할 수 있습니다.

이 도구의 특징은 다음과 같습니다.

*   Viz가 `SELECT` 쿼리를 직접 생성할 수 있습니다.
*   시스템이 실행 후 결과를 반환합니다.
*   Viz가 분석 및 시각화를 담당합니다.

예시 작업:

> "지난 90일 동안 지역별 리드 전환율 변화 추세를 분석해 주세요."

이 경우 Viz는 다음과 같은 SQL을 생성할 수 있습니다.

```sql
SELECT region, COUNT(id) AS leads, SUM(converted)::float/COUNT(id) AS rate
FROM leads
WHERE created_at > now() - interval '90 day'
GROUP BY region;
```

---

### 4.2 위험 및 보호 권장 사항

| 위험 요소         | 보호 전략                     |
| ------------- | ------------------------- |
| 쓰기 작업 생성      | `SELECT`로 강제 제한          |
| 관련 없는 컬렉션 접근 | 컬렉션 이름 존재 여부 확인        |
| 대규모 컬렉션 성능 위험 | 시간 범위 및 LIMIT 행 수 제한     |
| 작업 추적 가능성     | 쿼리 로깅 및 감사 활성화          |
| 사용자 권한 제어     | 관리자만 이 도구를 사용할 수 있음 |

> 일반적인 권장 사항:
>
> *   일반 사용자는 템플릿 기반 분석(Overall Analytics)만 활성화합니다.
> *   관리자 또는 고급 분석가만 SQL Execution을 사용할 수 있습니다.

---

## 5. 나만의 "Overall Analytics"를 구축하고 싶다면

다음은 NocoBase에 의존하지 않고 어떤 시스템에도 복제할 수 있는 간단하고 일반적인 접근 방식입니다.

### 단계 1: 템플릿 컬렉션 설계

컬렉션 이름은 자유롭게 지정할 수 있습니다(예: `analysis_templates`).
`name`, `sql`, `collection`, `description` 필드만 포함하면 됩니다.

### 단계 2: "템플릿 가져오기 → 실행" 서비스 또는 워크플로우 작성

로직:

1.  작업 또는 페이지 컨텍스트(예: 현재 컬렉션)를 수신합니다.
2.  템플릿을 매칭합니다.
3.  템플릿 SQL을 실행합니다(읽기 전용).
4.  표준화된 데이터 구조(행 + 필드)를 반환합니다.

### 단계 3: AI가 이 인터페이스를 호출하도록 하기

작업 프롬프트는 다음과 같이 작성할 수 있습니다.

```
먼저 템플릿 분석 도구를 호출하고, 템플릿에서 일치하는 분석을 찾지 못하면 SQL 실행기를 사용하세요.
모든 쿼리가 읽기 전용인지 확인하고, 결과를 차트로 표시하도록 생성하세요.
```

> 이렇게 하면 AI 직원 시스템이 CRM 데모와 유사한 분석 기능을 갖추게 되지만, 완전히 독립적이고 사용자 정의가 가능합니다.

---

## 6. 모범 사례 및 설계 권장 사항

| 권장 사항                  | 설명                                         |
| ---------------------- | ------------------------------------------ |
| **템플릿 기반 분석 우선**      | 안전하고 안정적이며 재사용 가능                          |
| **SQL Execution은 보충 용도로만 사용** | 내부 디버깅 또는 임시 쿼리로 제한                      |
| **하나의 차트, 하나의 핵심**     | 출력을 명확하게 하고 과도한 혼란을 피합니다.                 |
| **명확한 템플릿 이름 지정**    | 페이지/비즈니스 도메인에 따라 이름을 지정합니다(예: `Leads-Stage-Conversion`). |
| **간결하고 명확한 설명**       | 각 차트마다 2~3문장의 요약을 제공합니다.                 |
| **템플릿이 없을 경우 설명**    | 사용자에게 "해당 템플릿을 찾을 수 없습니다"라고 알리고 빈 출력을 피합니다. |

---

## 7. CRM 데모에서 당신의 시나리오로

병원 CRM, 생산 제조, 창고 물류 또는 교육 입학 등 어떤 분야에서든,
다음 세 가지 질문에 답할 수 있다면, Viz는 당신의 시스템에서 가치를 발휘할 수 있습니다.

| 질문                   | 예시                       |
| -------------------- | ------------------------ |
| **1. 무엇을 분석하고 싶으신가요?** | 리드 추세 / 거래 단계 / 장비 가동률 |
| **2. 데이터는 어디에 있나요?**    | 어떤 컬렉션, 어떤 필드인가요?      |
| **3. 어떻게 표현하고 싶으신가요?** | 꺾은선형, 깔때기형, 원형 차트, 비교표 |

이러한 내용을 정의했다면, 다음만 하면 됩니다.

*   분석 로직을 템플릿 컬렉션에 작성합니다.
*   작업 프롬프트를 페이지에 연결합니다.
*   그러면 Viz가 당신의 보고서 분석을 "인계받을" 수 있습니다.

---

## 8. 결론: 패러다임을 가져가세요

"Overall Analytics"와 "SQL Execution"은 단지 두 가지 예시 구현일 뿐입니다.
더 중요한 것은 그 이면에 있는 아이디어입니다.

> **AI 직원이 단순히 프롬프트만 실행하는 것이 아니라, 당신의 비즈니스 로직을 이해하도록 만드세요.**

NocoBase를 사용하든, 사설 시스템을 사용하든, 직접 워크플로우를 작성하든 상관없이,
이러한 구조를 복제할 수 있습니다.

*   템플릿 중앙 집중화;
*   워크플로우 호출;
*   읽기 전용 실행;
*   AI 시각화.

이렇게 하면 Viz는 더 이상 "차트를 생성하는 AI"에 그치지 않고,
당신의 데이터, 당신의 정의, 당신의 비즈니스를 이해하는 진정한 분석가가 될 것입니다.