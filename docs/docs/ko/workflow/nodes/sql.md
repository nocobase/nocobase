---
pkg: '@nocobase/plugin-workflow-sql'
---
:::tip
이 문서는 AI로 번역되었습니다. 부정확한 내용이 있을 경우 [영어 버전](/en)을 참조하세요
:::


# SQL 액션

## 소개

특정 상황에서는 위에 설명된 간단한 컬렉션 액션 노드만으로는 복잡한 작업을 처리하기 어려울 수 있습니다. 이럴 때는 SQL 노드를 직접 사용하여 데이터베이스가 복잡한 SQL 문을 직접 실행하도록 하여 데이터를 조작할 수 있습니다.

애플리케이션 외부에서 데이터베이스에 직접 연결하여 SQL 작업을 수행하는 것과 다른 점은, 워크플로우 내에서는 프로세스 컨텍스트의 변수를 SQL 문의 일부 매개변수로 활용할 수 있다는 것입니다.

## 설치

내장 플러그인이므로 별도로 설치할 필요가 없습니다.

## 노드 생성

워크플로우 설정 화면에서 흐름 내의 더하기("+"") 버튼을 클릭하여 "SQL 액션" 노드를 추가합니다.

![SQL 操作_添加](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

## 노드 설정

![SQL节点_节点配置](https://static-docs.nocobase.com/20240904002334.png)

### 데이터 소스

SQL을 실행할 데이터 소스를 선택합니다.

데이터 소스는 메인 데이터 소스, PostgreSQL 유형 등 Sequelize와 호환되는 데이터 소스와 같은 데이터베이스 유형이어야 합니다.

### SQL 내용

SQL 문을 편집합니다. 현재는 하나의 SQL 문만 지원됩니다.

편집 상자 오른쪽 상단의 변수 버튼을 사용하여 필요한 변수를 삽입할 수 있습니다. 실행 전에 이 변수들은 해당 값으로 텍스트 치환되며, 치환된 텍스트가 최종 SQL 문으로 사용되어 데이터베이스로 전송되어 쿼리가 실행됩니다.

## 노드 실행 결과

`v1.3.15-beta` 버전부터 SQL 노드 실행 결과는 순수 데이터로 구성된 배열입니다. 이전에는 쿼리 메타 정보가 포함된 Sequelize의 원시 반환 구조였습니다 (자세한 내용은 [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query)를 참조하세요).

예를 들어, 다음 쿼리를 실행하면:

```sql
select count(id) from posts;
```

`v1.3.15-beta` 이전 결과:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

`v1.3.15-beta` 이후 결과:

```json
[
    { "count": 1 }
]
```

## 자주 묻는 질문

### SQL 노드의 결과는 어떻게 사용하나요?

`SELECT` 문을 사용한 경우, 쿼리 결과는 Sequelize의 JSON 형식으로 노드에 저장됩니다. 이 결과는 [JSON-query](./json-query.md) 플러그인을 통해 파싱하여 사용할 수 있습니다.

### SQL 액션이 컬렉션 이벤트를 트리거하나요?

**아니요**. SQL 액션은 SQL 문을 데이터베이스로 직접 전송하여 처리합니다. 관련 `CREATE` / `UPDATE` / `DELETE` 작업은 모두 데이터베이스에서 발생하며, 컬렉션 이벤트는 Node.js 애플리케이션 계층(ORM 처리)에서 발생하므로 컬렉션 이벤트가 트리거되지 않습니다.