# 多条件分支 <Badge>v2.0.0+</Badge>

## 介绍

类似于编程语言中的 `switch / case` 或 `if / else if` 语句。系统将根据配置的多个条件，按顺序逐个判断，一旦满足某个条件，即执行对应分支下的流程，并跳过后续条件的判断。若所有条件均不满足，则执行“否则”分支。

## 创建节点

在工作流配置界面中，点击流程中的加号（“+”）按钮，添加“多条件分支”节点：

![创建多条件分支](https://static-docs.nocobase.com/20251123222134.png)

## 分支管理

### 默认分支

节点创建后，默认包含两个分支：

1. **条件分支**：可配置具体的判断条件。
2. **否则分支**：当所有条件分支均不满足时进入该分支，无需配置条件。

点击节点下方的“添加分支”按钮，可增加更多条件分支。

![20251123222540](https://static-docs.nocobase.com/20251123222540.png)

### 添加分支

点击“添加分支”后，新的分支将追加在“否则”分支之前。

![20251123222805](https://static-docs.nocobase.com/20251123222805.png)

### 删除分支

当存在多个条件分支时，点击分支右侧的垃圾桶图标即可删除该分支。若仅剩一个条件分支，则无法删除。

![20251123223127](https://static-docs.nocobase.com/20251123223127.png)

:::info{title=提示}
删除分支将同时删除该分支内的所有节点，请谨慎操作。

“否则”为内置分支，不可删除。
:::

## 节点配置

### 条件配置

点击分支顶部的条件名称，可编辑具体的条件内容：

![20251123223352](https://static-docs.nocobase.com/20251123223352.png)

#### 条件标签

支持自定义标签，填写后将作为条件的名称展示在流程图中。若未配置（或留空），默认按顺序显示为“条件 1”、“条件 2”等。

![20251123224209](https://static-docs.nocobase.com/20251123224209.png)

#### 运算引擎

目前支持三种引擎：

- **基础**：通过简单的逻辑比较（如等于、包含等）和“与”、“或”组合，得出判断结果。
- **Math.js**：支持 [Math.js](https://mathjs.org/) 语法的表达式计算。
- **Formula.js**：支持 [Formula.js](https://formulajs.info/) 语法的表达式计算（类似 Excel 公式）。

三种模式均支持使用流程上下文变量作为参数。

### 当所有条件均不满足时

在节点配置面板中，可设置当所有条件均不满足时的后续动作：

![20251123224348](https://static-docs.nocobase.com/20251123224348.png)

* **以失败结束工作流（默认）**：将工作流状态标记为失败，并终止流程。
* **继续执行后续节点**：完成当前节点执行后，继续执行工作流的后续节点。

:::info{title=提示}
无论选择何种处理方式，当所有条件均不满足时，流程都会先进入“否则”分支执行其中的节点。
:::

## 执行记录

在工作流的执行记录中，多条件分支节点通过不同颜色标识每个条件的判断结果：

- **绿色**：条件满足，进入该分支执行。
- **红色**：条件不满足（或计算出错），跳过该分支。
- **蓝色**：未执行判断（因前序条件已满足，故跳过后续判断）。

![20251123225455](https://static-docs.nocobase.com/20251123225455.png)

若因配置错误导致条件计算异常，除了显示为红色外，鼠标悬浮在条件名称上时，会显示具体的错误信息：

![20251123231014](https://static-docs.nocobase.com/20251123231014.png)

当条件计算发生异常时，多条件分支节点将以“出错”状态结束，并不再继续执行后续节点。
