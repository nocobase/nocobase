# 预览与保存

用于在配置面板中验证改动并将其持久化到页面。适用于数据查询、图表选项、交互事件三个面板。

![截图占位：预览与保存入口（面板底部操作区）](https://static-docs.nocobase.com/20251023232724.png)

## 操作入口
- 在任一配置面板底部，提供“预览”“保存/确定”“取消”。
- “预览”仅应用当前面板改动；“保存/确定”写入配置；“取消”丢弃当前未保存的改动。

![截图占位：面板底部操作按钮（预览/保存/取消）](https://static-docs.nocobase.com/20251023232724.png)

## 预览行为
- 临时应用改动到页面，不写入持久化。刷新页面或取消操作后，预览结果不保留。
- 数据与图表在预览时刷新：查询返回数据 → 图表重新渲染 → 事件重新绑定（如有改动）。
- 内置防抖：短时间内触发多次刷新，仅执行最后一次，避免频繁请求。
- 再次点击“预览”会覆盖上一次预览结果。

![截图占位：预览刷新示例（图表随配置更新）](https://static-docs.nocobase.com/20251023232724.png)

## 错误提示
- 查询错误或校验失败：在“查看数据”区域显示错误信息。
- 图表配置错误（Basic 映射缺失、Custom JS 抛错）：在图表区域或控制台展示错误，保持页面可操作。
- 先在“查看数据”确认列名与数据类型，再进行字段映射或编写 Custom 代码，能有效减少错误。

![截图占位：错误提示示意（结果面板/图表区）](https://static-docs.nocobase.com/20251023232724.png)

## 保存与取消
- 保存/确定：将当前面板的改动写入区块配置，并立即对页面生效。
- 取消：撤销当前面板未保存的改动，恢复到上次保存状态。
- 保存范围：
  - 数据查询：Builder 的查询参数；SQL 模式下同时保存 SQL 文本。
  - 图表选项：Basic 的类型与字段映射、属性；Custom 的 JS 文本。
  - 交互事件：事件的 JS 文本与绑定逻辑。
- 保存后，区块对所有访问者生效（取决于页面权限设置）。

![截图占位：保存成功与取消回滚示意](https://static-docs.nocobase.com/20251023232724.png)

## 推荐操作路径
- 运行查询 → 在 Table/JSON 确认列名与类型 → Basic 映射核心字段或编写 Custom → 预览验证 → 保存生效。
- 调试日志：地址栏追加 `?_debug=true` 或设置 `localStorage.setItem('nocobase.debug','1')`，便于定位问题。