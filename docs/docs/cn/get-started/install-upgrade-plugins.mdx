# 安装与升级插件

## 内置插件

NocoBase 内置插件会随内核版本自动更新，无需手动操作。

## 商业插件

详细的安装与升级方式请参考：[商业插件激活指南](https://www.nocobase.com/cn/blog/nocobase-commercial-license-activation-guide)

## 第三方插件

### 命令行方式安装插件

```bash
yarn pm pull https://github.com/nocobase/plugin-auth-cas/releases/download/v1.4.0/plugin-auth-cas-1.4.0.tgz
yarn pm pull /your/path/plugin-auth-cas-1.4.0.tgz
```

如果应用已安装该插件且需要升级，请执行：

```bash
yarn nocobase upgrade --skip-code-update
```

### 手动上传并解压

请先将插件包下载到本地，然后手动上传并解压至 `./storage/plugins` 目录。如果该插件已启用，请在上传并解压完成后执行以下命令完成插件升级。

> ⚠️ **注意**：为避免缓存问题，请在执行前确保 NocoBase 应用已停止运行。

```bash
yarn nocobase upgrade --skip-code-update
```

### 正确的插件解压方式

以下示例演示如何将插件包正确解压到指定目录：

```bash
mkdir -p /my-nocobase/storage/plugins/@nocobase/plugin-auth-cas && \
  tar -xvzf /downloads/plugin-auth-cas-1.4.0.tgz \
  -C /my-nocobase/storage/plugins/@nocobase/plugin-auth-cas \
  --strip-components=1
```

该命令会将插件解压到指定目录，并且不会产生多余的 `package` 目录层级。

```bash
/my-nocobase/storage/plugins/@nocobase/plugin-auth-cas
```

### 正确的目录结构示例

```bash
./plugin-auth-cas/dist/server/migrations/20240425200816-change-locale-module.js
./plugin-auth-cas/dist/server/auth.js
./plugin-auth-cas/client.js
./plugin-auth-cas/dist/constants.js
./plugin-auth-cas/dist/externalVersion.js
./plugin-auth-cas/dist/client/index.js
./plugin-auth-cas/dist/index.js
./plugin-auth-cas/dist/server/index.js
./plugin-auth-cas/dist/server/actions/login.js
./plugin-auth-cas/dist/server/plugin.js
./plugin-auth-cas/server.js
./plugin-auth-cas/dist/server/actions/service.js
./plugin-auth-cas/dist/locale/en-US.json
./plugin-auth-cas/dist/locale/ko_KR.json
./plugin-auth-cas/package.json
./plugin-auth-cas/dist/locale/zh-CN.json
./plugin-auth-cas/README.md
./plugin-auth-cas/README.zh-CN.md
./plugin-auth-cas/dist/server/migrations/20240425200816-change-locale-module.d.ts
./plugin-auth-cas/dist/server/auth.d.ts
./plugin-auth-cas/client.d.ts
./plugin-auth-cas/dist/constants.d.ts
./plugin-auth-cas/dist/client/index.d.ts
./plugin-auth-cas/dist/client/locale/index.d.ts
./plugin-auth-cas/dist/index.d.ts
./plugin-auth-cas/dist/server/index.d.ts
./plugin-auth-cas/dist/server/actions/login.d.ts
./plugin-auth-cas/dist/client/Options.d.ts
./plugin-auth-cas/dist/server/plugin.d.ts
./plugin-auth-cas/server.d.ts
./plugin-auth-cas/dist/server/actions/service.d.ts
./plugin-auth-cas/dist/client/SigninPage.d.ts
./plugin-auth-cas/LICENSE.txt
```
