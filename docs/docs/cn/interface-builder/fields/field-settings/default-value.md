# 默认值

## 介绍

默认值是字段在新建状态下的初始值。你可以：

- 在数据表配置字段时为其设定默认值；
- 在表单区块/筛选表单中，通过「字段值」配置默认值，并可使用常量或变量。

更多内容参考 [字段值](/interface-builder/blocks/block-settings/field-values)。

## 哪里可以设置默认值

### 数据表字段

![20240411095933](https://static-docs.nocobase.com/20240411095933.png)

### 新增表单的字段

新增表单字段的默认值统一在表单区块的「字段值」中配置。

入口：表单区块设置 → **表单设置** → **字段值**。

:::info{title=提示}
字段设置里的“默认值”入口已迁移到「表单区块设置 → 字段值」。旧入口仅用于兼容历史配置。
:::

![表单区块-字段值默认值配置](https://static-docs.nocobase.com/placeholder.png)

### 子表单的添加

无论是新增或编辑表单里的子表单字段添加的子数据都有默认值。

子表单的 Add new
![20251028163455](https://static-docs.nocobase.com/20251028163455.png)

编辑已有的数据，数据为空时也不会被默认值填充，新添加的数据才会用默认值填充。

### 关系字段的字段值配置

关系字段同样可以通过「字段值」来预设值，但不同场景的能力有所差异：

- **表单区块**：支持配置**默认值**与**固定值**，并可按条件生效；
- **筛选表单**：用于设置“默认筛选条件”，只支持**默认值**；
- **更新记录**操作：用于配置点击按钮后写入的字段值（相当于固定写入）。

更多内容参考 [字段值](/interface-builder/blocks/block-settings/field-values)。

如果是一对一或一对多关系，建议先阅读下方的注意事项，确认你的业务能接受关联关系被占用或变更的风险。

![关系字段-字段值配置示例](https://static-docs.nocobase.com/placeholder.png)

## 默认值变量

### 有哪些变量

- 当前用户；
- 当前记录，已存在的数据才有当前记录的概念；
- 当前表单，理想情况只列出表单里的字段；
- 当前项，子表单里的概念（子表单里的每一行数据对象）；
- 上级项，当前项的父级对象（例如父表单记录或上一级关联对象）；
- URL参数
  更多关于变量内容参考 [变量](/interface-builder/variables)

### 字段默认值变量

分为非关系字段和关系字段两类。

#### 关系字段默认值变量

- 变量对象必须是 collection 记录；
- 必须是继承链路上的表，可以是当前表，也可以是父子表；
- 「表单选中记录」变量仅限于「多对多」和「一对多/多对一」关系字段里可用；
- **多层级时，需要拍平并去重处理**

```typescript
// 表格选中记录：
[{id:1},{id:2},{id:3},{id:4}]

// 表格选中记录/对一：
[{对一: {id:2}}, {对一: {id:3}}, {对一: {id:3}}]
// 拍平并去重
[{id: 2}, {id: 3}]

// 表格选中记录/对多：
[{对多: [{id: 1}, {id:2}]}, {对多: [{id:3}, {id:4}]}]
// 拍平
[{id:1},{id:2},{id:3},{id:4}]
```

#### 非关系默认值变量

- 类型一致或兼容，如字符串兼容数字，和所有有提供 toString 方法的对象；
- JSON 字段比较特殊，什么数据都可以存；

### 字段层级（可选字段）

![20240411101157](https://static-docs.nocobase.com/20240411101157.png)

- 非关系默认值变量
  - 多层级选择字段时，仅限于对一的关系，不支持对多的关系；
  - JSON 字段比较特殊，可以不限制；

- 关系默认值变量
  - hasOne，只支持对一关系；
  - hasMany，对一（内部转换）和对多都可以；
  - belongsToMany，对一（内部转换）和对多都可以；
  - belongsTo，一般为对一，当父级关系为 hasMany 时，也支持对多（因为 hasMany/belongsTo 实质就是多对多关系）；

## 特殊情况说明

### 「多对多」等价于「一对多/多对一」组合

模型

![20240411101558](https://static-docs.nocobase.com/20240411101558.png)

### 为什么给一对一和一对多配置字段值需要谨慎？

当前版本支持在表单区块的「字段值」中为一对一/一对多关系字段配置字段值（默认值或固定值）。但这类关系通常具有**排他性**：同一条关联记录只能被一个记录占用。

当你给这类字段设置字段值时，可能出现：

- **关联被“抢占”**：如果多个新建记录都指向同一条关联记录，后保存的记录可能会占用该关联，导致之前记录的关联被解除或被改写；
- **数据变化不易察觉**：字段值可能让关联关系在不经意间发生变化，尤其在多人同时创建、批量新增时更容易踩坑；
- **固定值风险更高**：固定值在满足条件时会强制写入，可能覆盖用户原本选择的关联对象。

建议：

- 需要用户明确选择的关系字段，尽量**不要配置固定的字段值**；
- 如果必须预填，优先使用“当前用户 / 上级项”等变量生成更符合业务的初始值，避免指向同一条固定记录；
- 启用后，建议在提交前检查关系字段是否符合预期。

### 子表单/子表格中配置关系字段值的注意事项

子表单/子表格也支持通过「字段值」为字段配置字段值。默认值只会在你**新增一行/新增一项**时填充到该行，不会回填已有数据。

需要注意：

- 如果给关系字段配置了“固定的字段值”（例如总是关联到同一个客户/标签），每次新增行都会带入同一个关联对象，容易造成**重复关联**或**误关联**；
- 子表单/子表格包含多列字段，建议把字段值理解为“**新行某一列字段的初始值/固定值**”，避免把它当成整个子表格的全局设置；
- 使用固定值时，同样可能覆盖用户在该行里手动选择的结果。

建议：

- 仅在你确认“每一行都应该带同一个默认关联/固定关联”时再配置；
- 更常见的做法是结合变量（如“上级项”）从父级带入，或让用户在新增行时手动选择。
