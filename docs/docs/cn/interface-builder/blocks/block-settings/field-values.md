# 字段值

## 介绍

「字段值」用于在界面配置中**预先为字段设置值**，并统一管理“默认值”与“固定值”等配置。

常见场景包括：

- **表单区块**：为新增表单字段设置默认值，或在条件满足时写入固定值；
- **筛选表单**：设置默认筛选条件（打开页面后自动填充筛选表单）；
- **更新记录**等操作：预设点击按钮后要保存/更新的字段值。

:::info{title=提示}
字段值支持使用 **常量 / 变量 / RunJS / 空值** 作为值来源。变量用法参考 [变量](/interface-builder/variables)。
:::

## 在哪里配置

### 表单区块

入口：开启配置模式 → 选中表单区块 → 区块设置 → **表单设置** → **字段值**。

![表单区块设置-表单设置-字段值入口](https://static-docs.nocobase.com/placeholder.png)

### 筛选表单

入口：开启配置模式 → 选中筛选表单 → 区块设置 → **表单设置** → **字段值**。

说明：

- 筛选表单的字段值用于“默认筛选条件”，只支持**默认值**；
- 配置后，打开页面时会自动填充筛选表单，并按配置刷新目标区块。

![筛选表单设置-表单设置-字段值入口](https://static-docs.nocobase.com/placeholder.png)

### 更新记录操作

入口：开启配置模式 → 选中「更新记录」操作 → 操作设置 → **字段值**。

配置后，用户点击按钮时会按照这里配置的字段值更新当前记录。

![更新记录操作设置-字段值入口与配置](https://static-docs.nocobase.com/placeholder.png)

## 默认值与固定值

### 默认值

- **可修改**：用户仍然可以手动修改；
- **仅用于新增对象**：通常只在新增数据时自动填充；
- **不覆盖用户已修改的值**：用户输入后，不会被后续的默认值重新覆盖；
- **编辑表单说明**：编辑表单的顶层字段不会应用默认值；子表单/子表格仅对**新增行/新增项**应用默认值。

### 固定值

- **由系统写入**：用于把某个值“固定”写入字段；
- **可能覆盖当前值**：规则触发时会覆盖字段当前值（包括用户输入）；

## 如何配置字段值

以表单区块为例，配置步骤如下：

1. 进入 **字段值**；
2. 点击“新增”添加一条规则；
3. 选择要设置的字段；
4. 选择赋值方式：**默认值** 或 **固定值**；
5. 选择值来源：**常量 / 变量 / RunJS / 空值**；
6. （可选）配置生效条件；
7. 保存配置。

![字段值编辑器-整体界面](https://static-docs.nocobase.com/placeholder.png)

![字段值编辑器-默认值与固定值切换](https://static-docs.nocobase.com/placeholder.png)

![字段值编辑器-变量选择](https://static-docs.nocobase.com/placeholder.png)

![字段值编辑器-RunJS编辑器](https://static-docs.nocobase.com/placeholder.png)

![字段值编辑器-条件配置示例](https://static-docs.nocobase.com/placeholder.png)

## 子表单/子表格：当前项 / 上级项 / 索引

在子表单/子表格等“列表项”场景中，可以使用以下变量来更精确地配置字段值：

- **当前项**：表示子表单/子表格的“当前行数据对象”；
- **上级项**：表示当前项的父级对象（例如父表单记录，或上一级关联对象）；
- **索引（从0开始）**：当前项在列表中的位置，可用于按行号计算或区分不同项。

**示例 1：给子表单新增行设置默认值**

- 目标：子表单新增一行时，自动把“创建人/负责人”等字段预填为当前用户；
- 配置：在字段值中选择目标字段 → 赋值方式选择“默认值” → 值来源选择“当前用户”。

**示例 2：从父表单带值到子表单**

- 目标：子表单中某字段默认等于父表单的某字段（例如“客户”“项目”）；
- 配置：值来源选择“上级项”，并选择对应字段。

![变量-当前项上级项索引展示](https://static-docs.nocobase.com/placeholder.png)

![子表单-默认值从上级项取值示例](https://static-docs.nocobase.com/placeholder.png)

## 优先级与常见问题

### 优先级

如果同一字段同时配置了：

- 表单/筛选表单的「字段值」；以及
- 「字段联动规则」中的“赋值”动作；

则以**联动规则的赋值**为准（优先级更高）。

### 为什么编辑表单默认值不生效？

默认值主要用于“新增对象”，避免在编辑已有数据时覆盖已有内容。编辑表单中仅子表单/子表格的新增行会应用默认值。

### 如何清空字段值？

在值来源中选择“空值”，保存即可。

### 规则顺序

多条规则按顺序执行，后面的规则可能覆盖前面的结果。建议把更具体、更高优先级的规则放在后面。
