---
title: Playground（MDX + 代码预览）
---

# Playground（MDX + 代码预览）

本页为 Rspress v2 的 MDX + 官方 Preview 插件示例，支持“代码 + 运行结果”联动预览。

目标：直接从 `@nocobase/client` 引入并渲染一个最小可运行示例，参考 dumi 的交互与上下文。注意不要依赖已废弃的 `ctx.currentFlow`，使用 `ctx.view` / `ctx.viewer` / `ctx.view.navigation` 等推荐方式进行交互。

## 预览示例

> 下方代码来自 dumi 示例精简版，基于前端 FlowEngine，点击按钮后在抽屉中打开子页面，并在子页面中选择上下文变量。

```tsx preview iframe
import React from 'react';
import { Application, Plugin, PluginFlowEngine, MockFlowModelRepository } from '@nocobase/client';
import { FlowModel, FlowModelRenderer, FlowContextSelector, useFlowContext, useFlowView } from '@nocobase/flow-engine';
import { Button, Card, Space } from 'antd';

class OpenViewDemoModel extends FlowModel {
  render() {
    return (
      <Card title="ctx.openView：打开子页面1122">
        <Space>
          <Button
            onClick={() =>
              this.context.openView('demo-open-view', {
                mode: 'drawer',
                size: 'medium',
                pageModelClass: 'OpenViewContentModel',
                navigation: false,
                defineProperties: {
                  someContext: {
                    value: { name: '演示数据', email: 'demo@example.com' },
                    meta: {
                      title: '新定义上下文1221',
                      type: 'object',
                      properties: {
                        name: { title: '名称', type: 'string' },
                        email: { title: '邮箱', type: 'string' },
                      },
                    },
                  },
                },
              })
            }
          >
            打开抽屉
          </Button>
        </Space>
      </Card>
    );
  }
}

class OpenViewContentModel extends FlowModel {
  render() {
    return <OpenViewContent />;
  }
}

const OpenViewContent: React.FC = () => {
  const ctx = useFlowContext();
  const view = useFlowView();
  const [value, setValue] = React.useState('');

  return (
    <div style={{ padding: 24 }}>
      <view.Header title={`新定义上下文`} />
      <Space direction="vertical" style={{ width: '100%' }}>
        <FlowContextSelector
          value={value}
          onChange={(val) => setValue(val)}
          metaTree={() => ctx.getPropertyMetaTree()}
          style={{ width: 360 }}
          showSearch
        >
          <Button type="primary">选择上下文变量</Button>
        </FlowContextSelector>
      </Space>
    </div>
  );
};

class PluginDemo extends Plugin {
  async load() {
    this.flowEngine.flowSettings.forceEnable();
    this.flowEngine.registerModels({ OpenViewDemoModel, OpenViewContentModel });
    const repo = new MockFlowModelRepository('demo-open-view:');
    await repo.clear();
    this.flowEngine.setModelRepository(repo);

    const model = this.flowEngine.createModel({ use: 'OpenViewDemoModel' });
    this.router.add('root', {
      path: '/',
      element: <FlowModelRenderer model={model} />,
    });
  }
}

const app = new Application({
  router: { type: 'memory', initialEntries: ['/'] },
  plugins: [PluginFlowEngine, PluginDemo],
});
export default app.getRootComponent();
```

## 说明与已知事项

- 预览通过 `@rspress/plugin-preview` 在 iframe 中独立构建运行，确保了隔离性。
- 为避免 less 处理问题，`@nocobase/client` 在文档中通过别名指向其 ESM 产物目录（`packages/core/client/es`）。
- FlowEngine 使用包根目录（由包内 `main` 指向 `lib`），便于直接调试（`packages/core/flow-engine`）。
- 若你需要在示例中进行父子视图交互，请通过 `ctx.view.inputArgs` 显式传参、`ctx.view.update`/`ctx.view.close` 控制交互，避免任何 `ctx.currentFlow` 依赖。

## 相关链接

- Rspress MDX 组件示例：参见官方文档
- Rspress Preview 插件：参见官方文档
