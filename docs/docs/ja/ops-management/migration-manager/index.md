---
pkg: '@nocobase/plugin-migration-manager'
---
:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::



# 移行マネージャー

## はじめに

移行マネージャーは、「アプリケーション設定」をあるアプリケーション環境から別のアプリケーション環境へ移行するために使用します。移行マネージャーは「アプリケーション設定」の移行に重点を置いています。もし完全なデータ移行が必要な場合は、「[バックアップマネージャー](../backup-manager/index.mdx)」のバックアップと復元機能のご利用をお勧めします。

## インストール

[バックアップマネージャー](../backup-manager/index.mdx) プラグインに依存しています。バックアップマネージャーがすでにインストールされ、有効化されていることをご確認ください。

## 処理と原理

メインデータベースのテーブルとデータを、移行ルールに基づいて、あるアプリケーションから別のアプリケーションへ移行します。外部データベースやサブアプリケーションのデータは移行されない点にご注意ください。

![20250102202546](https://static-docs.nocobase.com/20250102202546.png)

## 移行ルール

### 組み込みルール

移行マネージャーはメインデータベース内のすべてのテーブルの移行に対応しており、現在以下の5つのルールをサポートしています。

-   **スキーマのみ**: テーブルの構造（スキーマ）のみを移行し、データの挿入や更新は行いません。
-   **上書き（クリアして再挿入）**: ターゲットとなるデータベーステーブルから既存のすべてのレコードを削除し、新しいデータを挿入します。
-   **挿入または更新（Upsert）**: 各レコードが主キーによって存在するかどうかを確認します。存在する場合はそのレコードを更新し、存在しない場合は挿入します。
-   **重複を無視して挿入（Insert-ignore）**: 新しいレコードを挿入しますが、主キーによってレコードがすでに存在する場合は、挿入を無視します（更新は行われません）。
-   **スキップ**: テーブルの処理を完全にスキップします（構造の変更もデータの移行も行いません）。

**補足:**

-   「上書き」、「挿入または更新」、「重複を無視して挿入」のいずれのルールも、テーブル構造の変更を同期します。
-   主キーが自動増分IDであるテーブル、または主キーがないテーブルには、「挿入または更新」および「重複を無視して挿入」ルールは適用できません。
-   「挿入または更新」および「重複を無視して挿入」は、主キーを使用してレコードの存在を判断します。

### 詳細設計

![20250102204909](https://static-docs.nocobase.com/20250102204909.png)

### 設定インターフェース

移行ルールの設定

![20250102205450](https://static-docs.nocobase.com/20250102205450.png)

独立したルールの有効化

![20250107105005](https://static-docs.nocobase.com/20250107105005.png)

独立したルールと、現在の独立したルールで処理されるテーブルを選択

![20250107104644](https://static-docs.nocobase.com/20250107104644.png)

## 移行ファイル

![20250102205844](https://static-docs.nocobase.com/20250102205844.png)

### 新しい移行の作成

![20250102205857](https://static-docs.nocobase.com/20250102205857.png)

### 移行の実行

![20250102205915](https://static-docs.nocobase.com/20250102205915.png)

アプリケーション環境変数のチェック（[環境変数](#)について詳しくはこちら）

![20250102212311](https://static-docs.nocobase.com/20250102212311.png)

もし不足している環境変数があれば、ポップアップが表示され、ここで必要な新しい環境変数を入力してから続行するようユーザーに促されます。

![20250102210009](https://static-docs.nocobase.com/20250102210009.png)

## 移行ログ

![20250102205738](https://static-docs.nocobase.com/20250102205738.png)

## ロールバック

移行を実行する前に、現在のアプリケーションが自動的にバックアップされます。移行が失敗した場合や、結果が期待通りでなかった場合は、[バックアップマネージャー](../backup-manager/index.mdx) を使用してロールバックし、復元することができます。

![20250105195029](https://static-docs.nocobase.com/20250105195029.png)