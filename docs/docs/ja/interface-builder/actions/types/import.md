---
pkg: "@nocobase/plugin-action-import"
---
:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::

# インポート

## はじめに

Excelテンプレートを使ってデータをインポートできます。どのフィールドをインポートするか設定でき、テンプレートは自動で生成されます。

![20251029165818](https://static-docs.nocobase.com/20251029165818.png)

## インポート手順

### 数値型フィールド

数値とパーセンテージに対応しています。`N/A` や `-` といったテキストはフィルタリングされます。

| 数値1 | パーセンテージ | 数値2 | 数値3 |
| ----- | ------ | ----- | ----- |
| 123   | 25%    | N/A   | -     |

JSONに変換後：

```ts
{
  "数字1": 123,
  "百分比": 0.25,
  "数字2": null,
  "数字3": null,
}
```

### 真偽値型フィールド

入力テキストは以下に対応しています（英語は大文字・小文字を区別しません）：

- `Yes`，`Y`，`True`，`1`，`是`
- `No`，`N`，`False`，`0`，`否`

| フィールド1 | フィールド2 | フィールド3 | フィールド4 | フィールド5 |
| ----- | ----- | ----- | ----- | ----- |
| 否    | 是    | Y     | true  | 0     |

JSONに変換後：

```ts
{
  "字段1": false,
  "字段2": true,
  "字段3": true,
  "字段4": true,
  "字段5": false,
}
```

### 日付型フィールド

| DateOnly            | ローカル(+08:00)       | GMT                 |
| ------------------- | ------------------- | ------------------- |
| 2023-01-18 22:22:22 | 2023-01-18 22:22:22 | 2023-01-18 22:22:22 |

JSONに変換後：

```ts
{
  "DateOnly": "2023-01-18T00:00:00.000Z",
  "Local(+08:00)": "2023-01-18T14:22:22.000Z",
  "GMT": "2023-01-18T22:22:22.000Z",
}
```

### 選択型フィールド

オプション値とオプションラベルの両方をインポートテキストとして使用できます。複数のオプションは、カンマ（`,` `，`）または読点（`、`）で区切ります。

例えば、`優先度` フィールドのオプションは以下の通りです：

| オプション値 | オプションラベル |
| ------ | -------- |
| low    | 低       |
| medium | 中       |
| high   | 高       |

オプション値とオプションラベルの両方をインポートテキストとして使用できます。

| 優先度 |
| ------ |
| 高     |
| low    |

JSONに変換後：

```ts
[{ 优先级: 'high' }, { 优先级: 'low' }];
```

### 中国行政区フィールド

| 地域1         | 地域2         |
| ------------- | ------------- |
| 北京市/市辖区 | 天津市/市辖区 |

JSONに変換後：

```ts
{
  "地区1": ["11","1101"],
  "地区2": ["12","1201"]
}
```

### 添付ファイルフィールド

| 添付ファイル                                     |
| ---------------------------------------- |
| https://www.nocobase.com/images/logo.png |

JSONに変換後：

```ts
{
  "附件": [
    {
      "filename": "logo.png",
      "title": "logo.png",
      "extname": ".png",
      "url": "https://www.nocobase.com/images/logo.png"
    }
  ]
}
```

### リレーション型フィールド

複数のデータは、カンマ（`,` `，`）または読点（`、`）で区切ります。

| 部署/名称 | カテゴリー/タイトル    |
| --------- | ------------ |
| 開発組    | カテゴリー1、カテゴリー2 |

JSONに変換後：

```ts
{
  "部門": [1], // 1 は「開発組」という部署名のレコードIDです
  "分類": [1,2], // 1,2 は「カテゴリー1」と「カテゴリー2」というカテゴリータイトルのレコードIDです
}
```

### JSON型フィールド

| JSON1           |
| --------------- |
| {"key":"value"} |

JSONに変換後：

```ts
{
  "JSON": {"key":"value"}
}
```

### 地図ジオメトリ型

| ポイント | ライン        | ポリゴン           | サークル |
| ----- | ----------- | ----------------- | ------ |
| 1,2   | (1,2),(3,4) | (1,2),(3,4),(1,2) | 1,2,3  |

JSONに変換後：

```ts
{
  "Point": [1,2],
  "Line": [[1,2], [3,4]],
  "Polygon": [[1,2], [3,4], [1,2]],
  "Circle": [1,2,3]
}
```

## カスタムインポート形式

`db.registerFieldValueParsers()` メソッドを使って、カスタムの `ValueParser` を登録できます。例えば、以下のようになります：

```ts
import { BaseValueParser } from '@nocobase/database';

class PointValueParser extends BaseValueParser {
  async setValue(value) {
    if (Array.isArray(value)) {
      this.value = value;
    } else if (typeof value === 'string') {
      this.value = value.split(',');
    } else {
      this.errors.push('Value invalid');
    }
  }
}

const db = new Database();

// type=point のフィールドをインポートする際、データは PointValueParser によって解析されます
db.registerFieldValueParsers({
  point: PointValueParser,
});
```

インポート例

| ポイント |
| ----- |
| 1,2   |

JSONに変換後：

```ts
{
  "Point": [1,2]
}
```

## アクション設定

![20251029170959](https://static-docs.nocobase.com/20251029170959.png)

- インポート可能なフィールドを設定します

![20251029171036](https://static-docs.nocobase.com/20251029171036.png)

- [連携ルール](/interface-builder/actions/action-settings/linkage-rule)：ボタンの動的な表示/非表示；
- [ボタンの編集](/interface-builder/actions/action-settings/edit-button)：ボタンのタイトル、タイプ、アイコンを編集します；