:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::

# 変数

## はじめに

変数は、現在のコンテキストにおける特定の値を識別するために使用される一連のトークンです。ブロックのデータ範囲、フィールドのデフォルト値、連動ルール、ワークフローなどの設定で利用できます。

![20251030114458](https://static-docs.nocobase.com/20251030114458.png)

## 現在サポートされている変数

### 現在のユーザー

現在ログインしているユーザーのデータを表します。

![20240416154950](https://static-docs.nocobase.com/20240416154950.png)

### 現在のロール

現在ログインしているユーザーのロール識別子（ロール名）を表します。

![20240416155100](https://static-docs.nocobase.com/20240416155100.png)

### 現在のフォーム

現在のフォームの値を表し、フォームブロックでのみ使用されます。主な利用シーンは以下の通りです。

- 現在のフォームの連動ルール
- フォームフィールドのデフォルト値（新規データ追加時のみ有効）
- 関連フィールドのデータ範囲設定
- 送信アクションにおけるフィールド値の割り当て設定

#### 現在のフォームの連動ルール

![20251027114920](https://static-docs.nocobase.com/20251027114920.png)

#### フォームフィールドのデフォルト値（新規フォームのみ）

![20251027115016](https://static-docs.nocobase.com/20251027115016.png)

<!-- ![20240416171129_rec_](https://static-docs.nocobase.com/20240416171129_rec_.gif) -->

#### 関連フィールドのデータ範囲設定

上位フィールドに基づいて下位フィールドの選択肢を動的にフィルタリングし、正確なデータ入力を保証するために使用されます。

**例：**

1. ユーザーが **Owner** フィールドの値を選択します。
2. システムは、選択された Owner の **userName** に基づいて、**Account** フィールドの選択肢を自動的にフィルタリングします。

![20251030151928](https://static-docs.nocobase.com/20251030151928.png)

<!-- ![20240416171743_rec_](https://static-docs.nocobase.com/20240416171743_rec_.gif) -->

<!-- #### 提交操作的字段赋值配置

![20240416171215_rec_](https://static-docs.nocobase.com/20240416171215_rec_.gif) -->

<!-- ### 当前对象

目前仅用于表单区块的子表单和子表格的字段配置，表示其每一项的值：

- 子字段的默认值
- 子关系字段的数据范围

#### 子字段的默认值

![20240416172933_rec_](https://static-docs.nocobase.com/20240416172933_rec_.gif)

#### 子关系字段的数据范围

![20240416173043_rec_](https://static-docs.nocobase.com/20240416173043_rec_.gif) -->

<!-- ### 上级对象

与「当前对象」类似，表示当前对象的父级对象。在 NocoBase v1.3.34-beta 及以上版本中支持。 -->

### 現在のレコード

レコードとは、データテーブルの行のことで、各行が1つのレコードを表します。表示系のブロックにおける**行アクションの連動ルール**では、「現在のレコード」変数が利用できます。

例：「支払い済み」の伝票では、削除ボタンを無効にします。

![20251027120217](https://static-docs.nocobase.com/20251027120217.png)

### 現在のポップアップレコード

ポップアップアクションは、NocoBaseのインターフェース設定において非常に重要な役割を果たします。

- 行アクションのポップアップ：各ポップアップには「現在のポップアップレコード」変数があり、現在の行レコードを表します。
- 関連フィールドのポップアップ：各ポップアップには「現在のポップアップレコード」変数があり、現在クリックされた関連レコードを表します。

ポップアップ内のブロックでは、「現在のポップアップレコード」変数を使用できます。関連する利用シーンは以下の通りです。

- ブロックのデータ範囲を設定する
- 関連フィールドのデータ範囲を設定する
- フィールドのデフォルト値を設定する（新規データ追加用のフォーム）
- アクションの連動ルールを設定する

<!-- #### 配置区块的数据范围

![20251027151107](https://static-docs.nocobase.com/20251027151107.png)

#### 配置关系字段的数据范围

![20240416224641_rec_](https://static-docs.nocobase.com/20240416224641_rec_.gif)

#### 配置字段的默认值（新增数据的表单）

![20240416223846_rec_](https://static-docs.nocobase.com/20240416223846_rec_.gif)

#### 配置操作的联动规则

![20240416223101_rec_](https://static-docs.nocobase.com/20240416223101_rec_.gif)

<!--
#### 表单提交操作的字段赋值配置

![20240416224014_rec_](https://static-docs.nocobase.com/20240416224014_rec_.gif) -->

<!-- ### 表格选中记录

目前仅用于表格区块的 Add record 操作的表单字段默认值

#### Add record 操作的表单字段默认值 -->

<!-- ### 父级记录（已弃用）

仅限于关系区块里使用，表示关系数据的源记录。

:::warning
「父级记录」已弃用，建议使用等价的「当前弹窗记录」代替。
:::

<!-- ### 日期变量

日期变量是一种可动态解析的日期占位符，在系统中可用于设置区块数据范围、关系字段数据范围、操作联动规则中的日期条件，以及日期字段的默认值。根据使用场景的不同，日期变量的解析方式也有所区别：在赋值场景中（如默认值设置），解析为具体的时刻；在筛选场景中（如数据范围条件），解析为时段范围，以支持更灵活的过滤。

#### 筛选场景

相关使用场景有：

- 区块数据范围的日期字段条件设置
- 关系字段的数据范围的日期字段条件设置
- 操作联动规则的日期字段条件设置

![20250522211606](https://static-docs.nocobase.com/20250522211606.png)

相关变量有：

- Current time
- Yesterday
- Today
- Tomorrow
- Last week
- This week
- Next week
- Last month
- This month
- Next month
- Last quarter
- This quarter
- Next quarter
- Last year
- This year
- Next year
- Last 7 days
- Next 7 days
- Last 30 days
- Next 30 days
- Last 90 days
- Next 90 days

#### 赋值场景

在赋值场景中，同一个日期变量会根据目标字段的类型自动解析为不同的格式。例如，当使用 Today 为不同类型的日期字段赋值时：

- 对于时间戳字段（Timestamp）和含时区的日期时间字段（DateTime with timezone），变量会解析为完整的 UTC 时间字符串，如 2024-04-20T16:00:00.000Z，包含时区信息，适用于跨时区同步需求。

- 对于无时区的日期时间字段（DateTime without timezone），变量会解析为本地时间格式字符串，如 2025-04-21 00:00:00，不带时区信息，更适合本地业务逻辑处理。

- 对于仅日期字段（DateOnly），变量会解析为纯日期字符串，如 2025-04-21，仅包含年月日，无时间部分。

系统会根据字段类型智能地解析变量，确保赋值时格式正确，避免因类型不匹配导致的数据错误或异常。

![20250522212802](https://static-docs.nocobase.com/20250522212802.png)

相关使用场景有：

- 表单区块中日期字段默认值设置
- 联动规则中日期字段属性 value 设置
- 提交按钮中的日期字段赋值

相关变量有：

- Now
- Yesterday
- Today
- Tomorrow -->

### URLクエリパラメータ

この変数は、現在のページURLに含まれるクエリパラメータを表します。ページURLにクエリ文字列が存在する場合にのみ、この変数は利用可能です。[リンクアクション](/interface-builder/actions/types/link)と組み合わせて使用すると、より便利です。

![20251027173017](https://static-docs.nocobase.com/20251027173017.png)

![20251027173121](https://static-docs.nocobase.com/20251027173121.png)

### APIトークン

この変数の値は文字列で、NocoBase APIにアクセスするための認証情報です。ユーザーの身元を確認するために使用できます。

### 現在のデバイスタイプ

例：PC以外のデバイスでは「テンプレート印刷」アクションを表示しない。

![20251029215303](https://static-docs.nocobase.com/20251029215303.png)