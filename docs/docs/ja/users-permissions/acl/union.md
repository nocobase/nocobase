---
pkg: '@nocobase/plugin-acl'
---
:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::


# ロールユニオン

ロールユニオンは権限管理モードの一つです。システム設定に応じて、システム開発者は「独立ロール」「ロールユニオンを許可」「ロールユニオンのみ」のいずれかを選択でき、さまざまな権限要件に対応できます。

![20250312184651](https://static-docs.nocobase.com/20250312184651.png)

## 独立ロール

システムはデフォルトで「独立ロール」を使用します。このモードでは、ロールユニオンは使用されず、ユーザーは自身が持つロールを個別に切り替える必要があります。

![20250312184729](https://static-docs.nocobase.com/20250312184729.png)
![20250312184826](https://static-docs.nocobase.com/20250312184826.png)

## ロールユニオンを許可

システム開発者は「ロールユニオンを許可」を有効にできます。これにより、ユーザーは自身が持つすべてのロールの権限を同時に利用できるだけでなく、ロールを個別に切り替えることも可能です。

![20250312185006](https://static-docs.nocobase.com/20250312185006.png)

## ロールユニオンのみ

このモードでは、ユーザーはロールユニオンのみを使用することが強制され、ロールを個別に切り替えることはできません。

![20250312185105](https://static-docs.nocobase.com/20250312185105.png)

## ロールユニオンのルール

ロールユニオンは、ユーザーに割り当てられたすべてのロールの中で最大の権限を付与します。以下では、複数のロールで同じ項目に設定が競合する場合に、どのようにロール権限が決定されるかを説明します。

### 操作権限のマージ

例：
ロール1（role1）は「インターフェースの設定を許可」するように設定されています。
ロール2（role2）は「プラグインのインストール、アクティベート、無効化を許可」するように設定されています。

![20250312190133](https://static-docs.nocobase.com/20250312190133.png)

![20250312190352](https://static-docs.nocobase.com/20250312190352.png)

**すべての権限**を持つロールでログインすると、ユーザーはこれら両方の権限を同時に持つことになります。

![20250312190621](https://static-docs.nocobase.com/20250312190621.png)

### データスコープのマージ

#### データ行

シナリオ1：複数のロールが同じフィールドに条件を設定する場合

ロールAの条件設定：Age < 30

| UserID | Name | Age |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBの条件設定：Age > 25

| UserID | Name | Age |
| ------ | ---- | --- |
| 2      | Lily | 29  |
| 3      | Sam  | 32  |

マージ後：

| UserID | Name | Age |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |
| 3      | Sam  | 32  |

シナリオ2：異なるロールが異なるフィールドに条件を設定する場合

ロールAの条件設定：Age < 30

| UserID | Name | Age |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBの条件設定：Nameに"Ja"を含む

| UserID | Name   | Age |
| ------ | ------ | --- |
| 1      | Jack   | 23  |
| 3      | Jasmin | 27  |

マージ後：

| UserID | Name   | Age |
| ------ | ------ | --- |
| 1      | Jack   | 23  |
| 2      | Lily   | 29  |
| 3      | Jasmin | 27  |

#### データ列

ロールAの表示フィールド設定：Name、Age

| UserID | Name | Age |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBの表示フィールド設定：Name、Sex

| UserID | Name | Sex   |
| ------ | ---- | ----- |
| 1      | Jack | Man   |
| 2      | Lily | Woman |

マージ後：

| UserID | Name | Age | Sex   |
| ------ | ---- | --- | ----- |
| 1      | Jack | 23  | Man   |
| 2      | Lily | 29  | Woman |

#### 行と列の混合

ロールAの条件設定：Age < 30、表示フィールド：Name、Age

| UserID | Name | Age |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBの条件設定：Nameに"Ja"を含む、表示フィールド：Name、Sex

| UserID | Name  | Sex   |
| ------ | ----- | ----- |
| 3      | Jade  | Woman |
| 4      | James | Man   |

マージ後：

| UserID | Name  | Age                                              | Sex                                                 |
| ------ | ----- | ------------------------------------------------ | --------------------------------------------------- |
| 1      | Jack  | 23                                               | <span style="background-color:#FFDDDD">Man</span>   |
| 2      | Lily  | 29                                               | <span style="background-color:#FFDDDD">Woman</span> |
| 3      | Jade  | <span style="background-color:#FFDDDD">27</span> | Woman                                               |
| 4      | James | <span style="background-color:#FFDDDD">31</span> | Man                                                 |

注記：背景色が赤でマークされたデータは、個別のロールでは表示されませんが、マージされたロールでは表示されるようになります。

#### まとめ

ロールマージにおけるデータスコープのルールは以下の通りです。

1.  行に関しては、いずれかの条件が満たされれば、その行にアクセス権があると判断されます。
2.  列に関しては、フィールドが追加（結合）されます。
3.  行と列が同時に設定されている場合、行と列はそれぞれ個別にマージされます。（行+列）の組み合わせとしてマージされるわけではありません。