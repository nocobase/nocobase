---
pkg: '@nocobase/plugin-auth-oidc'
---
:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::


# 認証：OIDC

## はじめに

認証：OIDC プラグインは、OIDC (Open ConnectID) プロトコル標準に準拠し、認可コードフロー (Authorization Code Flow) を使用して、サードパーティのIDプロバイダー (IdP) が提供するアカウントでNocoBaseにログインできるようにします。

## プラグインの有効化

![](https://static-docs.nocobase.com/202411122358790.png)

## OIDC認証の追加

ユーザー認証プラグインの管理ページに移動します。

![](https://static-docs.nocobase.com/202411130004459.png)

追加 - OIDC

![](https://static-docs.nocobase.com/1efbde1c0e2f4967efc1c4336be45ca2.png)

## 設定

### 基本設定

![](https://static-docs.nocobase.com/202411130006341.png)

| 設定項目                                           | 説明                                                                                                                            | バージョン     |
| :------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------ | :------------- |
| Sign up automatically when the user does not exist | 既存のユーザーと一致するアカウントが見つからない場合に、新しいユーザーを自動的に作成するかどうか。                                  | -              |
| Issuer                                             | IdPによって提供されるIssuerです。通常、`/.well-known/openid-configuration` で終わります。                                        | -              |
| Client ID                                          | クライアントIDです。                                                                                                            | -              |
| Client Secret                                      | クライアントシークレットです。                                                                                                  | -              |
| scope                                              | 任意項目です。デフォルトは `openid email profile` です。                                                                        | -              |
| id_token signed response algorithm                 | `id_token` の署名アルゴリズムです。デフォルトは `RS256` です。                                                                  | -              |
| Enable RP-initiated logout                         | RP-initiated logout を有効にします。ユーザーがログアウトした際にIdPのログイン状態もログアウトします。IdPのログアウトコールバックには、[使用](#使用方法)で提供されているPost logout redirect URLを記入してください。 | `v1.3.44-beta` |

### フィールドマッピング

![](https://static-docs.nocobase.com/92d63c8f6f4082b50d9f475674cb5650.png)

| 設定項目                        | 説明                                                                                                                 |
| :------------------------------ | :------------------------------------------------------------------------------------------------------------------- |
| Field Map                       | フィールドマッピングです。NocoBase側で現在マッピング可能なフィールドは、ニックネーム、メールアドレス、電話番号です。デフォルトではニックネームに `openid` が使用されます。 |
| Use this field to bind the user | 既存ユーザーとの紐付けに使用するフィールドです。メールアドレスまたはユーザー名を選択でき、デフォルトはメールアドレスです。IdPが提供するユーザー情報に `email` または `username` フィールドが含まれている必要があります。 |

### 高度な設定

![](https://static-docs.nocobase.com/202411130013306.png)

| 設定項目                                                          | 説明                                                                                                                                                                                     | バージョン     |
| :---------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- |
| HTTP                                                              | NocoBaseのコールバックURLがHTTPプロトコルを使用するかどうかです。デフォルトは `https` です。                                                                                             | -              |
| Port                                                              | NocoBaseのコールバックURLのポートです。デフォルトは `443/80` です。                                                                                                                    | -              |
| State token                                                       | リクエスト元を検証し、CSRF攻撃を防ぐために使用されます。固定値を入力することもできますが、**空欄にすることをお勧めします。その場合、ランダムな値が自動生成されます。固定値を使用する場合は、ご自身の利用環境とセキュリティリスクを慎重に評価してください。** | -              |
| Pass parameters in the authorization code grant exchange          | コードをトークンと交換する際に、一部のIdPがClient IDまたはClient Secretをパラメーターとして渡すことを要求する場合があります。このオプションをチェックし、対応するパラメーター名を指定できます。 | -              |
| Method to call the user info endpoint                             | ユーザー情報APIをリクエストする際のHTTPメソッドです。                                                                                                                                    | -              |
| Where to put the access token when calling the user info endpoint | ユーザー情報APIを呼び出す際にアクセストークンを渡す方法です。<br/>- Header - リクエストヘッダー（デフォルト）<br />- Body - リクエストボディ（`POST`メソッドと組み合わせて使用）<br />- Query parameters - クエリパラメーター（`GET`メソッドと組み合わせて使用） | -              |
| Skip SSL verification                                             | IdP APIをリクエストする際にSSL検証をスキップします。**このオプションを有効にすると、システムが中間者攻撃のリスクにさらされます。このオプションの目的と影響を明確に理解している場合にのみチェックしてください。本番環境でのこの設定の使用は強く推奨されません。** | `v1.3.40-beta` |

### 使用方法

![](https://static-docs.nocobase.com/202411130019570.png)

| 設定項目                 | 説明                                                                           |
| :----------------------- | :----------------------------------------------------------------------------- |
| Redirect URL             | IdPのコールバックURL設定に記入するために使用します。                           |
| Post logout redirect URL | RP-initiated logoutが有効な場合に、IdPのPost logout redirect URL設定に記入するために使用します。 |

:::info
ローカルでテストする際は、URLに `localhost` ではなく `127.0.0.1` を使用してください。OIDCログインでは、セキュリティ検証のためにクライアントのCookieにstateを書き込む必要があるためです。ログイン時にウィンドウが一瞬表示されて消え、ログインが成功しない場合は、サーバーログでstateの不一致がないか、またリクエストのCookieにstateパラメーターが含まれているかを確認してください。この状況は通常、クライアントのCookie内のstateとリクエストに含まれるstateが一致しないことが原因です。
:::

## ログイン

ログインページにアクセスし、ログインフォームの下にあるボタンをクリックしてサードパーティログインを開始します。

![](https://static-docs.nocobase.com/e493d156254c2ac0b6f6e1002e6a2e6b.png)