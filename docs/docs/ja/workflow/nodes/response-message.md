---
pkg: '@nocobase/plugin-workflow-response-message'
---
:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::

# レスポンスメッセージ

## はじめに

レスポンスメッセージノードは、特定の種類のワークフローにおいて、アクションを送信したクライアントに対し、ワークフロー内でカスタマイズされたメッセージをフィードバックとして返すために使用されます。

:::info{title=ヒント}
現在、同期モードの「操作前イベント」と「カスタムアクションイベント」タイプのワークフローでの使用に対応しています。
:::

## ノードの作成

対応しているワークフロータイプでは、ワークフロー内の任意の場所に「レスポンスメッセージ」ノードを追加できます。ワークフロー内のプラス（「+」）ボタンをクリックして、「レスポンスメッセージ」ノードを追加してください。

![ノードの追加](https://static-docs.nocobase.com/eac2b3565e95e4ce59f340624062ed3d.png)

レスポンスメッセージは、リクエスト処理全体を通して配列として存在します。ワークフロー内でレスポンスメッセージノードが実行されるたびに、新しいメッセージ内容が配列に追加されます。サーバーがレスポンス内容を送信する際、すべてのメッセージがまとめてクライアントに送信されます。

## ノードの設定

メッセージ内容は全体としてテンプレート文字列であり、変数も挿入できます。ノード設定でこのテンプレート内容を自由に構成できます。

![ノード設定](https://static-docs.nocobase.com/d5fa5f4002d50baf3ba16048818fddfc.png)

ワークフローがこのノードに到達すると、テンプレートが解析され、メッセージ内容の結果が生成されます。上記の構成では、変数「ローカル変数 / 全製品をループ / ループオブジェクト / 製品 / タイトル」は、実際のワークフローで特定の値に置き換えられます。例えば、次のようになります。

```
製品「iPhone 14 pro」の在庫が不足しています
```

![メッセージ内容](https://static-docs.nocobase.com/06bd4a6b6ec499c853f0c39987f63a6a.png)

## ワークフローの設定

レスポンスメッセージのステータスは、ワークフローの実行が成功したか失敗したかによって決まります。いずれかのノードの実行が失敗すると、ワークフロー全体が失敗します。この場合、メッセージ内容は失敗ステータスとしてクライアントに返され、表示されます。

ワークフロー内で失敗ステータスを明示的に定義する必要がある場合は、「終了ノード」を使用し、失敗ステータスに設定できます。このノードが実行されると、ワークフローは失敗ステータスで終了し、メッセージは失敗ステータスとしてクライアントに返されます。

ワークフロー全体で失敗ステータスが発生せず、最後まで正常に実行された場合、メッセージ内容は成功ステータスとしてクライアントに返されます。

:::info{title=ヒント}
ワークフロー内で複数のレスポンスメッセージノードが定義されている場合、実行されたノードはメッセージ内容を配列に追加します。最終的にクライアントに返される際、すべてのメッセージ内容がまとめて返され、表示されます。
:::

## 利用シーン

### 「操作前イベント」ワークフロー

「操作前イベント」ワークフローでレスポンスメッセージを使用すると、ワークフロー終了後にクライアントへ対応するメッセージフィードバックを送信できます。詳細は[操作前イベント](../triggers/pre-action.md)を参照してください。

### 「カスタムアクションイベント」ワークフロー

同期モードの「カスタムアクションイベント」でレスポンスメッセージを使用すると、ワークフロー終了後にクライアントへ対応するメッセージフィードバックを送信できます。詳細は[カスタムアクションイベント](../triggers/custom-action.md)を参照してください。