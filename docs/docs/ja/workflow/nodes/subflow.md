---
pkg: '@nocobase/plugin-workflow-subflow'
---
:::tip
このドキュメントはAIによって翻訳されました。不正確な情報については、[英語版](/en)をご参照ください
:::


# ワークフローの呼び出し

## はじめに

この機能は、ワークフロー内で他のワークフローを呼び出すために使用します。現在のワークフローの変数をサブワークフローの入力として利用し、サブワークフローの出力を現在のワークフローの変数として後続のノードで使用できます。

ワークフローの呼び出し処理は以下の図の通りです。

![20241230134634](https://static-docs.nocobase.com/20241230134634.png)

ワークフローを呼び出すことで、メール送信やSMS送信といった共通の処理ロジックを再利用したり、複雑なワークフローを複数のサブワークフローに分割して管理やメンテナンスを容易にしたりできます。

本質的に、ワークフローはそれがサブワークフローであるかどうかを区別しません。どのワークフローも、他のワークフローからサブワークフローとして呼び出されることも、他のワークフローを呼び出すことも可能です。すべてのワークフローは対等であり、呼び出し元と呼び出し先の関係のみが存在します。

同様に、ワークフローの呼び出しは以下の2つの場面で利用されます。

1.  メインワークフロー内：呼び出し元として、「ワークフローの呼び出し」ノードを通じて他のワークフローを呼び出します。
2.  サブワークフロー内：呼び出される側として、「ワークフロー出力」ノードを通じて現在のワークフローから出力する必要がある変数を保存します。これにより、現在のワークフローを呼び出したワークフローの後続ノードでその変数を利用できます。

## ノードの作成

ワークフロー設定画面で、ワークフロー内のプラス（「+」）ボタンをクリックし、「ワークフローの呼び出し」ノードを追加します。

![Add Invoke Workflow Node](https://static-docs.nocobase.com/20241230001323.png)

## ノードの設定

### ワークフローの選択

呼び出したいワークフローを選択します。検索ボックスを使って素早く見つけることができます。

![Select Workflow](https://static-docs.nocobase.com/20241230001534.png)

:::info{title=ヒント}
*   無効になっているワークフローもサブワークフローとして呼び出すことができます。
*   現在のワークフローが同期モードの場合、同期モードのサブワークフローのみを呼び出すことができます。
:::

### ワークフローのトリガー変数の設定

ワークフローを選択した後、サブワークフローをトリガーするための入力データとして、トリガーの変数を設定する必要があります。静的なデータを直接選択することも、現在のワークフロー内の変数を選択することも可能です。

![Configure Trigger Variables](https://static-docs.nocobase.com/20241230162722.png)

トリガーの種類によって必要な変数は異なりますので、必要に応じてフォーム上で設定を完了してください。

## ワークフロー出力ノード

[ワークフロー出力](./output.md)ノードの内容を参照し、サブワークフローの出力変数を設定します。

## ワークフロー出力の利用

メインワークフローに戻り、「ワークフローの呼び出し」ノードより下にある他のノードでサブワークフローの出力値を利用したい場合、「ワークフローの呼び出し」ノードの結果を選択できます。サブワークフローが文字列、数値、真偽値、日付（UTC形式の文字列）などの単純な値を出力する場合、そのまま直接使用できます。データソースのオブジェクトのような複雑なオブジェクトの場合、そのプロパティを使用するには、まずJSON解析ノードでマッピングを行う必要があります。そうしないと、オブジェクト全体としてしか使用できません。

サブワークフローにワークフロー出力ノードが設定されていない場合、または出力値がない場合、メインワークフローで「ワークフローの呼び出し」ノードの結果を使用しても、`null`（空値）しか取得できません。