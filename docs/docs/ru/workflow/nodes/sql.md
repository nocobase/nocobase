---
pkg: '@nocobase/plugin-workflow-sql'
---
:::tip Уведомление о переводе ИИ
Эта документация была автоматически переведена ИИ.
:::


# SQL-операция

## Введение

В некоторых особых сценариях простые узлы операций с коллекциями, упомянутые выше, могут быть неспособны обрабатывать сложные операции. В таких случаях вы можете напрямую использовать узел SQL, чтобы база данных выполняла сложные SQL-запросы для манипуляции данными.

Отличие от прямого подключения к базе данных для SQL-операций вне приложения заключается в том, что внутри рабочего процесса вы можете использовать переменные из контекста процесса в качестве параметров SQL-запроса.

## Установка

Встроенный плагин, установка не требуется.

## Создание узла

В интерфейсе настройки рабочего процесса нажмите кнопку плюса («+») в потоке, чтобы добавить узел «SQL-операция»:

![Добавить SQL-операцию](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

## Настройка узла

![Узел SQL_Настройка узла](https://static-docs.nocobase.com/20240904002334.png)

### Источник данных

Выберите источник данных для выполнения SQL-запроса.

Источник данных должен быть типа базы данных, например, основной источник данных, PostgreSQL или другие источники данных, совместимые с Sequelize.

### Содержимое SQL

Отредактируйте SQL-запрос. В настоящее время поддерживается только один SQL-запрос.

Вставьте необходимые переменные с помощью кнопки переменных в правом верхнем углу редактора. Перед выполнением эти переменные будут заменены их соответствующими значениями посредством текстовой подстановки. Полученный текст затем будет использован в качестве окончательного SQL-запроса и отправлен в базу данных для выполнения.

## Результат выполнения узла

Начиная с `v1.3.15-beta`, результатом выполнения узла SQL является массив чистых данных. До этого это была нативная структура возврата Sequelize, содержащая метаданные запроса (см.: [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query)).

Например, следующий запрос:

```sql
select count(id) from posts;
```

Результат до `v1.3.15-beta`:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

Результат после `v1.3.15-beta`:

```json
[
    { "count": 1 }
]
```

## Часто задаваемые вопросы

### Как использовать результат узла SQL?

Если используется оператор `SELECT`, результат запроса будет сохранен в узле в формате JSON Sequelize. Его можно разобрать и использовать с помощью плагина [JSON-запросов](./json-query.md).

### Вызывает ли SQL-операция события коллекции?

**Нет**. SQL-операция напрямую отправляет SQL-запрос в базу данных для обработки. Связанные операции `CREATE` / `UPDATE` / `DELETE` происходят в базе данных, в то время как события коллекции происходят на уровне приложения Node.js (обрабатываются ORM), поэтому события коллекции не будут вызываться.