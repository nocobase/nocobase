---
pkg: '@nocobase/plugin-workflow-date-calculation'
---
:::tip Уведомление о переводе ИИ
Эта документация была автоматически переведена ИИ.
:::


# Вычисление даты

## Введение

Узел Вычисление даты предоставляет девять функций для вычисления, включая добавление и вычитание периодов времени, форматирование строкового представления времени и преобразование единиц измерения длительности. Каждая функция имеет определенные типы входных и выходных значений, а также может принимать результаты других узлов в качестве переменных-параметров. Узел использует конвейер вычислений для последовательной обработки результатов настроенных функций, чтобы в конечном итоге получить ожидаемый результат.

## Создание узла

В интерфейсе настройки рабочего процесса нажмите кнопку с плюсом («+») в потоке, чтобы добавить узел «Вычисление даты»:

![Узел Вычисление даты_Создание узла](https://static-docs.nocobase.com/[图片].png)

## Настройка узла

![Узел Вычисление даты_Настройка узла](https://static-docs.nocobase.com/20240817184423.png)

### Входное значение

Входное значение может быть переменной или константой даты. Переменная может представлять данные, которые инициировали этот рабочий процесс, или результат предыдущего узла в этом рабочем процессе. В качестве константы вы можете выбрать любую дату.

### Тип входного значения

Определяет тип входного значения. Существует два возможных типа.

*   Тип «Дата»: означает, что входное значение в конечном итоге может быть преобразовано в тип даты и времени, например, числовая метка времени или строка, представляющая время.
*   Тип «Число»: поскольку тип входного значения влияет на выбор последующих шагов вычисления времени, необходимо правильно выбрать тип входного значения.

### Шаги вычисления

Каждый шаг вычисления состоит из функции вычисления и ее конфигурации параметров. Он использует конвейерную архитектуру, где результат вычисления предыдущей функции служит входным значением для следующей функции. Таким образом, можно выполнить ряд вычислений и преобразований времени.

После каждого шага вычисления тип выходного значения также фиксирован и будет влиять на функции, доступные для следующего шага вычисления. Вычисление может быть продолжено только при совпадении типов. В противном случае результат шага будет конечным выходным значением узла.

## Функции вычисления

### Добавить период времени

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Количество для добавления, может быть числом или встроенной переменной узла.
    -   Единица измерения времени.
-   Тип выходного значения: Дата
-   Пример: Если входное значение `2024-7-15 00:00:00`, количество `1`, а единица измерения — «день», то результат вычисления будет `2024-7-16 00:00:00`.

### Вычесть период времени

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Количество для вычитания, может быть числом или встроенной переменной узла.
    -   Единица измерения времени.
-   Тип выходного значения: Дата
-   Пример: Если входное значение `2024-7-15 00:00:00`, количество `1`, а единица измерения — «день», то результат вычисления будет `2024-7-14 00:00:00`.

### Вычислить разницу с другим временем

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Дата, с которой нужно вычислить разницу; может быть константой даты или переменной из контекста рабочего процесса.
    -   Единица измерения времени.
    -   Применять ли абсолютное значение.
    -   Операция округления: доступны варианты «сохранить десятичные знаки», «округлить», «округлить в большую сторону» и «округлить в меньшую сторону».
-   Тип выходного значения: Число
-   Пример: Если входное значение `2024-7-15 00:00:00`, объект сравнения `2024-7-16 06:00:00`, единица измерения — «день», абсолютное значение не применяется, а десятичные знаки сохраняются, то результат вычисления будет `-1.25`.

:::info{title=Подсказка}
Если абсолютное значение и округление настроены одновременно, сначала применяется абсолютное значение, а затем округление.
:::

### Получить значение времени в определенной единице измерения

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Единица измерения времени.
-   Тип выходного значения: Число
-   Пример: Если входное значение `2024-7-15 00:00:00`, а единица измерения — «день», то результат вычисления будет `15`.

### Установить дату на начало определенной единицы измерения

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Единица измерения времени.
-   Тип выходного значения: Дата
-   Пример: Если входное значение `2024-7-15 14:26:30`, а единица измерения — «день», то результат вычисления будет `2024-7-15 00:00:00`.

### Установить дату на конец определенной единицы измерения

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Единица измерения времени.
-   Тип выходного значения: Дата
-   Пример: Если входное значение `2024-7-15 14:26:30`, а единица измерения — «день», то результат вычисления будет `2024-7-15 23:59:59`.

### Проверить на високосный год

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Без параметров
-   Тип выходного значения: Булево
-   Пример: Если входное значение `2024-7-15 14:26:30`, то результат вычисления будет `true`.

### Форматировать как строку

-   Принимаемый тип входного значения: Дата
-   Параметры
    -   Формат, см. [Day.js: Формат](https://day.js.org/docs/zh-CN/display/format)
-   Тип выходного значения: Строка
-   Пример: Если входное значение `2024-7-15 14:26:30`, а формат `the time is YYYY/MM/DD HH:mm:ss`, то результат вычисления будет `the time is 2024/07/15 14:26:30`.

### Преобразовать единицу измерения

-   Принимаемый тип входного значения: Число
-   Параметры
    -   Единица измерения времени до преобразования.
    -   Единица измерения времени после преобразования.
    -   Операция округления: доступны варианты «сохранить десятичные знаки», «округлить», «округлить в большую сторону» и «округлить в меньшую сторону».
-   Тип выходного значения: Число
-   Пример: Если входное значение `2`, единица измерения до преобразования — «неделя», единица измерения после преобразования — «день», а десятичные знаки не сохраняются, то результат вычисления будет `14`.

## Пример

![Узел Вычисление даты_Пример](https://static-docs.nocobase.com/20240817184137.png)

Предположим, проводится рекламная акция, и мы хотим, чтобы при создании каждого товара в его поле автоматически добавлялось время окончания акции. Это время окончания должно быть установлено на 23:59:59 последнего дня недели, следующей за датой создания товара. Таким образом, мы можем создать две функции времени и запустить их в конвейерном режиме:

-   Вычислить время для следующей недели
-   Сбросить полученный результат на 23:59:59 последнего дня этой недели

Таким образом, мы получим желаемое значение времени и передадим его следующему узлу, например, узлу изменения коллекции, чтобы добавить время окончания акции в коллекцию.