---
pkg: '@nocobase/plugin-workflow-approval'
---
:::tip Уведомление о переводе ИИ
Эта документация была автоматически переведена ИИ.
:::


# Утверждение

## Введение

В рабочем процессе утверждения необходимо использовать специальный узел «Утверждение» для настройки логики операций, позволяющей утверждающим лицам обрабатывать (одобрять, отклонять или возвращать) инициированное утверждение. Узел «Утверждение» может использоваться только в процессах утверждения.

:::info{title=Подсказка}
Отличие от обычного узла «Ручная обработка»: Обычный узел «Ручная обработка» предназначен для более общих сценариев, например, для ручного ввода данных или ручного принятия решений о продолжении процесса в различных типах рабочих процессов. Узел «Утверждение» — это специализированный узел обработки, предназначенный исключительно для процессов утверждения, он обрабатывает только данные инициированного утверждения и не может использоваться в других рабочих процессах.
:::

## Создание узла

Нажмите кнопку «Плюс» («+») в рабочем процессе, добавьте узел «Утверждение», а затем выберите один из режимов прохождения, чтобы создать узел утверждения:

![Создание узла утверждения](https://static-docs.nocobase.com/20251107000938.png)

## Настройка узла

### Режим прохождения

Существует два режима прохождения:

1.  **Прямой режим**: Обычно используется для более простых процессов. Прохождение или непрохождение узла утверждения определяет только завершение процесса. В случае непрохождения процесс завершается немедленно.

    ![Режим прохождения: Прямой режим](https://static-docs.nocobase.com/20251107001043.png)

2.  **Режим ветвления**: Обычно используется для более сложной логики данных. После того как узел утверждения выдаст какой-либо результат, другие узлы могут продолжать выполняться в его ветви результатов.

    ![Режим прохождения: Режим ветвления](https://static-docs.nocobase.com/20251107001234.png)

    После «Одобрения» этого узла, помимо выполнения ветви одобрения, также будет продолжен последующий процесс. После операции «Отклонить» последующий процесс также может быть продолжен по умолчанию, или вы можете настроить узел на завершение процесса после выполнения ветви.

:::info{title=Подсказка}
Режим прохождения нельзя изменить после создания узла.
:::

### Утверждающий

Утверждающий — это набор пользователей, ответственных за действие утверждения этого узла. Это может быть один или несколько пользователей. Источник выбора может быть статическим значением, выбранным из списка пользователей, или динамическим значением, указанным переменной:

![Настройка утверждающего](https://static-docs.nocobase.com/20251107001433.png)

При выборе переменной вы можете выбрать только первичный или внешний ключ пользовательских данных из контекста и результатов узла. Если выбранная переменная является массивом во время выполнения (отношение «один ко многим»), то каждый пользователь в массиве будет объединен во весь набор утверждающих.

Помимо прямого выбора пользователей или переменных, вы также можете динамически отфильтровать подходящих пользователей в качестве утверждающих на основе условий запроса таблицы пользователей:

![20251107001703](https://static-docs.nocobase.com/20251107001703.png)

### Режим согласования

Если при окончательном выполнении утверждающий только один (включая случай после дедупликации нескольких переменных), то независимо от выбранного режима согласования, только этот пользователь будет выполнять действие утверждения, и результат будет определяться исключительно этим пользователем.

Когда в наборе утверждающих несколько пользователей, выбор различных режимов согласования представляет разные способы обработки:

1.  **Любой из них (ИЛИ)**: Если хотя бы один человек одобряет, узел считается одобренным. Узел отклоняется только в том случае, если все отклоняют.
2.  **Коллективное согласование (И)**: Все должны одобрить, чтобы узел считался одобренным. Если хотя бы один человек отклоняет, узел отклоняется.
3.  **Голосование**: Количество одобривших должно превышать установленное соотношение, чтобы узел считался одобренным; в противном случае узел отклоняется.

Что касается операции возврата, в любом режиме, если какой-либо пользователь из набора утверждающих обрабатывает ее как возврат, то узел немедленно завершит процесс.

### Порядок обработки

Аналогично, когда в наборе утверждающих несколько пользователей, выбор различных порядков обработки представляет разные способы обработки:

1.  **Параллельный**: Все утверждающие могут обрабатывать в любом порядке; последовательность обработки не имеет значения.
2.  **Последовательный**: Утверждающие обрабатывают последовательно в соответствии с порядком в наборе утверждающих. Следующий утверждающий может обрабатывать только после того, как предыдущий отправил.

Независимо от того, установлен ли «Последовательный» порядок обработки, результат, полученный в соответствии с фактическим порядком обработки, также будет следовать правилам, указанным выше в «Режиме согласования». Узел завершает свое выполнение после выполнения соответствующих условий.

### Выход из рабочего процесса после завершения ветви отклонения

Когда «Режим прохождения» установлен на «Режим ветвления», вы можете выбрать выход из рабочего процесса после завершения ветви отклонения. После установки флажка в конце ветви отклонения будет отображаться «✗», указывающий, что последующие узлы не будут продолжаться после завершения этой ветви:

![Выход после отклонения](https://static-docs.nocobase.com/20251107001839.png)

### Настройка интерфейса утверждающего

Настройка интерфейса утверждающего используется для предоставления утверждающему интерфейса операций, когда рабочий процесс утверждения достигает этого узла. Нажмите кнопку настройки, чтобы открыть всплывающее окно:

![Всплывающее окно настройки интерфейса утверждающего](https://static-docs.nocobase.com/20251107001958.png)

Во всплывающем окне настройки вы можете добавить блоки, такие как исходное содержимое отправки, информация об утверждении, форма обработки и пользовательский текст подсказки:

![Добавление блоков в интерфейс утверждающего](https://static-docs.nocobase.com/20251107002604.png)

#### Исходное содержимое отправки

Блок сведений о содержимом утверждения — это блок данных, отправленный инициатором. Подобно обычному блоку данных, вы можете произвольно добавлять компоненты полей из таблицы данных (коллекции) и произвольно их располагать, чтобы организовать содержимое, которое должен просмотреть утверждающий:

![Настройка блока сведений](https://static-docs.nocobase.com/20251107002925.png)

#### Форма обработки

В блок формы операций вы можете добавить кнопки операций, поддерживаемые этим узлом, включая «Одобрить», «Отклонить», «Вернуть», «Переназначить» и «Добавить согласующего»:

![Блок формы операций](https://static-docs.nocobase.com/20251107003015.png)

Кроме того, в форму операций можно добавить поля, которые могут быть изменены утверждающим. Эти поля будут отображаться в форме операций, когда утверждающий обрабатывает утверждение. Утверждающий может изменять значения этих полей, и после отправки будут одновременно обновлены данные для утверждения, а также снимок соответствующих данных в процессе утверждения.

![Изменение полей содержимого утверждения](https://static-docs.nocobase.com/20251107003206.png)

#### «Одобрить» и «Отклонить»

Среди кнопок операций утверждения, «Одобрить» и «Отклонить» являются решающими операциями. После отправки обработка утверждающим этого узла считается завершенной. Дополнительные поля, которые необходимо заполнить при отправке, могут быть добавлены во всплывающем окне «Настройка обработки» кнопки операции, например, «Комментарий».

![Настройка обработки](https://static-docs.nocobase.com/20251107003314.png)

#### «Вернуть»

«Вернуть» также является решающей операцией. Помимо настройки комментариев, вы также можете настроить узлы, на которые можно вернуться:

![20251107003555](https://static-docs.nocobase.com/20251107003555.png)

#### «Переназначить» и «Добавить согласующего»

«Переназначить» и «Добавить согласующего» — это нерешающие операции, используемые для динамической корректировки утверждающих в процессе утверждения. «Переназначить» означает передачу задачи утверждения текущего пользователя другому пользователю для обработки. «Добавить согласующего» означает добавление утверждающего до или после текущего утверждающего, при этом новый утверждающий будет продолжать утверждение вместе с остальными.

После включения кнопок операций «Переназначить» или «Добавить согласующего», вам необходимо выбрать «Область назначения персонала» в меню конфигурации кнопки, чтобы установить диапазон пользователей, которые могут быть назначены новыми утверждающими:

![Область назначения персонала](https://static-docs.nocobase.com/20241226232321.png)

Как и в исходной конфигурации утверждающих узла, область назначения персонала также может быть непосредственно выбранными утверждающими, или основанной на условиях запроса таблицы пользователей (коллекции). В конечном итоге она будет объединена в набор, и не будет включать пользователей, уже находящихся в наборе утверждающих.

:::warning{title=Важно}
Если кнопка операции была включена или отключена, или изменена область назначения персонала, необходимо сохранить конфигурацию этого узла после закрытия всплывающего окна настройки интерфейса операций. В противном случае изменения кнопки операции не вступят в силу.
:::

## Результат узла

После завершения утверждения, соответствующие статусы и данные будут записаны в результат узла и могут быть использованы последующими узлами в качестве переменных.

![Результат узла](https://static-docs.nocobase.com/20250614095052.png)

### Статус утверждения узла

Представляет статус обработки текущего узла утверждения. Результат является перечисляемым значением.

### Данные после утверждения

Если утверждающий изменил содержимое утверждения в форме операций, измененные данные будут записаны в результат узла для использования последующими узлами. Для использования полей связей необходимо настроить предварительную загрузку для полей связей в триггере.

### Записи утверждения

> v1.8.0+

Запись обработки утверждения — это массив, который содержит записи обработки всех утверждающих в этом узле. Каждая запись обработки включает следующие поля:

| Поле      | Тип    | Описание                                    |
| --------- | ------ | ------------------------------------------- |
| id        | number | Уникальный идентификатор записи обработки  |
| userId    | number | Идентификатор пользователя, обработавшего эту запись |
| status    | number | Статус обработки                            |
| comment   | string | Комментарий во время обработки             |
| updatedAt | string | Время обновления записи обработки          |

Вы можете использовать эти поля в качестве переменных в последующих узлах по мере необходимости.