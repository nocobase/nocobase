:::tip ุฅุดุนุงุฑ ุงูุชุฑุฌูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
ุชูุช ุชุฑุฌูุฉ ูุฐู ุงููุซุงุฆู ุชููุงุฆููุง ุจูุงุณุทุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู.
:::

# CronJobManager ุฅุฏุงุฑุฉ ุงูููุงู ุงููุฌุฏููุฉ

`CronJobManager` ูู ูุฏูุฑ ููุงู ูุฌุฏููุฉ ุชููุฑู NocoBaseุ ูุนุชูุฏ ุนูู [cron](https://www.npmjs.com/package/cron). ูุณูุญ ูุฐุง ุงููุฏูุฑ ููุฅุถุงูุงุช (Plugins) ุจุชุณุฌูู ููุงู ูุฌุฏููุฉ ุนูู ุงูุฎุงุฏู ูุชูููุฐ ููุทู ูุนูู ุจุดูู ุฏูุฑู.

## ุงูุงุณุชุฎุฏุงู ุงูุฃุณุงุณู

```ts
import { Plugin } from '@nocobase/server';

export default class PluginCronDemo extends Plugin {
  async load() {
    this.app.cronJobManager.addJob({
      cronTime: '0 0 * * *', // ุชููููุฐ ูููููุง ูู ุงูุณุงุนุฉ 00:00
      onTick: async () => {
        console.log('ูููุฉ ููููุฉ: ุชูุธูู ุงูุจูุงูุงุช ุงููุคูุชุฉ');
        await this.cleanTemporaryData();
      },
      timeZone: 'Asia/Shanghai',
      start: true, // ุจุฏุก ุชููุงุฆู
    });
  }

  async cleanTemporaryData() {
    // ูููุฐ ููุทู ุงูุชูุธูู ููุง
  }
}
```

## ูุตู ุงููุนููุงุช

ุชุนุฑูู ููุน `CronJobParameters` ูู ููุง ููู (ูู [cron](https://www.npmjs.com/package/cron)):

```ts
export declare interface CronJobParameters {
  cronTime: string | Date | DateTime;
  onTick: CronCommand;
  onComplete?: CronCommand | null;
  start?: boolean;
  timeZone?: string;
  context?: any;
  runOnInit?: boolean;
  utcOffset?: string | number;
  unrefTimeout?: boolean;
}
```

| ุงููุนููุฉ         | ุงูููุน                       | ุงููุตู                                                                                                    |
| ---------------- | -------------------------- | -------------------------------------------------------------------------------------------------------- |
| **cronTime**     | `string \| Date \| DateTime` | ุชุนุจูุฑ ุงูููุช ูููููุฉ ุงููุฌุฏููุฉ. ูุฏุนู ุชุนุจูุฑุงุช cron ุงูููุงุณูุฉุ ุนูู ุณุจูู ุงููุซุงู `0 0 * * *` ูุนูู ุงูุชูููุฐ ูููููุง ูู ุงูุณุงุนุฉ 00:00. |
| **onTick**       | `function`                 | ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ูููููุฉ. ุณูุชู ุชุดุบูููุง ูู ุงูููุช ุงููุญุฏุฏ.                                                      |
| **onComplete**   | `function`                 | ุชููููุฐ ุนูุฏูุง ุชุชููู ุงููููุฉ ุจูุงุณุทุฉ `job.stop()` ุฃู ุจุนุฏ ุงูุชูุงู ุฏุงูุฉ `onTick`.                                  |
| **timeZone**     | `string`                   | ูุญุฏุฏ ุงูููุทูุฉ ุงูุฒูููุฉ ููุชูููุฐ (ูุซู `Asia/Shanghai`).                                                      |
| **context**      | `any`                      | ุงูุณูุงู ุนูุฏ ุชูููุฐ `onTick`.                                                                               |
| **runOnInit**    | `boolean`                  | ูุง ุฅุฐุง ูุงู ุณูุชู ุงูุชูููุฐ ูุฑุฉ ูุงุญุฏุฉ ููุฑูุง ุนูุฏ ุงูุชููุฆุฉ.                                                      |
| **utcOffset**    | `string \| number`         | ูุญุฏุฏ ุฅุฒุงุญุฉ ุงูููุทูุฉ ุงูุฒูููุฉ.                                                                              |
| **unrefTimeout** | `boolean`                  | ูุชุญูู ูููุง ุฅุฐุง ูุงูุช ุญููุฉ ุงูุฃุญุฏุงุซ (event loop) ุชุจูู ูุดุทุฉ.                                                 |

## ุฃูุซูุฉ ุนูู ุชุนุจูุฑุงุช Cron

| ุงูุชุนุจูุฑ         | ุงููุนูู                      |
| -------------- | --------------------------- |
| `* * * * *`    | ุชููููุฐ ูู ุฏูููุฉ             |
| `0 * * * *`    | ุชููููุฐ ูู ุณุงุนุฉ              |
| `0 0 * * *`    | ุชููููุฐ ูููููุง ูู ุงูุณุงุนุฉ 00:00 |
| `0 9 * * 1`    | ุชููููุฐ ูู ููู ุงุซููู ูู ุงูุณุงุนุฉ 09:00 |
| `*/10 * * * *` | ุชููููุฐ ูู 10 ุฏูุงุฆู          |

> ๐ก ููููู ุงุณุชุฎุฏุงู [crontab.guru](https://crontab.guru/) ูููุณุงุนุฏุฉ ูู ุฅูุดุงุก ุงูุชุนุจูุฑุงุช.

## ุงูุชุญูู ูู ุจุฏุก ูุฅููุงู ุงูููุงู

```ts
const job = app.cronJobManager.addJob({ ... });
job.start(); // ุจุฏุก ุงููููุฉ
job.stop();  // ุฅููุงู ุงููููุฉ
```

:::tip

ุชูุดุบูู ุงูููุงู ุงููุฌุฏููุฉ ูุชุชููู ูุน ุชุดุบูู ุงูุชุทุจูู ูุฅููุงูู. ุจุดูู ุนุงูุ ูุง ุชุญุชุงุฌ ุฅูู ุจุฏุก ุฃู ุฅููุงููุง ูุฏูููุง.

:::