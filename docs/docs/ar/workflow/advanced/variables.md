:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::

# استخدام المتغيرات

## المفاهيم الأساسية

تمامًا مثل المتغيرات في لغات البرمجة، تُعد **المتغيرات** في سير العمل أداة مهمة لربط العمليات وتنظيمها.

عند تنفيذ كل عقدة بعد تشغيل سير العمل، يمكن لبعض عناصر الإعداد استخدام المتغيرات. يأتي مصدر هذه المتغيرات من بيانات العقدة السابقة (upstream) للعقدة الحالية، وتشمل الفئات التالية:

- بيانات سياق المشغّل: في حالات مثل مشغّلات الإجراءات أو مشغّلات المجموعة، يمكن استخدام كائن بيانات صف واحد كمتغير بواسطة جميع العقد. تختلف التفاصيل بناءً على تنفيذ كل مشغّل.
- بيانات العقدة السابقة: عند وصول العملية إلى أي عقدة، تكون هذه هي بيانات النتائج للعقد التي اكتملت سابقًا.
- المتغيرات المحلية: عندما تكون العقدة ضمن هياكل تفرع خاصة، يمكنها استخدام متغيرات محلية محددة داخل هذا الفرع. على سبيل المثال، في هيكل التكرار (loop)، يمكن استخدام كائن البيانات لكل تكرار.
- متغيرات النظام: بعض معلمات النظام المضمنة، مثل الوقت الحالي.

لقد استخدمنا ميزة المتغيرات عدة مرات في [البدء السريع](../getting-started.md). على سبيل المثال، في عقدة العمليات الحسابية، يمكننا استخدام المتغيرات للإشارة إلى بيانات سياق المشغّل لإجراء العمليات الحسابية:

![عقدة العمليات الحسابية تستخدم الدوال والمتغيرات](https://static-docs.nocobase.com/837e4851a4c70a1923542caadef3431b.png)

في عقدة التحديث، استخدم بيانات سياق المشغّل كمتغير لشرط التصفية، وأشر إلى نتيجة عقدة العمليات الحسابية كمتغير لقيمة الحقل المراد تحديثه:

![متغيرات عقدة تحديث البيانات](https://static-docs.nocobase.com/2e147c93643e7ebc709b9b7ab4f3af8c.png)

## هيكل البيانات

داخليًا، المتغير هو هيكل JSON، وعادةً ما يمكنك استخدام جزء معين من البيانات عبر مسار JSON الخاص به. نظرًا لأن العديد من المتغيرات تستند إلى هيكل مجموعة NocoBase، سيتم تنظيم بيانات الارتباط بشكل هرمي كخصائص للكائنات، لتشكل هيكلاً يشبه الشجرة. على سبيل المثال، يمكننا تحديد قيمة حقل معين من بيانات الارتباط للبيانات المستعلم عنها. بالإضافة إلى ذلك، عندما تكون بيانات الارتباط ذات هيكل "واحد لمتعدد" (to-many)، قد يكون المتغير مصفوفة.

عند اختيار متغير، ستحتاج في معظم الأحيان إلى تحديد خاصية القيمة في المستوى الأخير، والتي تكون عادةً من نوع بيانات بسيط مثل الأرقام أو السلاسل النصية. ولكن عندما توجد مصفوفة في التسلسل الهرمي للمتغير، سيتم تعيين الخاصية في المستوى الأخير أيضًا كمصفوفة. لا يمكن معالجة بيانات المصفوفة بشكل صحيح إلا إذا كانت العقدة المقابلة تدعم المصفوفات. على سبيل المثال، في عقدة العمليات الحسابية، تحتوي بعض محركات الحساب على دوال مخصصة لمعالجة المصفوفات. ومثال آخر هو في عقدة التكرار (loop)، حيث يمكن أن يكون كائن التكرار مصفوفة أيضًا.

على سبيل المثال، عندما تستعلم عقدة استعلام عن عدة قطع من البيانات، ستكون نتيجة العقدة مصفوفة تحتوي على صفوف متعددة من البيانات المتجانسة:

```json
[
  {
    "id": 1,
    "title": "عنوان 1"
  },
  {
    "id": 2,
    "title": "عنوان 2"
  }
]
```

ومع ذلك، عند استخدامه كمتغير في العقد اللاحقة، إذا كان المتغير المحدد على شكل `بيانات العقدة/عقدة الاستعلام/العنوان`، فستحصل على مصفوفة تم تعيينها لقيم الحقول المقابلة:

```json
["عنوان 1", "عنوان 2"]
```

إذا كانت مصفوفة متعددة الأبعاد (مثل حقل ارتباط متعدد لمتعدد)، فستحصل على مصفوفة أحادية الأبعاد بعد تسطيح الحقل المقابل.

## متغيرات النظام المضمنة

### وقت النظام

يحصل على وقت النظام لحظة تنفيذ العقدة. المنطقة الزمنية لهذا الوقت هي المنطقة الزمنية المحددة على الخادم.

### معلمات نطاق التاريخ

يمكن استخدامه عند تهيئة شروط تصفية حقل التاريخ في عقد الاستعلام والتحديث والحذف. يدعم الاستخدام فقط مع مقارنات "يساوي". تستند كل من نقطتي بداية ونهاية نطاق التاريخ إلى المنطقة الزمنية المحددة على الخادم.

![معلمات نطاق التاريخ](https://static-docs.nocobase.com/20240817175354.png)