---
pkg: '@nocobase/plugin-workflow-date-calculation'
---
:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::


# حساب التاريخ

## مقدمة

يوفر عقد حساب التاريخ تسع دوال حسابية، تتضمن إضافة فترة زمنية، وطرح فترة زمنية، وإخراج سلاسل الوقت بتنسيق معين، وتحويل وحدات المدة. تتميز كل دالة بأنواع محددة لقيم الإدخال والإخراج، كما يمكنها استقبال نتائج من عقد أخرى كمتغيرات للمعاملات. يستخدم العقد مسارًا حسابيًا لربط نتائج الدوال المكونة معًا، مما يؤدي في النهاية إلى الحصول على إخراج متوقع.

## إنشاء عقد

في واجهة إعدادات سير العمل، انقر على زر الزائد ("+") في المسار لإضافة عقد "حساب التاريخ":

![Date Calculation Node_Create Node](https://static-docs.nocobase.com/[图片].png)

## إعدادات العقد

![Date Calculation Node_Node Configuration](https://static-docs.nocobase.com/20240817184423.png)

### قيمة الإدخال

يمكن أن تكون قيمة الإدخال إما متغيرًا أو ثابت تاريخ. يمكن أن يكون المتغير هو البيانات التي أدت إلى تشغيل سير العمل هذا، أو نتيجة عقدة سابقة في سير العمل. أما الثابت، فيمكنك اختيار أي تاريخ.

### نوع قيمة الإدخال

يشير إلى نوع قيمة الإدخال، وهناك قيمتان محتملتان:

*   **نوع التاريخ:** يعني أن قيمة الإدخال يمكن تحويلها في النهاية إلى نوع تاريخ ووقت، مثل طابع زمني رقمي أو سلسلة نصية تمثل الوقت.
*   **نوع الرقم:** نظرًا لأن نوع قيمة الإدخال يؤثر على اختيار خطوات حساب الوقت التالية، فمن الضروري تحديد نوع قيمة الإدخال بشكل صحيح.

### خطوات الحساب

تتكون كل خطوة حسابية من دالة حسابية وتكوين معاملاتها. تعتمد هذه الخطوات تصميمًا متسلسلًا (pipeline)، حيث تُستخدم نتيجة حساب الدالة السابقة كقيمة إدخال لحساب الدالة التالية. بهذه الطريقة، يمكن إنجاز سلسلة من عمليات حساب وتحويل الوقت.

بعد كل خطوة حسابية، يكون نوع الإخراج ثابتًا ويؤثر على الدوال المتاحة للخطوة الحسابية التالية. لا يمكن متابعة الحساب إلا إذا كانت الأنواع متطابقة. وإلا، ستكون نتيجة الخطوة هي الإخراج النهائي للعقدة.

## دوال الحساب

### إضافة فترة زمنية

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   الكمية المراد إضافتها، يمكن أن تكون رقمًا أو متغيرًا مدمجًا من العقدة.
    -   وحدة الوقت.
-   **نوع قيمة الإخراج:** تاريخ
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 00:00:00`، والكمية هي `1`، والوحدة هي "يوم"، فإن نتيجة الحساب تكون `2024-7-16 00:00:00`.

### طرح فترة زمنية

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   الكمية المراد طرحها، يمكن أن تكون رقمًا أو متغيرًا مدمجًا من العقدة.
    -   وحدة الوقت.
-   **نوع قيمة الإخراج:** تاريخ
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 00:00:00`، والكمية هي `1`، والوحدة هي "يوم"، فإن نتيجة الحساب تكون `2024-7-14 00:00:00`.

### حساب الفرق مع وقت آخر

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   التاريخ المراد حساب الفرق معه، يمكن أن يكون ثابت تاريخ أو متغيرًا من سياق سير العمل.
    -   وحدة الوقت.
    -   هل يتم أخذ القيمة المطلقة.
    -   عملية التقريب: الخيارات تشمل الاحتفاظ بالكسور العشرية، التقريب لأقرب عدد صحيح، التقريب للأعلى، والتقريب للأسفل.
-   **نوع قيمة الإخراج:** رقم
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 00:00:00`، وكائن المقارنة هو `2024-7-16 06:00:00`، والوحدة هي "يوم"، ولا يتم أخذ القيمة المطلقة، ويتم الاحتفاظ بالكسور العشرية، فإن نتيجة الحساب تكون `-1.25`.

:::info{title=تلميح}
عندما يتم تكوين القيمة المطلقة والتقريب في نفس الوقت، يتم أخذ القيمة المطلقة أولاً، ثم يتم تطبيق التقريب.
:::

### الحصول على قيمة الوقت بوحدة محددة

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   وحدة الوقت.
-   **نوع قيمة الإخراج:** رقم
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 00:00:00` والوحدة هي "يوم"، فإن نتيجة الحساب تكون `15`.

### تعيين التاريخ إلى بداية وحدة محددة

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   وحدة الوقت.
-   **نوع قيمة الإخراج:** تاريخ
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 14:26:30` والوحدة هي "يوم"، فإن نتيجة الحساب تكون `2024-7-15 00:00:00`.

### تعيين التاريخ إلى نهاية وحدة محددة

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   وحدة الوقت.
-   **نوع قيمة الإخراج:** تاريخ
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 14:26:30` والوحدة هي "يوم"، فإن نتيجة الحساب تكون `2024-7-15 23:59:59`.

### التحقق من السنة الكبيسة

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   لا توجد معاملات.
-   **نوع قيمة الإخراج:** منطقي (Boolean)
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 14:26:30`، فإن نتيجة الحساب تكون `true`.

### التنسيق كسلسلة نصية

-   **نوع قيمة الإدخال المستلمة:** تاريخ
-   **المعاملات:**
    -   التنسيق، راجع [Day.js: Format](https://day.js.org/docs/en/display/format)
-   **نوع قيمة الإخراج:** سلسلة نصية
-   **مثال:** عندما تكون قيمة الإدخال هي `2024-7-15 14:26:30`، والتنسيق هو `the time is YYYY/MM/DD HH:mm:ss`، فإن نتيجة الحساب تكون `the time is 2024/07/15 14:26:30`.

### تحويل الوحدة

-   **نوع قيمة الإدخال المستلمة:** رقم
-   **المعاملات:**
    -   وحدة الوقت قبل التحويل.
    -   وحدة الوقت بعد التحويل.
    -   عملية التقريب، الخيارات تشمل الاحتفاظ بالكسور العشرية، التقريب لأقرب عدد صحيح، التقريب للأعلى، والتقريب للأسفل.
-   **نوع قيمة الإخراج:** رقم
-   **مثال:** عندما تكون قيمة الإدخال هي `2`، والوحدة قبل التحويل هي "أسبوع"، والوحدة بعد التحويل هي "يوم"، ولا يتم الاحتفاظ بالكسور العشرية، فإن نتيجة الحساب تكون `14`.

## مثال

![Date Calculation Node_Example](https://static-docs.nocobase.com/20240817184137.png)

لنفترض وجود حملة ترويجية، ونرغب في إضافة وقت انتهاء الحملة الترويجية إلى حقل المنتج عند إنشاء كل منتج. يكون وقت الانتهاء هذا في تمام الساعة 23:59:59 من آخر يوم في الأسبوع التالي لوقت إنشاء المنتج. لذلك، يمكننا إنشاء دالتين زمنيتين وتشغيلهما بتسلسل (pipeline):

-   حساب وقت الأسبوع التالي.
-   إعادة تعيين النتيجة إلى الساعة 23:59:59 من آخر يوم في ذلك الأسبوع.

بهذه الطريقة، نحصل على قيمة الوقت المطلوبة ونمررها إلى العقدة التالية، مثل عقدة تعديل **مجموعة**، لإضافة وقت انتهاء الحملة الترويجية إلى **مجموعة** البيانات.