---
pkg: '@nocobase/plugin-workflow-manual'
---
:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::


# المعالجة اليدوية

## مقدمة

عندما لا يمكن أتمتة عملية الأعمال بالكامل لاتخاذ القرارات، يمكن استخدام عقدة يدوية لتفويض جزء من سلطة اتخاذ القرار إلى شخص.

عند تنفيذ العقدة اليدوية، فإنها توقف تنفيذ سير العمل بالكامل مؤقتًا وتنشئ مهمة "قيد الانتظار" للمستخدم المعني. بعد أن يرسل المستخدم المهمة، سيستمر سير العمل أو يبقى معلقًا أو يتم إنهاؤه بناءً على الحالة المحددة. هذا مفيد جدًا في سيناريوهات مثل عمليات الموافقة.

## التثبيت

إضافة مدمجة، لا تتطلب تثبيتًا.

## إنشاء عقدة

في واجهة إعدادات سير العمل، انقر على زر علامة الجمع ("+") في سير العمل لإضافة عقدة "معالجة يدوية":

![إنشاء عقدة يدوية](https://static-docs.nocobase.com/4dd259f1aceeaf9b825abb4b257df909.png)

## إعداد العقدة

### المسؤول

تتطلب العقدة اليدوية تحديد مستخدم ليكون منفذ مهمة "قيد الانتظار". يمكن إضافة قائمة مهام "قيد الانتظار" ككتلة في صفحة، ويجب إعداد محتوى النافذة المنبثقة للمهمة لكل عقدة ضمن إعدادات واجهة العقدة.

حدد مستخدمًا، أو اختر المفتاح الأساسي أو المفتاح الخارجي لبيانات المستخدم من السياق عبر متغير.

![عقدة يدوية_إعداد_المسؤول_تحديد متغير](https://static-docs.nocobase.com/22fbca3b8e21fda3a831019037001445.png)

:::info{title=ملاحظة}
حاليًا، لا يدعم خيار المسؤول في العقد اليدوية التعامل مع عدة مستخدمين. سيتم دعم ذلك في إصدار مستقبلي.
:::

### إعداد واجهة المستخدم

يُعد إعداد واجهة مهمة "قيد الانتظار" الجزء الأساسي من العقدة اليدوية. يمكنك النقر على زر "إعداد واجهة المستخدم" لفتح نافذة منبثقة للإعداد المستقل، والتي يمكن إعدادها بطريقة "ما تراه هو ما تحصل عليه" (WYSIWYG)، تمامًا مثل أي صفحة عادية:

![عقدة يدوية_إعداد العقدة_إعداد الواجهة](https://static-docs.nocobase.com/fd360168c879743cf22d57440cd2590f.png)

#### علامات التبويب

يمكن استخدام علامات التبويب لتمييز المحتوى المختلف. على سبيل المثال، يمكن استخدام علامة تبويب لتقديم نموذج موافقة، وأخرى لتقديم نموذج رفض، أو لعرض تفاصيل البيانات ذات الصلة. يمكن إعدادها بحرية.

#### الكتل

تنقسم أنواع الكتل المدعومة بشكل أساسي إلى فئتين: كتل البيانات وكتل النماذج. بالإضافة إلى ذلك، تُستخدم لغة Markdown بشكل أساسي للمحتوى الثابت مثل رسائل المعلومات.

##### كتلة البيانات

يمكن لكتل البيانات عرض بيانات المشغل أو نتائج معالجة أي عقدة، مما يوفر معلومات سياقية ذات صلة للمسؤول عن مهمة "قيد الانتظار". على سبيل المثال، إذا تم تشغيل سير العمل بواسطة حدث نموذج، يمكنك إنشاء كتلة تفاصيل لبيانات المشغل. يتوافق هذا مع إعدادات التفاصيل في صفحة عادية، مما يتيح لك تحديد أي حقل من بيانات المشغل للعرض:

![عقدة يدوية_إعداد العقدة_إعداد الواجهة_كتلة البيانات_المشغل](https://static-docs.nocobase.com/675c3e58a1a4f45db310a72c2d0a404c.png)

كتل بيانات العقدة متشابهة؛ يمكنك تحديد نتيجة البيانات من عقدة سابقة لعرضها كتفاصيل. على سبيل المثال، يمكن أن تكون نتيجة عقدة حساب سابقة بمثابة معلومات مرجعية سياقية لمهمة المسؤول "قيد الانتظار":

![عقدة يدوية_إعداد العقدة_إعداد الواجهة_كتلة البيانات_بيانات العقدة](https://static-docs.nocobase.com/a583e26e508e95b47e5ddff80d998c4.png)

:::info{title=ملاحظة}
نظرًا لأن سير العمل يكون في حالة غير منفذة أثناء إعداد الواجهة، فلا يتم عرض أي بيانات محددة في كتل البيانات. لا يمكن رؤية البيانات ذات الصلة بمثيل سير عمل معين إلا في واجهة النافذة المنبثقة لمهام "قيد الانتظار" بعد تشغيل سير العمل وتنفيذه.
:::

##### كتلة النموذج

يجب إعداد كتلة نموذج واحدة على الأقل في واجهة مهام "قيد الانتظار" للتعامل مع القرار النهائي بشأن ما إذا كان سير العمل يجب أن يستمر. عدم إعداد نموذج سيمنع سير العمل من المتابعة بعد توقفه. هناك ثلاثة أنواع من كتل النماذج:

- نموذج مخصص
- نموذج إنشاء سجل
- نموذج تحديث سجل

![عقدة يدوية_إعداد العقدة_إعداد الواجهة_أنواع النماذج](https://static-docs.nocobase.com/2d068f3012ab07e32a265405492104a8.png)

تتطلب نماذج إنشاء السجلات ونماذج تحديث السجلات تحديد مجموعة بيانات أساسية. بعد إرسال المستخدم لمهمة "قيد الانتظار"، ستُستخدم القيم الموجودة في النموذج لإنشاء أو تحديث البيانات في مجموعة البيانات المحددة. أما النموذج المخصص فيتيح لك تعريف نموذج مؤقت غير مرتبط بمجموعة بيانات، ويمكن استخدام قيم الحقول التي يرسلها المستخدم في العقد اللاحقة.

يمكن إعداد أزرار إرسال النموذج بثلاثة أنواع، وهي:

- إرسال ومتابعة سير العمل
- إرسال وإنهاء سير العمل
- حفظ قيم النموذج فقط

![عقدة يدوية_إعداد العقدة_إعداد الواجهة_أزرار النموذج](https://static-docs.nocobase.com/6b45995b14152e85a821dff6f6e3189a.png)

تمثل الأزرار الثلاثة ثلاث حالات للعقدة في عملية سير العمل. بعد الإرسال، تتغير حالة العقدة إلى "مكتملة" أو "مرفوضة" أو تبقى في حالة "معلقة". يجب إعداد أحد الخيارين الأولين على الأقل في النموذج لتحديد مسار المعالجة اللاحق لسير العمل بأكمله.

على زر "متابعة سير العمل"، يمكنك إعداد تعيينات لحقول النموذج:

![عقدة يدوية_إعداد العقدة_إعداد الواجهة_زر النموذج_تعيين قيم النموذج](https://static-docs.nocobase.com/2cec2d4e2957f068877e616dec3b56dd.png)

![عقدة يدوية_إعداد العقدة_إعداد الواجهة_زر النموذج_نافذة تعيين قيم النموذج المنبثقة](https://static-docs.nocobase.com/5ff51b60c76cdb76e6f1cc95dc3d8640.png)

بعد فتح النافذة المنبثقة، يمكنك تعيين قيم لأي حقل في النموذج. بعد إرسال النموذج، ستكون هذه القيمة هي القيمة النهائية للحقل. هذا مفيد بشكل خاص عند مراجعة البيانات. يمكنك استخدام عدة أزرار مختلفة "متابعة سير العمل" في نموذج واحد، حيث يقوم كل زر بتعيين قيم تعداد مختلفة لحقول ذات حالة مماثلة، وبالتالي تحقيق تأثير متابعة تنفيذ سير العمل اللاحق بقيم بيانات مختلفة.

## كتلة مهام "قيد الانتظار"

بالنسبة للمعالجة اليدوية، تحتاج أيضًا إلى إضافة قائمة مهام "قيد الانتظار" إلى صفحة لعرض المهام. يتيح هذا للموظفين المعنيين الوصول إلى معالجة المهام المحددة للعقدة اليدوية من خلال هذه القائمة.

### إضافة كتلة

يمكنك تحديد "مهام سير العمل قيد الانتظار" من الكتل الموجودة في الصفحة لإضافة كتلة قائمة مهام "قيد الانتظار":

![عقدة يدوية_إضافة كتلة مهام قيد الانتظار](https://static-docs.nocobase.com/198b417454cd73b704267bf30fe5e647.png)

مثال على كتلة قائمة مهام "قيد الانتظار":

![عقدة يدوية_قائمة مهام قيد الانتظار](https://static-docs.nocobase.com/cfefb0d2c6a91c5c9dfa550d6b220f34.png)

### تفاصيل مهام "قيد الانتظار"

بعد ذلك، يمكن للموظفين المعنيين النقر على مهمة "قيد الانتظار" المقابلة لفتح النافذة المنبثقة للمهمة وإجراء المعالجة اليدوية:

![عقدة يدوية_تفاصيل مهام قيد الانتظار](https://static-docs.nocobase.com/ccfd0533deebff6b3f6ef4408066e688.png)

## مثال

### مراجعة المقالات

لن نفترض أن مقالًا أرسله مستخدم عادي يحتاج إلى موافقة مسؤول قبل أن يتم تحديثه إلى حالة "منشور". وإذا تم رفض سير العمل، سيبقى المقال في حالة "مسودة" (غير عام). يمكن تنفيذ هذه العملية باستخدام نموذج التحديث في العقدة اليدوية.

أنشئ سير عمل يتم تشغيله بواسطة "إنشاء مقال" وأضف عقدة يدوية:

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_تنظيم سير العمل" src="https://github.com/nocobase/nocobase/assets/525658/2021bf42-f372-4f69-9c84-5a786c061e0e" width="360" />
</figure>

في العقدة اليدوية، قم بإعداد المسؤول ليكون مشرفًا. في إعدادات الواجهة، أضف كتلة تستند إلى بيانات المشغل لعرض تفاصيل المقال الجديد:

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_إعداد العقدة_كتلة التفاصيل" src="https://github.com/nocobase/nocobase/assets/525658/c61d0aac-23cb-4387-b60e-ce3cc7bf1c24" width="680" />
</figure>

في إعدادات الواجهة، أضف كتلة تستند إلى نموذج تحديث سجل، واختر مجموعة المقالات، ليقرر المسؤول ما إذا كان سيوافق على المراجعة. بعد الموافقة، سيتم تحديث المقال المقابل بناءً على الإعدادات الأخرى اللاحقة. بعد إضافة النموذج، سيكون هناك زر "متابعة سير العمل" بشكل افتراضي، والذي يمكن اعتباره للموافقة عند النقر عليه. ثم، أضف زر "إنهاء سير العمل" ليُستخدم في حالة عدم الموافقة على المراجعة:

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_إعداد العقدة_النموذج والإجراءات" src="https://github.com/nocobase/nocobase/assets/525658/4baaf41e-3d81-4ee8-a038-29db05e0d99f" width="673" />
</figure>

عند متابعة سير العمل، نحتاج إلى تحديث حالة المقال. هناك طريقتان لإعداد ذلك. الأولى هي عرض حقل حالة المقال مباشرة في النموذج ليختاره المشغل. هذه الطريقة أكثر ملاءمة للحالات التي تتطلب تعبئة النموذج بشكل فعال، مثل تقديم الملاحظات:

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_إعداد العقدة_حقول النموذج" src="https://github.com/nocobase/nocobase/assets/525658/82ea4e0e-25fc-4921-841e-e1a2782a87d1" width="668" />
</figure>

لتبسيط مهمة المشغل، هناك طريقة أخرى وهي إعداد تعيين قيمة النموذج على زر "متابعة سير العمل". في التعيين، أضف حقل "الحالة" بقيمة "منشور". هذا يعني أنه عند النقر على الزر، سيتم تحديث المقال إلى حالة "منشور":

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_إعداد العقدة_تعيين النموذج" src="https://github.com/nocobase/nocobase/assets/525658/0340bd9f-8323-4e4f-bc5a-8f81be3d6736" width="711" />
</figure>

ثم، من قائمة الإعدادات في الزاوية العلوية اليمنى لكتلة النموذج، حدد شرط التصفية للبيانات المراد تحديثها. هنا، اختر مجموعة "المقالات"، وشرط التصفية هو "المعرف `يساوي` متغير المشغل / بيانات المشغل / المعرف":

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_إعداد العقدة_شرط النموذج" src="https://github.com/nocobase/nocobase/assets/525658/da004055-0262-49ae-88dd-3844f3c92e28" width="1020" />
</figure>

أخيرًا، يمكنك تعديل عناوين كل كتلة، ونص الأزرار ذات الصلة، والنص التوجيهي لحقول النموذج لجعل الواجهة أكثر سهولة في الاستخدام:

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_إعداد العقدة_النموذج النهائي" src="https://github.com/nocobase/nocobase/assets/525658/21db5f6b-690b-49c1-8259-4f7b8874620d" width="678" />
</figure>

أغلق لوحة الإعدادات، وانقر على زر الإرسال لحفظ إعدادات العقدة. بذلك يكون سير العمل قد اكتمل إعداده. بعد تمكين سير العمل هذا، سيتم تشغيله تلقائيًا عند إنشاء مقال جديد. يمكن للمسؤول رؤية أن سير العمل هذا يحتاج إلى معالجة من قائمة مهام "قيد الانتظار". عند النقر للعرض، يمكن رؤية تفاصيل مهمة "قيد الانتظار":

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_قائمة مهام قيد الانتظار" src="https://github.com/nocobase/nocobase/assets/525658/4e1748cd-6a07-4045-82e5-286826607826" width="1363" />
</figure>

<figure>
  <img alt="عقدة يدوية_مثال_مراجعة المقالات_تفاصيل مهام قيد الانتظار" src="https://github.com/nocobase/nocobase/assets/525658/65f01fb1-8cb0-45f8-ac21-ec8ab59be449" width="680" />
</figure>

يمكن للمسؤول إجراء تقييم يدوي بناءً على تفاصيل المقال لتحديد ما إذا كان يمكن نشره. إذا كان بالإمكان، فإن النقر على زر "موافقة" سيحدث المقال إلى حالة "منشور". وإذا لم يكن كذلك، فإن النقر على زر "رفض" سيبقي المقال في حالة "مسودة".

## الموافقة على الإجازات

لن نفترض أن موظفًا يحتاج إلى طلب إجازة، ويجب أن يوافق عليها المشرف لكي تصبح سارية المفعول، ويجب خصم بيانات إجازة الموظف المقابلة. وبغض النظر عن الموافقة أو الرفض، سيتم استخدام عقدة طلب HTTP لاستدعاء واجهة برمجة تطبيقات الرسائل القصيرة لإرسال رسالة إشعار ذات صلة إلى الموظف (انظر قسم [طلب HTTP](#_HTTP_请求)). يمكن تنفيذ هذا السيناريو باستخدام نموذج مخصص في عقدة يدوية.

أنشئ سير عمل يتم تشغيله بواسطة "إنشاء طلب إجازة" وأضف عقدة يدوية. هذا مشابه لعملية مراجعة المقالات السابقة، ولكن هنا المسؤول هو المشرف. في إعدادات الواجهة، أضف كتلة تستند إلى بيانات المشغل لعرض تفاصيل طلب الإجازة الجديد. ثم، أضف كتلة أخرى تستند إلى نموذج مخصص ليقرر المشرف ما إذا كان سيوافق على الطلب. في النموذج المخصص، أضف حقلًا لحالة الموافقة وحقلًا لسبب الرفض:

<figure>
  <img alt="عقدة يدوية_مثال_الموافقة على الإجازات_إعداد العقدة" src="https://github.com/nocobase/nocobase/assets/525658/ef3bc7b8-56e8-4a4e-826e-ffd0b547d1b6" width="675" />
</figure>

على عكس عملية مراجعة المقالات، نظرًا لأننا نحتاج إلى متابعة سير العمل اللاحق بناءً على نتيجة موافقة المشرف، فإننا نُعد هنا زر "متابعة سير العمل" فقط للاستخدام في الإرسال، ولا نستخدم زر "إنهاء سير العمل".

في الوقت نفسه، بعد العقدة اليدوية، يمكننا استخدام عقدة شرطية لتحديد ما إذا كان المشرف قد وافق على طلب الإجازة. في فرع الموافقة، أضف معالجة بيانات لخصم الإجازة، وبعد دمج الفروع، أضف عقدة طلب لإرسال إشعار عبر الرسائل القصيرة إلى الموظف. ينتج عن ذلك سير العمل الكامل التالي:

<figure>
  <img alt="عقدة يدوية_مثال_الموافقة على الإجازات_تنظيم سير العمل" src="https://github.com/nocobase/nocobase/assets/525658/733f68da-e44f-4172-9772-a287ac2724f2" width="593" />
</figure>

يتم إعداد الشرط في عقدة الشرط على النحو التالي: "عقدة يدوية / بيانات النموذج المخصص / قيمة حقل الموافقة هي 'موافق عليها'":

<figure>
  <img alt="عقدة يدوية_مثال_الموافقة على الإجازات_شرط" src="https://github.com/nocobase/nocobase/assets/525658/57b972f0-a3ce-4f33-8d40-4272ad205c20" width="678" />
</figure>

يمكن لبيانات عقدة إرسال الطلب أيضًا استخدام متغيرات النموذج المقابلة من العقدة اليدوية لتمييز محتوى الرسائل القصيرة للموافقة والرفض. بهذا يكتمل إعداد سير العمل بأكمله. بعد تمكين سير العمل، عندما يرسل الموظف نموذج طلب الإجازة، يمكن للمشرف معالجة الموافقة في مهام "قيد الانتظار" الخاصة به. العملية مشابهة بشكل أساسي لعملية مراجعة المقالات.