---
pkg: '@nocobase/plugin-workflow-approval'
---
:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::


# الموافقة

## مقدمة

في سير عمل الموافقة، يتطلب الأمر استخدام عقدة "موافقة" مخصصة لتهيئة منطق العمليات للموافقين لمعالجة (الموافقة، الرفض، أو الإرجاع) طلبات الموافقة المُقدمة. يمكن استخدام عقدة "الموافقة" فقط ضمن عمليات الموافقة.

:::info{title=تلميح}
الفرق بينها وبين عقدة "المعالجة اليدوية" العادية: عقدة "المعالجة اليدوية" العادية مخصصة لسيناريوهات أكثر عمومية، ويمكن استخدامها في أنواع متعددة من سير العمل لإدخال البيانات يدويًا أو اتخاذ قرارات يدوية بشأن استمرارية العملية. أما "عقدة الموافقة" فهي عقدة معالجة متخصصة حصريًا لعمليات الموافقة، وتتعامل فقط مع البيانات الخاصة بطلب الموافقة، ولا يمكن استخدامها في سير عمل أخرى.
:::

## إنشاء عقدة

انقر على زر الزائد ("+") في سير العمل لإضافة عقدة "موافقة"، ثم اختر أحد أوضاع الموافقة لإنشاء عقدة الموافقة:

![إنشاء عقدة الموافقة](https://static-docs.nocobase.com/20251107000938.png)

## تهيئة العقدة

### وضع الموافقة

يوجد وضعان للموافقة:

1.  **وضع المرور المباشر**: يُستخدم عادةً للعمليات الأكثر بساطة. يحدد ما إذا كانت عقدة الموافقة قد تمت الموافقة عليها أم لا ما إذا كانت العملية ستنتهي. في حال عدم الموافقة، يتم إنهاء العملية مباشرةً.

    ![وضع الموافقة - المرور المباشر](https://static-docs.nocobase.com/20251107001043.png)

2.  **وضع التفرع**: يُستخدم عادةً لمنطق البيانات الأكثر تعقيدًا. بعد أن تُنتج عقدة الموافقة أي نتيجة، يمكن متابعة تنفيذ العقد الأخرى ضمن فرع النتيجة الخاص بها.

    ![وضع الموافقة - وضع التفرع](https://static-docs.nocobase.com/20251107001234.png)

    بعد "الموافقة" على هذه العقدة، بالإضافة إلى تنفيذ فرع الموافقة، سيستمر تنفيذ سير العمل اللاحق. بعد عملية "الرفض"، يمكن أيضًا متابعة تنفيذ سير العمل اللاحق افتراضيًا، أو يمكنك تهيئة العقدة لإنهاء سير العمل بعد تنفيذ الفرع.

:::info{title=تلميح}
لا يمكن تعديل وضع الموافقة بعد إنشاء العقدة.
:::

### الموافقون

الموافقون هم مجموعة المستخدمين المسؤولين عن إجراء الموافقة في هذه العقدة. يمكن أن يكونوا مستخدمًا واحدًا أو أكثر. يمكن أن يكون مصدر الاختيار قيمة ثابتة يتم اختيارها من قائمة المستخدمين، أو قيمة ديناميكية محددة بواسطة متغير:

![تهيئة الموافقين](https://static-docs.nocobase.com/20251107001433.png)

عند اختيار متغير، يمكنك فقط تحديد المفتاح الأساسي أو المفتاح الأجنبي لبيانات المستخدم من السياق ونتائج العقدة. إذا كان المتغير المختار عبارة عن مصفوفة أثناء التنفيذ (علاقة متعددة)، فسيتم دمج كل مستخدم في المصفوفة ضمن مجموعة الموافقين بأكملها.

بالإضافة إلى اختيار المستخدمين أو المتغيرات مباشرةً، يمكن أيضًا تصفية المستخدمين الذين يستوفون الشروط ديناميكيًا بناءً على شروط الاستعلام لجدول المستخدمين ليكونوا الموافقين:

![تصفية الموافقين](https://static-docs.nocobase.com/20251107001703.png)

### وضع التوافق

إذا كان هناك موافق واحد فقط عند التنفيذ النهائي (بما في ذلك حالة إزالة التكرارات من المتغيرات المتعددة)، فبغض النظر عن وضع التوافق المختار، سيقوم هذا المستخدم وحده بتنفيذ عملية الموافقة، وستُحدد النتيجة من قبله فقط.

عندما يكون هناك عدة مستخدمين في مجموعة الموافقين، يمثل اختيار أوضاع توافق مختلفة طرق معالجة مختلفة:

1.  **موافقة أي شخص**: يكفي أن يوافق شخص واحد ليعتبر أن العقدة قد تمت الموافقة عليها. لا تُرفض العقدة إلا إذا رفضها الجميع.
2.  **موافقة جماعية**: يتطلب موافقة الجميع ليعتبر أن العقدة قد تمت الموافقة عليها. تُرفض العقدة إذا رفضها شخص واحد فقط.
3.  **تصويت**: يتطلب موافقة عدد من الأشخاص يتجاوز نسبة محددة ليعتبر أن العقدة قد تمت الموافقة عليها؛ وإلا، تُرفض العقدة.

بالنسبة لعملية الإرجاع، في أي وضع، إذا قام أي مستخدم في مجموعة الموافقين بمعالجتها كإرجاع، فستخرج العقدة مباشرة من سير العمل.

### ترتيب المعالجة

وبالمثل، عندما يكون هناك عدة مستخدمين في مجموعة الموافقين، يمثل اختيار ترتيبات معالجة مختلفة طرق معالجة مختلفة:

1.  **متوازي**: يمكن لجميع الموافقين المعالجة بأي ترتيب؛ لا يهم تسلسل المعالجة.
2.  **متسلسل**: يعالج الموافقون بالتسلسل وفقًا للترتيب في مجموعة الموافقين. لا يمكن للموافق التالي المعالجة إلا بعد أن يقدم الموافق السابق.

بغض النظر عما إذا كان الإعداد "متسلسل" للمعالجة أم لا، فإن النتيجة الناتجة وفقًا للترتيب الفعلي للمعالجة تتبع أيضًا القواعد المذكورة في "وضع التوافق" أعلاه. تكتمل العقدة تنفيذها بمجرد استيفاء الشروط المقابلة.

### إنهاء سير العمل بعد انتهاء فرع الرفض

عندما يتم تعيين "وضع الموافقة" على "وضع التفرع"، يمكنك اختيار إنهاء سير العمل بعد انتهاء فرع الرفض. بعد تحديد هذا الخيار، ستظهر علامة "✗" في نهاية فرع الرفض، مما يشير إلى أن العقد اللاحقة لن تستمر بعد انتهاء هذا الفرع:

![الخروج بعد الرفض](https://static-docs.nocobase.com/20251107001839.png)

### تهيئة واجهة الموافق

تُستخدم تهيئة واجهة الموافق لتوفير واجهة عمليات للموافق عند تنفيذ سير عمل الموافقة وصولاً إلى هذه العقدة. انقر على زر التهيئة لفتح النافذة المنبثقة:

![تهيئة واجهة الموافق - نافذة منبثقة](https://static-docs.nocobase.com/20251107001958.png)

في النافذة المنبثقة للتهيئة، يمكنك إضافة كتل مثل محتوى التقديم الأصلي، معلومات الموافقة، نموذج المعالجة، ونصوص التنبيه المخصصة:

![تهيئة واجهة الموافق - إضافة كتل](https://static-docs.nocobase.com/20251107002604.png)

#### محتوى التقديم الأصلي

كتلة تفاصيل محتوى الموافقة هي كتلة البيانات التي قدمها المُبادر. على غرار كتل البيانات العادية، يمكنك إضافة مكونات حقول من مجموعة البيانات وترتيبها بحرية لتنظيم المحتوى الذي يحتاج الموافقون إلى مراجعته.

![تهيئة واجهة الموافق - كتلة التفاصيل](https://static-docs.nocobase.com/20251107002925.png)

#### نموذج المعالجة

في كتلة نموذج العمليات، يمكنك إضافة أزرار العمليات التي تدعمها هذه العقدة، بما في ذلك "موافقة"، "رفض"، "إرجاع"، "إعادة تعيين"، و"إضافة موقع".

![تهيئة واجهة الموافق - كتلة نموذج العمليات](https://static-docs.nocobase.com/20251107003015.png)

بالإضافة إلى ذلك، يمكن إضافة حقول قابلة للتعديل من قبل الموافق إلى نموذج العمليات. ستظهر هذه الحقول في نموذج العمليات عندما يقوم الموافق بمعالجة الموافقة. يمكن للموافق تعديل قيم هذه الحقول، وبعد التقديم، سيتم تحديث البيانات المستخدمة للموافقة، بالإضافة إلى لقطة البيانات المقابلة في سير عمل الموافقة، في نفس الوقت.

![تهيئة واجهة الموافق - نموذج العمليات - تعديل حقول محتوى الموافقة](https://static-docs.nocobase.com/20251107003206.png)

#### "موافقة" و"رفض"

من بين أزرار عمليات الموافقة، تُعد "موافقة" و"رفض" عمليات حاسمة. بعد التقديم، يكتمل معالجة الموافق لهذه العقدة. يمكن إضافة حقول إضافية يجب تعبئتها عند التقديم، مثل "التعليق"، في النافذة المنبثقة "تهيئة المعالجة" لزر العملية.

![تهيئة واجهة الموافق - نموذج العمليات - تهيئة المعالجة](https://static-docs.nocobase.com/20251107003314.png)

#### "إرجاع"

"إرجاع" هي أيضًا عملية حاسمة، وبالإضافة إلى إمكانية تهيئة التعليقات، يمكن أيضًا تهيئة العقد القابلة للإرجاع:

![إرجاع](https://static-docs.nocobase.com/20251107003555.png)

#### "إعادة تعيين" و"إضافة موقع"

"إعادة التعيين" و"إضافة موقع" هما عمليتان غير حاسمتين تُستخدمان لتعديل الموافقين ديناميكيًا في سير عمل الموافقة. "إعادة التعيين" تعني تسليم مهمة الموافقة للمستخدم الحالي إلى مستخدم آخر لمعالجتها نيابةً عنه. أما "إضافة موقع" فتعني إضافة موافق قبل أو بعد الموافق الحالي، ليواصل الموافق الجديد عملية الموافقة معًا.

بعد تمكين أزرار عمليتي "إعادة التعيين" أو "إضافة موقع"، يجب تحديد "نطاق التعيين" في قائمة تهيئة الزر لتعيين نطاق المستخدمين الذين يمكن تعيينهم كموافقين جدد:

![تهيئة واجهة الموافق - نموذج العمليات - نطاق التعيين](https://static-docs.nocobase.com/20241226232321.png)

تمامًا مثل تهيئة الموافقين الأصلية للعقدة، يمكن أن يكون نطاق التعيين إما موافقين مختارين مباشرةً، أو بناءً على شروط استعلام لجدول المستخدمين. في النهاية، سيتم دمجهم في مجموعة واحدة، ولن تتضمن المستخدمين الموجودين بالفعل في مجموعة الموافقين.

:::warning{title=هام}
إذا تم تمكين أو تعطيل زر عملية معين، أو تم تعديل نطاق التعيين، فيجب حفظ تهيئة هذه العقدة بعد إغلاق النافذة المنبثقة لتهيئة واجهة العمليات. وإلا، فلن تسري التغييرات على زر العملية.
:::

## نتيجة العقدة

بعد اكتمال الموافقة، سيتم تسجيل الحالات والبيانات ذات الصلة في نتيجة العقدة، ويمكن استخدامها كمتغيرات بواسطة العقد اللاحقة.

![نتيجة العقدة](https://static-docs.nocobase.com/20250614095052.png)

### حالة موافقة العقدة

يمثل حالة معالجة عقدة الموافقة الحالية، والنتيجة هي قيمة تعدادية.

### البيانات بعد الموافقة

إذا قام الموافق بتعديل محتوى الموافقة في نموذج العمليات، فسيتم تسجيل البيانات المعدلة في نتيجة العقدة لاستخدامها بواسطة العقد اللاحقة. لاستخدام حقول العلاقة، يجب تهيئة التحميل المسبق لحقول العلاقة في المشغل.

### سجلات الموافقة

> v1.8.0+

سجل معالجة الموافقة هو مصفوفة تحتوي على سجلات معالجة جميع الموافقين في هذه العقدة. يتضمن كل سجل معالجة الحقول التالية:

| الحقل | النوع | الوصف |
| --- | --- | --- |
| id | number | المعرف الفريد لسجل المعالجة |
| userId | number | معرف المستخدم الذي عالج هذا السجل |
| status | number | حالة المعالجة |
| comment | string | التعليق وقت المعالجة |
| updatedAt | string | وقت تحديث سجل المعالجة |

يمكنك استخدام هذه الحقول كمتغيرات في العقد اللاحقة حسب الحاجة.