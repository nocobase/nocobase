---
pkg: '@nocobase/plugin-workflow-sql'
---
:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::


# عملية SQL

## مقدمة

في بعض السيناريوهات الخاصة، قد لا تتمكن عقد عمليات المجموعة البسيطة المذكورة أعلاه من التعامل مع العمليات المعقدة. في مثل هذه الحالات، يمكنك استخدام عقدة SQL مباشرة لجعل قاعدة البيانات تنفذ عبارات SQL معقدة لمعالجة البيانات.

يكمن الفرق بين هذا وبين الاتصال المباشر بقاعدة البيانات لإجراء عمليات SQL خارج التطبيق في أنه ضمن سير العمل، يمكنك استخدام المتغيرات من سياق العملية كمعاملات في عبارة SQL.

## التثبيت

إضافة مدمجة، لا تتطلب تثبيتًا.

## إنشاء عقدة

في واجهة إعداد سير العمل، انقر على زر الزائد ("+") في التدفق لإضافة عقدة "عملية SQL":

![إضافة عملية SQL](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

## إعدادات العقدة

![إعدادات عقدة SQL](https://static-docs.nocobase.com/20240904002334.png)

### مصدر البيانات

اختر مصدر البيانات لتنفيذ SQL.

يجب أن يكون مصدر البيانات من نوع قاعدة بيانات، مثل مصدر البيانات الرئيسي، أو PostgreSQL، أو أي مصادر بيانات أخرى متوافقة مع Sequelize.

### محتوى SQL

قم بتحرير عبارة SQL. حاليًا، يتم دعم عبارة SQL واحدة فقط.

أدخل المتغيرات المطلوبة باستخدام زر المتغيرات في الزاوية العلوية اليمنى من المحرر. قبل التنفيذ، سيتم استبدال هذه المتغيرات بقيمها المقابلة من خلال استبدال النص. ثم سيتم استخدام النص الناتج كعبارة SQL النهائية وإرسالها إلى قاعدة البيانات للاستعلام.

## نتيجة تنفيذ العقدة

منذ `v1.3.15-beta`، تكون نتيجة تنفيذ عقدة SQL عبارة عن مصفوفة تتكون من بيانات خام فقط. قبل ذلك، كانت عبارة عن هيكل الإرجاع الأصلي لـ Sequelize الذي يحتوي على بيانات تعريف الاستعلام (انظر: [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query)).

على سبيل المثال، الاستعلام التالي:

```sql
select count(id) from posts;
```

النتيجة قبل `v1.3.15-beta`:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

النتيجة بعد `v1.3.15-beta`:

```json
[
    { "count": 1 }
]
```

## الأسئلة الشائعة

### كيفية استخدام نتيجة عقدة SQL؟

إذا تم استخدام عبارة `SELECT`، فسيتم حفظ نتيجة الاستعلام في العقدة بتنسيق JSON الخاص بـ Sequelize. يمكن تحليلها واستخدامها مع إضافة [JSON-query](./json-query.md).

### هل تؤدي عملية SQL إلى تشغيل أحداث المجموعة؟

**لا**. ترسل عملية SQL عبارة SQL مباشرة إلى قاعدة البيانات للمعالجة. تحدث عمليات `CREATE` / `UPDATE` / `DELETE` ذات الصلة في قاعدة البيانات، بينما تحدث أحداث المجموعة في طبقة تطبيق Node.js (التي يتعامل معها ORM)، لذلك لن يتم تشغيل أحداث المجموعة.