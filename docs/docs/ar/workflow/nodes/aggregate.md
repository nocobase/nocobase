:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::

```
pkg: '@nocobase/plugin-workflow-aggregate'
```

# استعلام التجميع

## مقدمة

يُستخدم هذا الاستعلام لإجراء عمليات تجميع على البيانات في **مجموعة** معينة تستوفي شروطًا محددة، ويعيد النتائج الإحصائية المقابلة. غالبًا ما يُستخدم لمعالجة البيانات الإحصائية الخاصة بالتقارير.

يعتمد تنفيذ هذه العقدة على دوال التجميع الخاصة بقواعد البيانات. حاليًا، تدعم الإحصائيات على حقل واحد فقط من **مجموعة** البيانات. سيتم حفظ القيمة العددية للنتائج الإحصائية في مخرجات العقدة لتستخدمها العقد اللاحقة.

## التثبيت

هذه **إضافة** مدمجة، لا تتطلب تثبيتًا.

## إنشاء عقدة

في واجهة إعداد **سير العمل**، انقر على زر الزائد ("+") في التدفق لإضافة عقدة "استعلام التجميع":

![إنشاء عقدة استعلام التجميع](https://static-docs.nocobase.com/7f9d806ebf5064f80c30f8b67f316f0f.png)

## إعدادات العقدة

![عقدة استعلام التجميع_إعدادات العقدة](https://static-docs.nocobase.com/57362f747b9992230567c6bb5e986fd2.png)

### دالة التجميع

تدعم 5 دوال تجميع من SQL: `COUNT`، `SUM`، `AVG`، `MIN`، و `MAX`. اختر إحداها لإجراء استعلام تجميع على البيانات.

### نوع الهدف

يمكن اختيار هدف استعلام التجميع بوضعيتين. الأولى هي اختيار **مجموعة** البيانات المستهدفة وحقل واحد منها مباشرةً. أما الثانية فهي اختيار **مجموعة** البيانات المرتبطة بعلاقة واحد إلى متعدد وحقلها، وذلك من خلال كائن بيانات موجود في سياق **سير العمل** لإجراء استعلام التجميع.

### إزالة التكرارات

هذه هي `DISTINCT` في SQL. حقل إزالة التكرارات هو نفسه حقل **مجموعة** البيانات المختار. لا يدعم حاليًا اختيار حقول مختلفة لكليهما.

### شروط التصفية

مشابهة لشروط التصفية في استعلام **مجموعة** بيانات عادي، يمكنك استخدام متغيرات السياق من **سير العمل**.

## مثال

هدف التجميع "بيانات **مجموعة**" سهل الفهم نسبيًا. هنا، سنستخدم مثال "عد إجمالي عدد المقالات في فئة معينة بعد إضافة مقال جديد" لشرح استخدام هدف التجميع "بيانات **مجموعة** مرتبطة".

أولاً، أنشئ مجموعتين: "المقالات" و"التصنيفات". تحتوي **مجموعة** المقالات على حقل علاقة متعدد إلى واحد يشير إلى **مجموعة** التصنيفات، ويتم أيضًا إنشاء حقل علاقة عكسية واحد إلى متعدد من التصنيفات إلى المقالات:

| اسم الحقل   | النوع                 |
| ---------- | ---------------------- |
| العنوان    | نص سطر واحد            |
| التصنيف    | متعدد إلى واحد (التصنيفات) |

| اسم الحقل   | النوع                 |
| ---------- | -------------------- |
| اسم التصنيف | نص سطر واحد          |
| المقالات   | واحد إلى متعدد (المقالات) |

بعد ذلك، أنشئ **سير عمل** يتم تشغيله بواسطة حدث **مجموعة** بيانات. اختر تشغيله بعد إضافة بيانات جديدة إلى **مجموعة** المقالات.

ثم، أضف عقدة استعلام تجميع وقم بتكوينها كما يلي:

![عقدة استعلام التجميع_مثال_إعدادات العقدة](https://static-docs.nocobase.com/542272e64b567373d1b37ddda78.png)

بهذه الطريقة، بعد تشغيل **سير العمل**، ستقوم عقدة استعلام التجميع بحساب عدد جميع المقالات في فئة المقال المضاف حديثًا وحفظه كنتيجة للعقدة.

:::info{title=تلميح}
إذا كنت بحاجة إلى استخدام بيانات العلاقة من مشغل حدث **مجموعة** البيانات، يجب عليك تكوين الحقول ذات الصلة في قسم "تحميل البيانات المرتبطة مسبقًا" في المشغل، وإلا فلن تتمكن من تحديدها.
:::