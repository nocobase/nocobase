:::tip إشعار الترجمة بالذكاء الاصطناعي
تمت ترجمة هذه الوثائق تلقائيًا بواسطة الذكاء الاصطناعي.
:::

# المهام المجدولة

## مقدمة

المهام المجدولة هي أحداث يتم تشغيلها بناءً على شرط زمني، وتتوفر بنمطين:

-   **وقت مخصص:** تشغيل منتظم ومجدول بناءً على وقت النظام، شبيه بـ Cron.
-   **حقل وقت في مجموعة:** تشغيل بناءً على قيمة حقل زمني محدد في إحدى **المجموعات** عند الوصول إلى الوقت المحدد.

عندما يصل النظام إلى النقطة الزمنية (بدقة الثانية) التي تستوفي شروط التشغيل المحددة، يتم تشغيل **سير العمل** المقابل.

## الاستخدام الأساسي

### إنشاء مهمة مجدولة

عند إنشاء **سير عمل** من قائمة **سير العمل**، اختر نوع "مهمة مجدولة":

![إنشاء مهمة مجدولة](https://static-docs.nocobase.com/e09b6c9065167875b2ca7de5f5a799a7.png)

### نمط الوقت المخصص

بالنسبة للنمط الاعتيادي، يجب أولاً تحديد وقت البدء ليكون أي نقطة زمنية (بدقة الثانية). يمكن تعيين وقت البدء ليكون في المستقبل أو في الماضي. عند تعيينه في الماضي، سيتم التحقق مما إذا كان الوقت قد حان بناءً على شرط التكرار المحدد. إذا لم يتم تحديد شرط تكرار وكان وقت البدء في الماضي، فلن يتم تشغيل **سير العمل** بعد ذلك.

هناك طريقتان لتكوين قاعدة التكرار:

-   **حسب الفاصل الزمني:** يتم التشغيل بفاصل زمني ثابت بعد وقت البدء، مثل كل ساعة، كل 30 دقيقة، وما إلى ذلك.
-   **النمط المتقدم:** وهو يعتمد على قواعد Cron، حيث يمكن تكوينه لدورة تصل إلى تاريخ ووقت محددين بقاعدة ثابتة.

بعد تحديد قاعدة التكرار، يمكنك أيضًا تحديد شرط للانتهاء. يمكن أن ينتهي عند نقطة زمنية ثابتة أو أن يكون محدودًا بعدد مرات التنفيذ.

### نمط حقل الوقت في مجموعة

يُعد استخدام حقل الوقت في **مجموعة** لتحديد وقت البدء نمط تشغيل يجمع بين المهام المجدولة العادية وحقول الوقت في **المجموعات**. يمكن أن يؤدي استخدام هذا النمط إلى تبسيط العقد في بعض العمليات المحددة، كما أنه أكثر سهولة في التكوين. على سبيل المثال، لتغيير حالة الطلبات المتأخرة غير المدفوعة إلى ملغاة، يمكنك ببساطة تكوين مهمة مجدولة بنمط حقل الوقت في **مجموعة**، واختيار وقت البدء ليكون بعد 30 دقيقة من إنشاء الطلب.

## نصائح ذات صلة

### المهام المجدولة في حالة عدم النشاط أو الإيقاف

إذا تم استيفاء الشرط الزمني المحدد، ولكن خدمة تطبيق NocoBase بأكملها في حالة عدم نشاط أو إيقاف، فسيتم تفويت المهمة المجدولة التي كان من المفترض أن يتم تشغيلها في تلك النقطة الزمنية. علاوة على ذلك، بعد إعادة تشغيل الخدمة، لن يتم تشغيل المهام التي تم تفويتها مرة أخرى. لذلك، عند الاستخدام، قد تحتاج إلى التفكير في معالجة هذه الحالات أو اتخاذ تدابير احتياطية.

### عدد مرات التكرار

عند تحديد شرط الانتهاء "حسب عدد مرات التكرار"، يتم حساب إجمالي عدد مرات التنفيذ لجميع إصدارات **سير العمل** نفسه. على سبيل المثال، إذا تم تنفيذ مهمة مجدولة 10 مرات في الإصدار 1، وتم تعيين عدد مرات التكرار أيضًا على 10، فلن يتم تشغيل **سير العمل** بعد ذلك. حتى إذا تم نسخه إلى إصدار جديد، فلن يتم تشغيله، إلا إذا تم تغيير عدد مرات التكرار إلى رقم أكبر من 10. ومع ذلك، إذا تم نسخه كـ **سير عمل** جديد، فسيتم إعادة تعيين عدد مرات التنفيذ إلى 0. وبدون تعديل التكوينات ذات الصلة، يمكن تشغيل **سير العمل** الجديد 10 مرات أخرى.

### الفرق بين الفاصل الزمني والنمط المتقدم في قواعد التكرار

الفاصل الزمني في قاعدة التكرار يكون نسبيًا لوقت التشغيل الأخير (أو وقت البدء)، بينما يتم التشغيل في النمط المتقدم عند نقاط زمنية ثابتة. على سبيل المثال، إذا تم تكوينه للتشغيل كل 30 دقيقة، وكان التشغيل الأخير في `2021-09-01 12:01:23`، فسيكون وقت التشغيل التالي في `2021-09-01 12:31:23`. أما النمط المتقدم، أي نمط Cron، فيتم تكوين قواعده للتشغيل عند نقاط زمنية ثابتة، على سبيل المثال، يمكن تكوينه للتشغيل في الدقيقة 01 والدقيقة 31 من كل ساعة.

## مثال

لنفترض أننا بحاجة إلى التحقق كل دقيقة من الطلبات التي لم يتم دفعها بعد مرور أكثر من 30 دقيقة على إنشائها، وتغيير حالتها تلقائيًا إلى "ملغاة". سنقوم بتطبيق ذلك باستخدام كلا النمطين.

### نمط الوقت المخصص

أنشئ **سير عمل** يعتمد على مهمة مجدولة. في إعدادات المشغل، اختر نمط "وقت مخصص"، وحدد وقت البدء ليكون أي نقطة زمنية لا تتأخر عن الوقت الحالي، واختر "كل دقيقة" لقاعدة التكرار، واترك شرط الانتهاء فارغًا:

![مهمة مجدولة_إعدادات المشغل_نمط الوقت المخصص](https://static-docs.nocobase.com/71131e3f2034263f883062389b356cbd.png)

بعد ذلك، قم بتكوين العقد الأخرى وفقًا لمنطق العملية، لحساب الوقت قبل 30 دقيقة، وتغيير حالة الطلبات غير المدفوعة التي تم إنشاؤها قبل ذلك الوقت إلى "ملغاة":

![مهمة مجدولة_إعدادات المشغل_نمط الوقت المخصص](https://static-docs.nocobase.com/188bc5287ffa1fb24a4e7baa1de6eb29.png)

بعد تمكين **سير العمل**، سيتم تشغيله مرة واحدة كل دقيقة بدءًا من وقت البدء، لحساب الوقت قبل 30 دقيقة، وذلك لتحديث حالة الطلبات التي تم إنشاؤها قبل تلك النقطة الزمنية إلى "ملغاة".

### نمط حقل الوقت في مجموعة

أنشئ **سير عمل** يعتمد على مهمة مجدولة. في إعدادات المشغل، اختر نمط "حقل الوقت في مجموعة"، وحدد **مجموعة** "الطلبات"، واضبط وقت البدء ليكون بعد 30 دقيقة من وقت إنشاء الطلب، واختر "لا تكرار" لقاعدة التكرار:

![مهمة مجدولة_إعدادات المشغل_نمط حقل الوقت في مجموعة_المشغل](https://static-docs.nocobase.com/d40d5aef57f42799d31cc5882dd94246.png)

بعد ذلك، قم بتكوين العقد الأخرى وفقًا لمنطق العملية لتحديث حالة الطلب الذي يمتلك معرف بيانات المشغل وحالته "غير مدفوع" إلى "ملغاة":

![مهمة مجدولة_إعدادات المشغل_نمط حقل الوقت في مجموعة_عقدة التحديث](https://static-docs.nocobase.com/491dde9df8f773f5b14a4fd8ceac9d3e.png)

على عكس نمط الوقت المخصص، لا داعي هنا لحساب الوقت قبل 30 دقيقة، لأن سياق بيانات تشغيل **سير العمل** يتضمن بالفعل صف البيانات المطابق للشرط الزمني، لذا يمكنك تحديث حالة الطلب المقابل مباشرة.