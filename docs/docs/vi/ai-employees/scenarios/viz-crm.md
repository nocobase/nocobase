
:::tip
Tรi liแปu nรy ฤฦฐแปฃc dแปch bแปi AI. ฤแปi vแปi bแบฅt kแปณ thรดng tin khรดng chรญnh xรกc nรo, vui lรฒng tham khแบฃo [phiรชn bแบฃn tiแบฟng Anh](/en)
:::


# Trแปฃ lรฝ AI ยท Viz: Hฦฐแปng dแบซn cแบฅu hรฌnh kแปch bแบฃn CRM

> Lแบฅy vรญ dแปฅ vแป CRM, tรฌm hiแปu cรกch ฤแป chuyรชn viรชn phรขn tรญch AI cแปงa bแบกn thแปฑc sแปฑ hiแปu nghiแปp vแปฅ vร phรกt huy tแปi ฤa tiแปm nฤng.

## 1. Giแปi thiแปu: Giรบp Viz tแปซ "nhรฌn dแปฏ liแปu" thรnh "hiแปu nghiแปp vแปฅ"

Trong hแป thแปng NocoBase, **Viz** lร mแปt chuyรชn viรชn phรขn tรญch AI ฤฦฐแปฃc tรญch hแปฃp sแบตn.
Viz cรณ thแป nhแบญn diแปn ngแปฏ cแบฃnh trang (vรญ dแปฅ: Khรกch hรng tiแปm nฤng, Cฦก hแปi, Tรi khoแบฃn), tแบกo biแปu ฤแป xu hฦฐแปng, biแปu ฤแป phแปu vร thแบป KPI.
Tuy nhiรชn, theo mแบทc ฤแปnh, Viz chแป cรณ khแบฃ nฤng truy vแบฅn cฦก bแบฃn nhแบฅt:

| Cรดng cแปฅ                      | Mรด tแบฃ chแปฉc nฤng    | Bแบฃo mแบญt  |
| ----------------------- | ------- | ---- |
| Get Collection Names    | Lแบฅy danh sรกch **bแป sฦฐu tแบญp** | โ An toรn |
| Get Collection Metadata | Lแบฅy cแบฅu trรบc trฦฐแปng  | โ An toรn |

Nhแปฏng cรดng cแปฅ nรy chแป giรบp Viz "nhแบญn diแปn cแบฅu trรบc", chแปฉ chฦฐa thแปฑc sแปฑ "hiแปu nแปi dung".
ฤแป Viz tแบกo ra cรกc insight, phรกt hiแปn bแบฅt thฦฐแปng, phรขn tรญch xu hฦฐแปng, bแบกn cแบงn **mแป rแปng thรชm cรกc cรดng cแปฅ phรขn tรญch phรน hแปฃp hฦกn** cho Viz.

Trong bแบฃn demo CRM chรญnh thแปฉc, chรบng tรดi ฤรฃ sแปญ dแปฅng hai phฦฐฦกng phรกp:

*   **Overall Analytics (Cรดng cแปฅ phรขn tรญch tแปng quรกt)**: mแปt giแบฃi phรกp mแบซu hรณa, an toรn vร cรณ thแป tรกi sแปญ dแปฅng;
*   **SQL Execution (Cรดng cแปฅ phรขn tรญch chuyรชn biแปt)**: cรณ ฤแป linh hoแบกt cao hฦกn, nhฦฐng ฤi kรจm rแปงi ro lแปn hฦกn.

Hai phฦฐฦกng phรกp nรy khรดng phแบฃi lร lแปฑa chแปn duy nhแบฅt; chรบng giแปng nhฦฐ mแปt **mรด hรฌnh thiแบฟt kแบฟ** hฦกn:

> Bแบกn cรณ thแป dแปฑa trรชn nguyรชn lรฝ cแปงa chรบng ฤแป tแบกo ra mแปt triแปn khai phรน hแปฃp hฦกn vแปi nghiแปp vแปฅ cแปงa riรชng bแบกn.

---

## 2. Cแบฅu trรบc cแปงa Viz: Tรญnh cรกch แปn ฤแปnh + Nhiแปm vแปฅ linh hoแบกt

ฤแป hiแปu cรกch mแป rแปng Viz, trฦฐแปc tiรชn bแบกn cแบงn hiแปu thiแบฟt kแบฟ phรขn lแปp bรชn trong cแปงa Viz:

| Lแปp       | Mรด tแบฃ                              | Vรญ dแปฅ    |
| -------- | ------------------------------- | ----- |
| **ฤแปnh nghฤฉa vai trรฒ** | Tรญnh cรกch vร phฦฐฦกng phรกp phรขn tรญch cแปงa Viz: Hiแปu โ Truy vแบฅn โ Phรขn tรญch โ Trแปฑc quan hรณa | Cแป ฤแปnh  |
| **ฤแปnh nghฤฉa nhiแปm vแปฅ** | Cรกc cรขu lแปnh tรนy chแปnh vร tแป hแปฃp cรดng cแปฅ cho mแปt kแปch bแบฃn nghiแปp vแปฅ cแปฅ thแป             | Cรณ thแป sแปญa ฤแปi   |
| **Cแบฅu hรฌnh cรดng cแปฅ** | Cแบงu nแปi ฤแป Viz gแปi cรกc **nguแปn dแปฏ liแปu** bรชn ngoรi hoแบทc **luแปng cรดng viแปc**              | Cรณ thแป thay thแบฟ tแปฑ do |

Thiแบฟt kแบฟ phรขn lแปp nรy giรบp Viz duy trรฌ tรญnh cรกch แปn ฤแปnh (logic phรขn tรญch nhแบฅt quรกn),
ฤแปng thแปi cรณ thแป nhanh chรณng thรญch แปฉng vแปi cรกc kแปch bแบฃn nghiแปp vแปฅ khรกc nhau (CRM, quแบฃn lรฝ bแปnh viแปn, phรขn tรญch kรชnh, vแบญn hรnh sแบฃn xuแบฅt...).

## 3. Mรด hรฌnh mแปt: Cรดng cแปฅ phรขn tรญch mแบซu hรณa (Khuyรชn dรนng)

### 3.1 Tแปng quan nguyรชn lรฝ

**Overall Analytics** lร cรดng cแปฅ phรขn tรญch cแปt lรตi trong bแบฃn demo CRM.
Nรณ quแบฃn lรฝ tแบฅt cแบฃ cรกc truy vแบฅn SQL thรดng qua mแปt **bแป sฦฐu tแบญp mแบซu phรขn tรญch dแปฏ liแปu (data_analysis)**.
Viz khรดng trแปฑc tiแบฟp viแบฟt SQL, mร thay vรo ฤรณ **gแปi cรกc mแบซu ฤรฃ ฤแปnh nghฤฉa** ฤแป tแบกo ra kแบฟt quแบฃ.

Luแปng thแปฑc thi nhฦฐ sau:

```mermaid
flowchart TD
    A[Viz nhแบญn nhiแปm vแปฅ] --> B[Gแปi luแปng cรดng viแปc Overall Analytics]
    B --> C[Ghรฉp mแบซu dแปฑa trรชn trang/nhiแปm vแปฅ hiแปn tแบกi]
    C --> D[Thแปฑc thi SQL mแบซu (chแป ฤแปc)]
    D --> E[Trแบฃ vแป kแบฟt quแบฃ dแปฏ liแปu]
    E --> F[Viz tแบกo biแปu ฤแป + diแปn giแบฃi ngแบฏn gแปn]
```

Bแบฑng cรกch nรy, Viz cรณ thแป tแบกo ra kแบฟt quแบฃ phรขn tรญch an toรn vร chuแบฉn hรณa chแป trong vรi giรขy,
vร quแบฃn trแป viรชn cรณ thแป quแบฃn lรฝ, xem xรฉt tแบญp trung tแบฅt cแบฃ cรกc mแบซu SQL.

---

### 3.2 Cแบฅu trรบc **bแป sฦฐu tแบญp** mแบซu (data_analysis)

| Tรชn trฦฐแปng                                               | Kiแปu       | Mรด tแบฃ            | Vรญ dแปฅ                                                 |
| ------------------------------------------------- | -------- | ------------- | -------------------------------------------------- |
| **id**                                            | Integer  | Khรณa chรญnh            | 1                                                  |
| **name**                                          | Text     | Tรชn mแบซu phรขn tรญch        | Leads Data Analysis                                |
| **collection**                                    | Text     | **Bแป sฦฐu tแบญp** tฦฐฦกng แปฉng         | Lead                                               |
| **sql**                                           | Code     | Cรขu lแปnh SQL phรขn tรญch (chแป ฤแปc) | `SELECT stage, COUNT(*) FROM leads GROUP BY stage` |
| **description**                                   | Markdown | Mรด tแบฃ mแบซu hoแบทc ฤแปnh nghฤฉa       | "Thแปng kรช sแป lฦฐแปฃng khรกch hรng tiแปm nฤng theo giai ฤoแบกn"                                        |
| **createdAt / createdBy / updatedAt / updatedBy** | Trฦฐแปng hแป thแปng     | Thรดng tin kiแปm toรกn          | Tแปฑ ฤแปng tแบกo                                               |

#### Vรญ dแปฅ mแบซu trong bแบฃn demo CRM

| Name                             | Collection  | Description |
| -------------------------------- | ----------- | ----------- |
| Account Data Analysis            | Account     | Phรขn tรญch dแปฏ liแปu tรi khoแบฃn      |
| Contact Data Analysis            | Contact     | Phรขn tรญch dแปฏ liแปu liรชn hแป       |
| Leads Data Analysis              | Lead        | Phรขn tรญch xu hฦฐแปng khรกch hรng tiแปm nฤng      |
| Opportunity Data Analysis        | Opportunity | Biแปu ฤแป phแปu giai ฤoแบกn cฦก hแปi      |
| Task Data Analysis               | Todo Tasks  | Thแปng kรช trแบกng thรกi nhiแปm vแปฅ cแบงn lรm    |
| Users (Sales Reps) Data Analysis | Users       | So sรกnh hiแปu suแบฅt cแปงa ฤแบกi diแปn bรกn hรng    |

---

### 3.3 ฦฏu ฤiแปm cแปงa mรด hรฌnh nรy

| Khรญa cแบกnh       | ฦฏu ฤiแปm                     |
| -------- | ---------------------- |
| **Bแบฃo mแบญt**  | Tแบฅt cแบฃ cรกc cรขu lแปnh SQL ฤแปu ฤฦฐแปฃc lฦฐu trแปฏ vร xem xรฉt, trรกnh viแปc tแบกo truy vแบฅn trแปฑc tiแบฟp |
| **Khแบฃ nฤng bแบฃo trรฌ** | Cรกc mแบซu ฤฦฐแปฃc quแบฃn lรฝ tแบญp trung vร cแบญp nhแบญt ฤแปng bแป            |
| **Khแบฃ nฤng tรกi sแปญ dแปฅng**  | Cรนng mแปt mแบซu cรณ thแป ฤฦฐแปฃc tรกi sแปญ dแปฅng cho nhiแปu nhiแปm vแปฅ           |
| **Khแบฃ nฤng di ฤแปng** | Cรณ thแป dแป dรng di chuyแปn sang cรกc hแป thแปng khรกc, chแป cแบงn cแบฅu trรบc **bแป sฦฐu tแบญp** tฦฐฦกng tแปฑ    |
| **Trแบฃi nghiแปm ngฦฐแปi dรนng** | Ngฦฐแปi dรนng nghiแปp vแปฅ khรดng cแบงn quan tรขm ฤแบฟn SQL; hแป chแป cแบงn gแปญi yรชu cแบงu phรขn tรญch  |

> ๐ **Bแป sฦฐu tแบญp** `data_analysis` nรy khรดng nhแบฅt thiแบฟt phแบฃi cรณ tรชn nhฦฐ vแบญy.
> ฤiแปu quan trแปng lร: **lฦฐu trแปฏ logic phรขn tรญch dฦฐแปi dแบกng mแบซu**, vร ฤฦฐแปฃc **luแปng cรดng viแปc** gแปi mแปt cรกch thแปng nhแบฅt.

---

### 3.4 Cรกch ฤแป Viz sแปญ dแปฅng nรณ

Trong ฤแปnh nghฤฉa nhiแปm vแปฅ, bแบกn cรณ thแป nรณi rรต vแปi Viz:

```markdown
Chรo Viz,

Vui lรฒng phรขn tรญch dแปฏ liแปu cแปงa mรด-ฤun hiแปn tแบกi.

**ฦฏu tiรชn:** Sแปญ dแปฅng cรดng cแปฅ Overall Analytics ฤแป lแบฅy kแบฟt quแบฃ phรขn tรญch tแปซ bแป sฦฐu tแบญp mแบซu.
**Nแบฟu khรดng tรฌm thแบฅy mแบซu phรน hแปฃp:** Hรฃy thรดng bรกo rแบฑng mแบซu bแป thiแบฟu vร ฤแป xuแบฅt quแบฃn trแป viรชn bแป sung.

Yรชu cแบงu ฤแบงu ra:
- Mแปi kแบฟt quแบฃ tแบกo mแปt biแปu ฤแป riรชng biแปt;
- Kรจm theo 2โ3 cรขu mรด tแบฃ ngแบฏn gแปn bรชn dฦฐแปi biแปu ฤแป;
- Khรดng bแปa ฤแบทt dแปฏ liแปu hoแบทc ฤฦฐa ra giแบฃ ฤแปnh.
```

Bแบฑng cรกch nรy, Viz sแบฝ tแปฑ ฤแปng gแปi **luแปng cรดng viแปc**, tแปซ **bแป sฦฐu tแบญp** mแบซu, tรฌm SQL phรน hแปฃp nhแบฅt vร tแบกo biแปu ฤแป.

---

## 4. Mรด hรฌnh hai: Trรฌnh thแปฑc thi SQL chuyรชn biแปt (Thแบญn trแปng khi sแปญ dแปฅng)

### 4.1 Kแปch bแบฃn รกp dแปฅng

Khi bแบกn cแบงn phรขn tรญch khรกm phรก, truy vแบฅn tแบกm thแปi, hoแบทc tแปng hแปฃp JOIN nhiแปu **bแป sฦฐu tแบญp**, bแบกn cรณ thแป ฤแป Viz gแปi mแปt cรดng cแปฅ **SQL Execution**.

ฤแบทc ฤiแปm cแปงa cรดng cแปฅ nรy lร:

*   Viz cรณ thแป trแปฑc tiแบฟp tแบกo cรกc truy vแบฅn `SELECT`;
*   Hแป thแปng thแปฑc thi vร trแบฃ vแป kแบฟt quแบฃ;
*   Viz chแปu trรกch nhiแปm phรขn tรญch vร trแปฑc quan hรณa.

Vรญ dแปฅ nhiแปm vแปฅ:

> "Vui lรฒng phรขn tรญch xu hฦฐแปng thay ฤแปi tแปท lแป chuyแปn ฤแปi khรกch hรng tiแปm nฤng theo tแปซng khu vแปฑc trong 90 ngรy gแบงn ฤรขy."

Trong trฦฐแปng hแปฃp nรy, Viz cรณ thแป tแบกo ra:

```sql
SELECT region, COUNT(id) AS leads, SUM(converted)::float/COUNT(id) AS rate
FROM leads
WHERE created_at > now() - interval '90 day'
GROUP BY region;
```

---

### 4.2 Rแปงi ro vร khuyแบฟn nghแป bแบฃo vแป

| ฤiแปm rแปงi ro    | Chiแบฟn lฦฐแปฃc bแบฃo vแป            |
| ------ | --------------- |
| Tแบกo cรกc thao tรกc ghi  | Buแปc giแปi hแบกn chแป `SELECT`  |
| Truy cแบญp cรกc **bแป sฦฐu tแบญp** khรดng liรชn quan  | Xรกc thแปฑc tรชn **bแป sฦฐu tแบญp** cรณ tแปn tแบกi khรดng        |
| Rแปงi ro hiแปu suแบฅt vแปi **bแป sฦฐu tแบญp** lแปn | Giแปi hแบกn phแบกm vi thแปi gian, sแปญ dแปฅng LIMIT cho sแป lฦฐแปฃng hรng |
| Khแบฃ nฤng truy vแบฟt thao tรกc | Bแบญt nhแบญt kรฝ truy vแบฅn vร kiแปm toรกn       |
| Kiแปm soรกt quyแปn ngฦฐแปi dรนng | Chแป quแบฃn trแป viรชn mแปi cรณ thแป sแปญ dแปฅng cรดng cแปฅ nรy      |

> Khuyแบฟn nghแป chung:
>
> *   Ngฦฐแปi dรนng thรดng thฦฐแปng chแป nรชn bแบญt phรขn tรญch mแบซu hรณa (Overall Analytics);
> *   Chแป quแบฃn trแป viรชn hoแบทc chuyรชn viรชn phรขn tรญch cao cแบฅp mแปi ฤฦฐแปฃc phรฉp sแปญ dแปฅng SQL Execution.

---

## 5. Nแบฟu bแบกn muแปn tแปฑ xรขy dแปฑng mแปt "Overall Analytics"

Dฦฐแปi ฤรขy lร mแปt cรกch tiแบฟp cแบญn ฤฦกn giแบฃn, tแปng quรกt mร bแบกn cรณ thแป sao chรฉp vรo bแบฅt kแปณ hแป thแปng nรo (khรดng phแปฅ thuแปc vรo NocoBase):

### Bฦฐแปc 1: Thiแบฟt kแบฟ **bแป sฦฐu tแบญp** mแบซu

Tรชn **bแป sฦฐu tแบญp** cรณ thแป tรนy รฝ (vรญ dแปฅ: `analysis_templates`).
Chแป cแบงn bao gแปm cรกc trฦฐแปng: `name`, `sql`, `collection`, vร `description`.

### Bฦฐแปc 2: Viแบฟt mแปt dแปch vแปฅ hoแบทc **luแปng cรดng viแปc** "Lแบฅy mแบซu โ Thแปฑc thi"

Logic:

1.  Nhแบญn nhiแปm vแปฅ hoแบทc ngแปฏ cแบฃnh trang (vรญ dแปฅ: **bแป sฦฐu tแบญp** hiแปn tแบกi);
2.  Ghรฉp mแบซu;
3.  Thแปฑc thi SQL mแบซu (chแป ฤแปc);
4.  Trแบฃ vแป cแบฅu trรบc dแปฏ liแปu chuแบฉn hรณa (hรng + trฦฐแปng).

### Bฦฐแปc 3: ฤแป AI gแปi giao diแปn nรy

Cรขu lแปnh nhiแปm vแปฅ cรณ thแป ฤฦฐแปฃc viแบฟt nhฦฐ sau:

```
ฤแบงu tiรชn, hรฃy thแปญ gแปi cรดng cแปฅ phรขn tรญch mแบซu. Nแบฟu khรดng tรฌm thแบฅy phรขn tรญch phรน hแปฃp trong cรกc mแบซu, hรฃy sแปญ dแปฅng trรฌnh thแปฑc thi SQL.
Vui lรฒng ฤแบฃm bแบฃo tแบฅt cแบฃ cรกc truy vแบฅn lร chแป ฤแปc vร tแบกo biแปu ฤแป ฤแป hiแปn thแป kแบฟt quแบฃ.
```

> Bแบฑng cรกch nรy, hแป thแปng trแปฃ lรฝ AI cแปงa bแบกn sแบฝ cรณ khแบฃ nฤng phรขn tรญch tฦฐฦกng tแปฑ nhฦฐ bแบฃn demo CRM, nhฦฐng hoรn toรn ฤแปc lแบญp vร cรณ thแป tรนy chแปnh.

---

## 6. Cรกc thแปฑc hรnh tแปt nhแบฅt vร khuyแบฟn nghแป thiแบฟt kแบฟ

| Khuyแบฟn nghแป                     | Mรด tแบฃ                                     |
| ---------------------- | -------------------------------------- |
| **ฦฏu tiรชn phรขn tรญch mแบซu hรณa**            | An toรn, แปn ฤแปnh vร cรณ thแป tรกi sแปญ dแปฅng                              |
| **Chแป sแปญ dแปฅng SQL Execution nhฦฐ mแปt phแบงn bแป sung** | Giแปi hแบกn cho viแปc gแปก lแปi nแปi bแป hoแบทc truy vแบฅn tแบกm thแปi                            |
| **Mแปt biแปu ฤแป, mแปt ฤiแปm chรญnh**              | ฤแบงu ra rรต rรng, trรกnh quรก nhiแปu thรดng tin lแปn xแปn                            |
| **ฤแบทt tรชn mแบซu rรต rรng**             | ฤแบทt tรชn theo trang/lฤฉnh vแปฑc nghiแปp vแปฅ, vรญ dแปฅ: `Leads-Stage-Conversion` |
| **Giแบฃi thรญch ngแบฏn gแปn vร rรต rรng**             | Mแปi biแปu ฤแป kรจm theo 2โ3 cรขu tรณm tแบฏt                          |
| **Thรดng bรกo khi thiแบฟu mแบซu**             | Thรดng bรกo cho ngฦฐแปi dรนng "Khรดng tรฌm thแบฅy mแบซu tฦฐฦกng แปฉng" thay vรฌ hiแปn thแป ฤแบงu ra trแปng                    |

---

## 7. Tแปซ bแบฃn demo CRM ฤแบฟn kแปch bแบฃn cแปงa bแบกn

Dรน bแบกn ฤang lรm CRM bแปnh viแปn, sแบฃn xuแบฅt, kho bรฃi logistics hay tuyแปn sinh giรกo dแปฅc,
chแป cแบงn bแบกn cรณ thแป trแบฃ lแปi ba cรขu hแปi sau, Viz cรณ thแป mang lแบกi giรก trแป cho hแป thแปng cแปงa bแบกn:

| Cรขu hแปi             | Vรญ dแปฅ                  |
| -------------- | ------------------- |
| **1. Bแบกn muแปn phรขn tรญch gรฌ?** | Xu hฦฐแปng khรกch hรng tiแปm nฤng / Giai ฤoแบกn giao dแปch / Tแปท lแป hoแบกt ฤแปng cแปงa thiแบฟt bแป |
| **2. Dแปฏ liแปu แป ฤรขu?**   | **Bแป sฦฐu tแบญp** nรo, trฦฐแปng nรo            |
| **3. Bแบกn muแปn trรฌnh bรy nhฦฐ thแบฟ nรo?**  | Biแปu ฤแป ฤฦฐแปng, phแปu, trรฒn, bแบฃng so sรกnh        |

Mแปt khi bแบกn ฤรฃ ฤแปnh nghฤฉa cรกc nแปi dung nรy, bแบกn chแป cแบงn:

*   Viแบฟt logic phรขn tรญch vรo **bแป sฦฐu tแบญp** mแบซu;
*   ฤรญnh kรจm cรขu lแปnh nhiแปm vแปฅ vรo trang;
*   Viz cรณ thแป "tiแบฟp quแบฃn" viแปc phรขn tรญch bรกo cรกo cแปงa bแบกn.

---

## 8. Kแบฟt luแบญn: Mang theo mรด hรฌnh thiแบฟt kแบฟ

"Overall Analytics" vร "SQL Execution" chแป lร hai vรญ dแปฅ triแปn khai.
ฤiแปu quan trแปng hฦกn lร รฝ tฦฐแปng ฤแบฑng sau chรบng:

> **Hรฃy ฤแป trแปฃ lรฝ AI hiแปu logic nghiแปp vแปฅ cแปงa bแบกn, chแปฉ khรดng chแป thแปฑc thi cรกc cรขu lแปnh.**

Dรน bแบกn ฤang sแปญ dแปฅng NocoBase, mแปt hแป thแปng riรชng, hay **luแปng cรดng viแปc** tแปฑ viแบฟt,
bแบกn ฤแปu cรณ thแป sao chรฉp cแบฅu trรบc nรy:

*   Cรกc mแบซu tแบญp trung;
*   **Luแปng cรดng viแปc** gแปi;
*   Thแปฑc thi chแป ฤแปc;
*   AI trรฌnh bรy.

Bแบฑng cรกch nรy, Viz khรดng cรฒn chแป lร mแปt "AI cรณ thแป tแบกo biแปu ฤแป",
mร lร mแปt chuyรชn viรชn phรขn tรญch thแปฑc thแปฅ, hiแปu dแปฏ liแปu, hiแปu ฤแปnh nghฤฉa vร hiแปu nghiแปp vแปฅ cแปงa bแบกn.