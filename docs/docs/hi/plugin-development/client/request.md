:::tip
рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдХрд┐рд╕реА рднреА рдЕрд╢реБрджреНрдзрд┐ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ [рдЕрдВрдЧреНрд░реЗрдЬреА рд╕рдВрд╕реНрдХрд░рдг](/en) рджреЗрдЦреЗрдВ
:::

# рдЕрдиреБрд░реЛрдз

NocoBase, [Axios](https://axios-http.com/) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ `APIClient` рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рдХрд┐рд╕реА рднреА рдРрд╕реА рдЬрдЧрд╣ рд╕реЗ HTTP рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ `Context` рдЙрдкрд▓рдмреНрдз рд╣реЛред

рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд╛рди рдЬрд╣рд╛рдБ рдЖрдк `Context` рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдирдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

- `app.context`
- `engine.context`
- `plugin.context`
- `model.context`

## ctx.api.request()

`ctx.api.request()` рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рддрд░реАрдХрд╛ рд╣реИред рдЗрд╕рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рдФрд░ рд░рд┐рдЯрд░реНрди рд╡реИрд▓реНрдпреВ [axios.request()](https://axios-http.com/docs/req_config) рдХреЗ рд╕рдорд╛рди рд╣реА рд╣реИрдВред

```ts
request<T = any, R = AxiosResponse<T>, D = any>(
  config: AxiosRequestConfig<D>,
): Promise<R>;
```

рдмреБрдирд┐рдпрд╛рджреА рдЙрдкрдпреЛрдЧ

```ts
await ctx.api.request({
  url: 'users:list',
  method: 'get',
});
```

рдЖрдк рд╕реАрдзреЗ рдорд╛рдирдХ Axios рдЕрдиреБрд░реЛрдз рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```ts
await ctx.api.request({
  url: 'users:create',
  method: 'post',
  data: {
    name: 'Tao Tao',
  },
});
```

## ctx.api.axios

`ctx.api.axios` рдПрдХ `AxiosInstance` рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдк рд╡реИрд╢реНрд╡рд┐рдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЕрдиреБрд░реЛрдз рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

```ts
axios.defaults.headers.common['Authorization'] = AUTH_TOKEN;
axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
```

рдЕрдзрд┐рдХ рдЙрдкрд▓рдмреНрдз рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП, [Axios рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди](https://axios-http.com/docs/config_defaults) рджреЗрдЦреЗрдВред

## рдЕрдиреБрд░реЛрдз рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░

рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рдЖрдиреЗ рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░ рдХреЛ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдПрдХ рд╕рдорд╛рди рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рджрд┐рдЦрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреБрд░реЛрдз рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рдЙрджрд╛рд╣рд░рдг

```ts
// qs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВ
axios.interceptors.request.use((config) => {
  config.paramsSerializer = (params) =>
    qs.stringify(params, {
      strictNullHandling: true,
      arrayFormat: 'brackets',
    });
  return config;
});

// рдХрд╕реНрдЯрдо рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░
axios.interceptors.request.use((config) => {
  config.headers['Authorization'] = `Bearer token123`;
  config.headers['X-Hostname'] = 'localhost';
  config.headers['X-Timezone'] = '+08:00';
  config.headers['X-Locale'] = 'zh-CN';
  config.headers['X-Role'] = 'admin';
  config.headers['X-Authenticator'] = 'basic';
  config.headers['X-App'] = 'sub1';
  return config;
});
```

### рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рдЙрджрд╛рд╣рд░рдг

```ts
axios.interceptors.response.use(
  (response) => response,
  (error) => {
    // рдЕрдиреБрд░реЛрдз рд╡рд┐рдлрд▓ рд╣реЛрдиреЗ рдкрд░, рдПрдХ рд╕рдорд╛рди рд╕реВрдЪрдирд╛ рджрд┐рдЦрд╛рдПрдБ
    ctx.notification.error({
      message: 'рдЕрдиреБрд░реЛрдз рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рддреНрд░реБрдЯрд┐',
    });
    return Promise.reject(error);
  },
);
```

## NocoBase рд╕рд░реНрд╡рд░ рдХрд╕реНрдЯрдо рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░

NocoBase рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдХрд╕реНрдЯрдо рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╣реИрдВ, рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдорд▓реНрдЯреА-рдРрдк, рдЕрдВрддрд░реНрд░рд╛рд╖реНрдЯреНрд░реАрдпрдХрд░рдг, рдорд▓реНрдЯреА-рд░реЛрд▓ рдпрд╛ рдорд▓реНрдЯреА-рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

| рд╣реЗрдбрд░ | рд╡рд┐рд╡рд░рдг |
|--------|------|
| `X-App` | рдорд▓реНрдЯреА-рдРрдк рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдП рдЧрдП рдРрдк рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ |
| `X-Locale` | рд╡рд░реНрддрдорд╛рди рднрд╛рд╖рд╛ (рдЬреИрд╕реЗ: `zh-CN`, `en-US`) |
| `X-Hostname` | рдХреНрд▓рд╛рдЗрдВрдЯ рд╣реЛрд╕реНрдЯрдирд╛рдо |
| `X-Timezone` | рдХреНрд▓рд╛рдЗрдВрдЯ рдЯрд╛рдЗрдордЬрд╝реЛрди (рдЬреИрд╕реЗ: `+08:00`) |
| `X-Role` | рд╡рд░реНрддрдорд╛рди рднреВрдорд┐рдХрд╛ |
| `X-Authenticator` | рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ |

> ЁЯТб **рдЯрд┐рдк**  
> рдпреЗ рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░ рдЖрдорддреМрд░ рдкрд░ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЗрдиреНрд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдХреЗрд╡рд▓ рд╡рд┐рд╢реЗрд╖ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ (рдЬреИрд╕реЗ рдкрд░реАрдХреНрд╖рдг рд╡рд╛рддрд╛рд╡рд░рдг рдпрд╛ рдорд▓реНрдЯреА-рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░рд┐рджреГрд╢реНрдп) рдЖрдкрдХреЛ рдЗрдиреНрд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред

## рдХрдВрдкреЛрдиреЗрдВрдЯреНрд╕ рдореЗрдВ рдЙрдкрдпреЛрдЧ

React рдХрдВрдкреЛрдиреЗрдВрдЯреНрд╕ рдореЗрдВ, рдЖрдк `useFlowContext()` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП `ctx.api` рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```ts
import { useFlowContext } from '@nocobase/client';

const MyComponent = () => {
  const ctx = useFlowContext();

  const fetchData = async () => {
    const response = await ctx.api.request({
      url: '/api/posts',
      method: 'get',
    });
    console.log(response.data);
  };

  useEffect(() => {
    fetchData();
  }, []);

  return <div>рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</div>;
};
```

### ahooks рдХреЗ useRequest рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡рд┐рдХрд╛рд╕ рдореЗрдВ, рдЖрдк рдЕрдиреБрд░реЛрдз рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рдФрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдзрд┐рдХ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП [ahooks](https://ahooks.js.org/hooks/use-request/index) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП `useRequest` рд╣реБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```ts
import { useFlowContext } from '@nocobase/client';
import { useRequest } from 'ahooks';

const MyComponent = () => {
  const ctx = useFlowContext();

  const { data, loading, error, refresh } = useRequest(() =>
    ctx.api.request({
      url: 'posts:list',
      method: 'get',
    }),
  );

  if (loading) return <div>рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</div>;
  if (error) return <div>рдЕрдиреБрд░реЛрдз рддреНрд░реБрдЯрд┐: {error.message}</div>;

  return (
    <div>
      <button onClick={refresh}>рд░реАрдлреНрд░реЗрд╢ рдХрд░реЗрдВ</button>
      <pre>{JSON.stringify(data?.data, null, 2)}</pre>
    </div>
  );
};
```

рдпрд╣ рддрд░реАрдХрд╛ рдЕрдиреБрд░реЛрдз рд▓реЙрдЬрд┐рдХ рдХреЛ рдЕрдзрд┐рдХ рдбрд┐рдХреНрд▓реЗрд░реЗрдЯрд┐рд╡ рдмрдирд╛рддрд╛ рд╣реИ, рд▓реЛрдбрд┐рдВрдЧ рд╕реНрдерд┐рддрд┐, рддреНрд░реБрдЯрд┐ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдФрд░ рд░реАрдлреНрд░реЗрд╢ рд▓реЙрдЬрд┐рдХ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрдВрдкреЛрдиреЗрдВрдЯреНрд╕ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдкрдпреБрдХреНрдд рд╣реИред