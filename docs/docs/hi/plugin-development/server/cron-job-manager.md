:::tip
рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдХрд┐рд╕реА рднреА рдЕрд╢реБрджреНрдзрд┐ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ [рдЕрдВрдЧреНрд░реЗрдЬреА рд╕рдВрд╕реНрдХрд░рдг](/en) рджреЗрдЦреЗрдВ
:::

# CronJobManager рдирд┐рдпрдд рдХрд╛рд░реНрдп рдкреНрд░рдмрдВрдзрдХ

`CronJobManager` NocoBase рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдХ [cron](https://www.npmjs.com/package/cron) рдЖрдзрд╛рд░рд┐рдд рдирд┐рдпрдд рдХрд╛рд░реНрдп рдкреНрд░рдмрдВрдзрдХ рд╣реИред рдпрд╣ рдкреНрд▓рдЧрдЗрди рдХреЛ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдирд┐рдпрдд рдХрд╛рд░реНрдп рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рддрд╛рдХрд┐ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓реЙрдЬрд┐рдХ рдХреЛ рд╕рдордп-рд╕рдордп рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

## рдореВрд▓ рдЙрдкрдпреЛрдЧ

```ts
import { Plugin } from '@nocobase/server';

export default class PluginCronDemo extends Plugin {
  async load() {
    this.app.cronJobManager.addJob({
      cronTime: '0 0 * * *', // рд░реЛрдЬрд╝рд╛рдирд╛ 00:00 рдмрдЬреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ
      onTick: async () => {
        console.log('рджреИрдирд┐рдХ рдХрд╛рд░реНрдп: рдЕрд╕реНрдерд╛рдпреА рдбреЗрдЯрд╛ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ');
        await this.cleanTemporaryData();
      },
      timeZone: 'Asia/Shanghai',
      start: true, // рд╕реНрд╡рддрдГ рд╢реБрд░реВ рдХрд░реЗрдВ
    });
  }

  async cleanTemporaryData() {
    // рдпрд╣рд╛рдБ рд╕рдлрд╝рд╛рдИ рд▓реЙрдЬрд┐рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ
  }
}
```

## рдкреИрд░рд╛рдореАрдЯрд░ рд╡рд┐рд╡рд░рдг

`CronJobParameters` рдкреНрд░рдХрд╛рд░ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ ([cron](https://www.npmjs.com/package/cron) рд╕реЗ):

```ts
export declare interface CronJobParameters {
  cronTime: string | Date | DateTime;
  onTick: CronCommand;
  onComplete?: CronCommand | null;
  start?: boolean;
  timeZone?: string;
  context?: any;
  runOnInit?: boolean;
  utcOffset?: string | number;
  unrefTimeout?: boolean;
}
```

| рдкреИрд░рд╛рдореАрдЯрд░         | рдкреНрд░рдХрд╛рд░                     | рд╡рд┐рд╡рд░рдг                                                                                             |
| :--------------- | :------------------------- | :------------------------------------------------------------------------------------------------ |
| **cronTime**     | `string \| Date \| DateTime` | рдирд┐рдпрдд рдХрд╛рд░реНрдп рдХрд╛ рд╕рдордп рдПрдХреНрд╕рдкреНрд░реЗрд╢рдиред рдорд╛рдирдХ cron рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `0 0 * * *` рдХрд╛ рдЕрд░реНрде рд╣реИ рд░реЛрдЬрд╝рд╛рдирд╛ 00:00 рдмрдЬреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВред |
| **onTick**       | `function`                 | рдХрд╛рд░реНрдп рдХрд╛ рдореБрдЦреНрдп рдлрд╝рдВрдХреНрд╢рдиред рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдордп рдкрд░ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛ред                                            |
| **onComplete**   | `function`                 | рдЬрдм рдХрд╛рд░реНрдп рдХреЛ `job.stop()` рджреНрд╡рд╛рд░рд╛ рд░реЛрдХрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ `onTick` рдлрд╝рдВрдХреНрд╢рди рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рддрдм рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИред |
| **timeZone**     | `string`                   | рдирд┐рд╖реНрдкрд╛рджрди рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `Asia/Shanghai`)ред                               |
| **context**      | `any`                      | `onTick` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдХрд╛ рд╕рдВрджрд░реНрднред                                                              |
| **runOnInit**    | `boolean`                  | рдХреНрдпрд╛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкрд░ рддреБрд░рдВрдд рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реИред                                               |
| **utcOffset**    | `string \| number`         | рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдСрдлрд╝рд╕реЗрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред                                                                  |
| **unrefTimeout** | `boolean`                  | рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╡реЗрдВрдЯ рд▓реВрдк рд╕рдХреНрд░рд┐рдп рд░рд╣рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред                                                |

## Cron рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдХреЗ рдЙрджрд╛рд╣рд░рдг

| рдПрдХреНрд╕рдкреНрд░реЗрд╢рди       | рдЕрд░реНрде                     |
| :------------- | :----------------------- |
| `* * * * *`    | рд╣рд░ рдорд┐рдирдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ      |
| `0 * * * *`    | рд╣рд░ рдШрдВрдЯреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ      |
| `0 0 * * *`    | рд░реЛрдЬрд╝рд╛рдирд╛ 00:00 рдмрдЬреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ |
| `0 9 * * 1`    | рд╣рд░ рд╕реЛрдорд╡рд╛рд░ 09:00 рдмрдЬреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ |
| `*/10 * * * *` | рд╣рд░ 10 рдорд┐рдирдЯ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ |

> ЁЯТб рдЖрдк рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХреЗ рд▓рд┐рдП [crontab.guru](https://crontab.guru/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рдХрд╛рд░реНрдп рдХреЗ рд╢реБрд░реВ рдФрд░ рдмрдВрдж рд╣реЛрдиреЗ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВ

```ts
const job = app.cronJobManager.addJob({ ... });
job.start(); // рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░реЗрдВ
job.stop();  // рдХрд╛рд░реНрдп рдмрдВрдж рдХрд░реЗрдВ
```

:::tip

рдирд┐рдпрдд рдХрд╛рд░реНрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдмрдВрдж рд╣реЛрдиреЗ рдкрд░ рдмрдВрдж рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рди рд╣реЛ, рддреЛ рдЖрдкрдХреЛ рдЖрдорддреМрд░ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╢реБрд░реВ рдпрд╛ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред

:::