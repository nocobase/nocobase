:::tip
เอกสารนี้แปลโดย AI หากมีข้อมูลที่ไม่ถูกต้อง โปรดดู[เวอร์ชันภาษาอังกฤษ](/en)
:::


# การสอบถามข้อมูล

แผงการตั้งค่าสำหรับแผนภูมิจะแบ่งออกเป็นสามส่วนหลักๆ ได้แก่ การสอบถามข้อมูล (Data query), ตัวเลือกแผนภูมิ (Chart options) และเหตุการณ์การโต้ตอบ (Interaction events) นอกจากนี้ยังมีปุ่มยกเลิก (Cancel), ดูตัวอย่าง (Preview) และบันทึก (Save) อยู่ด้านล่างสุดครับ/ค่ะ

ก่อนอื่น เรามาดูที่แผง "การสอบถามข้อมูล" กันก่อนนะครับ/คะ เพื่อทำความเข้าใจโหมดการสอบถามข้อมูลทั้งสองแบบ (Builder/SQL) และฟังก์ชันที่ใช้งานบ่อยๆ ครับ/ค่ะ

## โครงสร้างแผงควบคุม
![clipboard-image-1761466636](https://static-docs.nocobase.com/clipboard-image-1761466636.png)

> [!TIP]
> เพื่อให้การตั้งค่าเนื้อหาปัจจุบันง่ายขึ้น คุณสามารถยุบแผงควบคุมอื่นๆ ลงก่อนได้ครับ/ค่ะ

ส่วนบนสุดคือแถบเครื่องมือครับ/ค่ะ
- โหมด (Mode): Builder (แบบกราฟิก ใช้งานง่ายและสะดวก) / SQL (เขียนคำสั่งเอง มีความยืดหยุ่นสูงกว่า)
- เรียกใช้การสอบถาม (Run query): คลิกเพื่อส่งคำขอสอบถามข้อมูล
- ดูผลลัพธ์ (View result): เปิดแผงผลลัพธ์ข้อมูล ซึ่งคุณสามารถสลับดูได้ทั้งแบบ Table/JSON คลิกอีกครั้งเพื่อยุบแผงควบคุมครับ/ค่ะ

จากบนลงล่างตามลำดับ มีดังนี้ครับ/ค่ะ
- แหล่งข้อมูล (Data Source) และ คอลเลกชัน (Collection): จำเป็นต้องระบุ เลือกแหล่งข้อมูลและตารางข้อมูลครับ/ค่ะ
- การวัด (Measures): จำเป็นต้องระบุ เป็นฟิลด์ตัวเลขที่จะแสดงผลครับ/ค่ะ
- มิติ (Dimensions): ใช้สำหรับจัดกลุ่มตามฟิลด์ต่างๆ (เช่น วันที่, หมวดหมู่, ภูมิภาค)
- ตัวกรอง (Filter): กำหนดเงื่อนไขการกรอง (เช่น =, ≠, >, <, มี, ช่วง) สามารถรวมหลายเงื่อนไขเข้าด้วยกันได้ครับ/ค่ะ
- การจัดเรียง (Sort): เลือกฟิลด์ที่ต้องการจัดเรียงและลำดับ (จากน้อยไปมาก/จากมากไปน้อย)
- การแบ่งหน้า (Pagination): ควบคุมช่วงข้อมูลและลำดับการส่งคืนผลลัพธ์ครับ/ค่ะ

## โหมด Builder

### การเลือกแหล่งข้อมูลและคอลเลกชัน
- ในแผง "การสอบถามข้อมูล" ให้เลือกโหมดเป็น "Builder" ครับ/ค่ะ
- เลือกแหล่งข้อมูล (Data Source) และ คอลเลกชัน (Collection) (ตารางข้อมูล) หากไม่สามารถเลือกคอลเลกชันได้หรือคอลเลกชันว่างเปล่า ให้ตรวจสอบสิทธิ์การเข้าถึงและสถานะการสร้างคอลเลกชันก่อนเป็นอันดับแรกครับ/ค่ะ

### การตั้งค่าการวัด (Measures)
- เลือกฟิลด์ตัวเลขหนึ่งฟิลด์หรือมากกว่า และตั้งค่าการรวมข้อมูล (aggregation) เช่น `Sum`, `Count`, `Avg`, `Max`, `Min`
- กรณีใช้งานทั่วไป: `Count` สำหรับนับจำนวนรายการ และ `Sum` สำหรับคำนวณยอดรวมครับ/ค่ะ

### การตั้งค่ามิติ (Dimensions)
- เลือกฟิลด์หนึ่งฟิลด์หรือมากกว่าเพื่อใช้เป็นมิติสำหรับการจัดกลุ่ม
- ฟิลด์วันที่และเวลาสามารถตั้งค่ารูปแบบได้ (เช่น `YYYY-MM`, `YYYY-MM-DD`) เพื่อให้ง่ายต่อการจัดกลุ่มตามเดือนหรือวันครับ/ค่ะ

### การกรอง, การจัดเรียง และการแบ่งหน้า
- ตัวกรอง (Filter): เพิ่มเงื่อนไข (เช่น =, ≠, มี, ช่วง) สามารถรวมหลายเงื่อนไขเข้าด้วยกันได้ครับ/ค่ะ
- การจัดเรียง (Sort): เลือกฟิลด์และลำดับการจัดเรียง (จากน้อยไปมาก/จากมากไปน้อย)
- การแบ่งหน้า (Pagination): ตั้งค่า `Limit` และ `Offset` เพื่อควบคุมจำนวนแถวที่ส่งคืน แนะนำให้ตั้งค่า `Limit` ให้มีค่าน้อยๆ ในระหว่างการดีบักครับ/ค่ะ

### การเรียกใช้การสอบถามและดูผลลัพธ์
- คลิก "เรียกใช้การสอบถาม" เพื่อดำเนินการ หลังจากได้ผลลัพธ์แล้ว ให้สลับไปที่ `Table / JSON` ในส่วน "ดูผลลัพธ์" เพื่อตรวจสอบคอลัมน์และค่าต่างๆ ครับ/ค่ะ
- ก่อนที่จะแมปฟิลด์แผนภูมิ ให้ยืนยันชื่อคอลัมน์และประเภทข้อมูลที่นี่ก่อน เพื่อป้องกันไม่ให้แผนภูมิว่างเปล่าหรือเกิดข้อผิดพลาดในภายหลังครับ/ค่ะ

![20251026174338](https://static-docs.nocobase.com/20251026174338.png)

### การแมปฟิลด์ในภายหลัง

ในขั้นตอนต่อไป เมื่อตั้งค่า "ตัวเลือกแผนภูมิ" คุณจะต้องทำการแมปฟิลด์โดยอ้างอิงจากฟิลด์ในตารางของแหล่งข้อมูลและคอลเลกชันที่คุณเลือกไว้ครับ/ค่ะ

## โหมด SQL

### การเขียนคำสั่งสอบถาม
- สลับไปที่โหมด "SQL" ป้อนคำสั่งสอบถามของคุณ แล้วคลิก "เรียกใช้การสอบถาม" ครับ/ค่ะ
- ตัวอย่าง (ยอดรวมคำสั่งซื้อตามวันที่):
```sql
SELECT 
  TO_CHAR(order_date, 'YYYY-MM') as mon,
  SUM(total_amount) AS total
FROM "order"
GROUP BY mon
ORDER BY mon ASC
LIMIT 100;
```

![20251026175952](https://static-docs.nocobase.com/20251026175952.png)

### การเรียกใช้การสอบถามและดูผลลัพธ์

- คลิก "เรียกใช้การสอบถาม" เพื่อดำเนินการ หลังจากได้ผลลัพธ์แล้ว ให้สลับไปที่ `Table / JSON` ในส่วน "ดูผลลัพธ์" เพื่อตรวจสอบคอลัมน์และค่าต่างๆ ครับ/ค่ะ
- ก่อนที่จะแมปฟิลด์แผนภูมิ ให้ยืนยันชื่อคอลัมน์และประเภทข้อมูลที่นี่ก่อน เพื่อป้องกันไม่ให้แผนภูมิว่างเปล่าหรือเกิดข้อผิดพลาดในภายหลังครับ/ค่ะ

### การแมปฟิลด์ในภายหลัง

ในขั้นตอนต่อไป เมื่อตั้งค่า "ตัวเลือกแผนภูมิ" คุณจะต้องทำการแมปฟิลด์โดยอ้างอิงจากคอลัมน์ผลลัพธ์ของการสอบถามข้อมูลครับ/ค่ะ

> [!TIP]
> สำหรับข้อมูลเพิ่มเติมเกี่ยวกับโหมด SQL โปรดดูที่ การใช้งานขั้นสูง — การสอบถามข้อมูลในโหมด SQL ครับ/ค่ะ