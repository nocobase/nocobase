:::tip
เอกสารนี้แปลโดย AI หากมีข้อมูลที่ไม่ถูกต้อง โปรดดู[เวอร์ชันภาษาอังกฤษ](/en)
:::


# การซิงค์ข้อมูลผู้ใช้ผ่าน HTTP API

## การขอรับคีย์ API

โปรดดูที่ [คีย์ API](/auth-verification/api-keys) เพื่อให้แน่ใจว่าบทบาทที่กำหนดให้กับคีย์ API มีสิทธิ์ที่จำเป็นในการซิงค์ข้อมูลผู้ใช้ครับ/ค่ะ

## ภาพรวม API

### ตัวอย่าง

```bash
curl 'https://localhost:13000/api/userData:push' \
  -H 'Authorization: Bearer <token>' \
  --data-raw '{"dataType":"user","records":[]}' # ดูรายละเอียดของ Request Body ได้ที่ด้านล่างครับ/ค่ะ
```

### เอนด์พอยต์

```bash
POST /api/userData:push
```

### รูปแบบข้อมูลผู้ใช้

#### UserData

| พารามิเตอร์  | ชนิดข้อมูล                 | คำอธิบาย                                                                 |
| ---------- | -------------------------- | ------------------------------------------------------------------------ |
| `dataType` | `'user' \| 'department'`   | จำเป็น ต้องระบุชนิดข้อมูลที่จะส่ง ใช้ `user` สำหรับการส่งข้อมูลผู้ใช้    |
| `matchKey` | `'username' \| 'email' \| 'phone'` | ไม่จำเป็น ใช้สำหรับจับคู่ผู้ใช้ที่มีอยู่ในระบบ โดยอิงจากฟิลด์ที่ระบุ |
| `records`  | `UserRecord[]`             | จำเป็น อาร์เรย์ของเรคคอร์ดข้อมูลผู้ใช้                                   |

#### UserRecord

| พารามิเตอร์     | ชนิดข้อมูล | คำอธิบาย                                                                                                 |
| ------------- | ---------- | ----------------------------------------------------------------------------------------------------------- |
| `uid`         | `string`   | จำเป็น ตัวระบุเฉพาะสำหรับข้อมูลผู้ใช้ต้นทาง ใช้เพื่อเชื่อมโยงข้อมูลต้นทางกับผู้ใช้ในระบบ ไม่สามารถเปลี่ยนแปลงได้สำหรับผู้ใช้คนเดิม |
| `nickname`    | `string`   | ไม่จำเป็น ชื่อเล่นของผู้ใช้                                                                                  |
| `username`    | `string`   | ไม่จำเป็น ชื่อผู้ใช้                                                                                         |
| `email`       | `string`   | ไม่จำเป็น ที่อยู่อีเมลของผู้ใช้                                                                             |
| `phone`       | `string`   | ไม่จำเป็น หมายเลขโทรศัพท์ของผู้ใช้                                                                              |
| `departments` | `string[]` | ไม่จำเป็น อาร์เรย์ของ UID แผนกที่ผู้ใช้สังกัดอยู่                                                          |
| `isDeleted`   | `boolean`  | ไม่จำเป็น ระบุว่าเรคคอร์ดถูกลบหรือไม่                                                                         |
| `<field>`     | `any`      | ไม่จำเป็น ข้อมูลฟิลด์ที่กำหนดเองในตารางผู้ใช้                                                                  |

### รูปแบบข้อมูลแผนก

:::info
การส่งข้อมูลแผนกจำเป็นต้องมีการติดตั้งและเปิดใช้งานปลั๊กอิน [แผนก](../../departments) ครับ/ค่ะ
:::

#### DepartmentData

| พารามิเตอร์  | ชนิดข้อมูล                 | คำอธิบาย                                                                |
| ---------- | -------------------------- | -------------------------------------------------------------------------- |
| `dataType` | `'user' \| 'department'`   | จำเป็น ต้องระบุชนิดข้อมูลที่จะส่ง ใช้ `department` สำหรับการส่งข้อมูลแผนก |
| `records`  | `DepartmentRecord[]`       | จำเป็น อาร์เรย์ของเรคคอร์ดข้อมูลแผนก                                |

#### DepartmentRecord

| พารามิเตอร์   | ชนิดข้อมูล | คำอธิบาย                                                                                                       |
| ----------- | --------- | ------------------------------------------------------------------------------------------------------------------- |
| `uid`       | `string`  | จำเป็น ตัวระบุเฉพาะสำหรับข้อมูลแผนกต้นทาง ใช้เพื่อเชื่อมโยงข้อมูลต้นทางกับแผนกในระบบ ไม่สามารถเปลี่ยนแปลงได้สำหรับแผนกเดิม |
| `title`     | `string`  | จำเป็น ชื่อแผนก                                                                                         |
| `parentUid` | `string`  | ไม่จำเป็น UID ของแผนกแม่                                                                             |
| `isDeleted` | `boolean` | ไม่จำเป็น ระบุว่าเรคคอร์ดถูกลบหรือไม่                                                                         |
| `<field>`   | `any`     | ไม่จำเป็น ข้อมูลฟิลด์ที่กำหนดเองในตารางแผนก                                                                    |

:::info

1.  การส่งข้อมูลหลายครั้งเป็นแบบ Idempotent ครับ/ค่ะ
2.  หากแผนกแม่ยังไม่ได้ถูกสร้างขึ้นในขณะที่ส่งข้อมูลแผนก จะไม่สามารถเชื่อมโยงได้ คุณสามารถส่งข้อมูลซ้ำได้อีกครั้งหลังจากที่สร้างแผนกแม่แล้วครับ/ค่ะ
3.  หากแผนกของผู้ใช้ยังไม่ได้ถูกสร้างขึ้นในขณะที่ส่งข้อมูลผู้ใช้ ผู้ใช้จะไม่สามารถเชื่อมโยงกับแผนกนั้นได้ คุณสามารถส่งข้อมูลผู้ใช้ซ้ำได้อีกครั้งหลังจากที่ส่งข้อมูลแผนกแล้วครับ/ค่ะ

:::