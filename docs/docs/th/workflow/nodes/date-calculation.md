---
pkg: '@nocobase/plugin-workflow-date-calculation'
---
:::tip
เอกสารนี้แปลโดย AI หากมีข้อมูลที่ไม่ถูกต้อง โปรดดู[เวอร์ชันภาษาอังกฤษ](/en)
:::

# การคำนวณวันที่

## บทนำ

โหนดการคำนวณวันที่มีฟังก์ชันการคำนวณให้เลือกใช้ 9 ฟังก์ชัน เช่น การเพิ่มหรือลดช่วงเวลา, การจัดรูปแบบเอาต์พุตของสตริงเวลา, และการแปลงหน่วยระยะเวลา แต่ละฟังก์ชันมีประเภทของค่าอินพุตและเอาต์พุตที่เฉพาะเจาะจง และยังสามารถรับผลลัพธ์จากโหนดอื่น ๆ มาใช้เป็นตัวแปรพารามิเตอร์ได้อีกด้วย โดยจะใช้การทำงานแบบไปป์ไลน์ (pipeline) เพื่อเชื่อมโยงผลลัพธ์ของการคำนวณจากฟังก์ชันที่ตั้งค่าไว้ เพื่อให้ได้ผลลัพธ์สุดท้ายตามที่ต้องการครับ/ค่ะ

## การสร้างโหนด

ในหน้าจอการตั้งค่า**เวิร์กโฟลว์** ให้คลิกปุ่มเครื่องหมายบวก ("+") ในโฟลว์ เพื่อเพิ่มโหนด "การคำนวณวันที่" ครับ/ค่ะ

![โหนดการคำนวณวันที่_การสร้างโหนด](https://static-docs.nocobase.com/[图片].png)

## การตั้งค่าโหนด

![โหนดการคำนวณวันที่_การตั้งค่าโหนด](https://static-docs.nocobase.com/20240817184423.png)

### ค่าอินพุต

ค่าอินพุตสามารถเป็นได้ทั้งตัวแปรหรือค่าคงที่ที่เป็นวันที่ครับ/ค่ะ ตัวแปรอาจเป็นข้อมูลที่เรียกใช้งาน**เวิร์กโฟลว์**นี้ หรือเป็นผลลัพธ์จากโหนดต้นทางใน**เวิร์กโฟลว์**นี้ก็ได้ ส่วนค่าคงที่นั้น คุณสามารถเลือกวันที่ใดก็ได้ครับ/ค่ะ

### ประเภทของค่าอินพุต

หมายถึงประเภทของค่าอินพุต ซึ่งมีอยู่สองประเภทครับ/ค่ะ

*   ประเภทวันที่ (Date type): หมายถึงค่าอินพุตที่สามารถแปลงเป็นรูปแบบวันที่และเวลาได้ในที่สุด เช่น ค่าตัวเลขที่เป็น Timestamp หรือสตริงที่แสดงถึงเวลาครับ/ค่ะ
*   ประเภทตัวเลข (Number type): เนื่องจากประเภทของค่าอินพุตจะส่งผลต่อการเลือกขั้นตอนการคำนวณเวลาถัดไป จึงจำเป็นต้องเลือกประเภทของค่าอินพุตให้ถูกต้องครับ/ค่ะ

### ขั้นตอนการคำนวณ

แต่ละขั้นตอนการคำนวณประกอบด้วยฟังก์ชันการคำนวณหนึ่งฟังก์ชันและการตั้งค่าพารามิเตอร์ที่เกี่ยวข้องครับ/ค่ะ โดยใช้การออกแบบแบบไปป์ไลน์ (pipeline) ซึ่งผลลัพธ์จากการคำนวณของฟังก์ชันก่อนหน้าจะถูกนำไปใช้เป็นค่าอินพุตสำหรับการคำนวณของฟังก์ชันถัดไป ด้วยวิธีนี้ จะสามารถดำเนินการคำนวณและแปลงค่าเวลาได้อย่างต่อเนื่องครับ/ค่ะ

หลังจากแต่ละขั้นตอนการคำนวณ ประเภทของเอาต์พุตจะถูกกำหนดไว้ตายตัว และจะส่งผลต่อฟังก์ชันที่สามารถใช้ได้ในขั้นตอนการคำนวณถัดไปครับ/ค่ะ การคำนวณจะดำเนินต่อไปได้ก็ต่อเมื่อประเภทของข้อมูลตรงกันเท่านั้น มิฉะนั้น ผลลัพธ์ของขั้นตอนนี้จะกลายเป็นเอาต์พุตสุดท้ายของโหนดครับ/ค่ะ

## ฟังก์ชันการคำนวณ

### เพิ่มช่วงเวลา

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   จำนวนที่ต้องการเพิ่ม ซึ่งสามารถระบุเป็นตัวเลข หรือเลือกจากตัวแปรที่มาพร้อมกับโหนดได้ครับ/ค่ะ
    -   หน่วยเวลา
-   ประเภทค่าเอาต์พุต: วันที่
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 00:00:00` จำนวนที่เพิ่มคือ `1` และหน่วยคือ "วัน" ผลลัพธ์ที่ได้คือ `2024-7-16 00:00:00` ครับ/ค่ะ

### ลบช่วงเวลา

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   จำนวนที่ต้องการลด ซึ่งสามารถระบุเป็นตัวเลข หรือเลือกจากตัวแปรที่มาพร้อมกับโหนดได้ครับ/ค่ะ
    -   หน่วยเวลา
-   ประเภทค่าเอาต์พุต: วันที่
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 00:00:00` จำนวนที่ลดคือ `1` และหน่วยคือ "วัน" ผลลัพธ์ที่ได้คือ `2024-7-14 00:00:00` ครับ/ค่ะ

### คำนวณหาผลต่างกับเวลาอื่น

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   วันที่ที่ต้องการคำนวณหาผลต่าง ซึ่งสามารถเลือกเป็นค่าคงที่ที่เป็นวันที่ หรือเลือกจากตัวแปรในบริบทของ**เวิร์กโฟลว์**ได้ครับ/ค่ะ
    -   หน่วยเวลา
    -   ต้องการค่าสัมบูรณ์หรือไม่
    -   การปัดเศษ: สามารถเลือกได้ว่าจะคงทศนิยมไว้, ปัดเศษขึ้นลงตามปกติ, ปัดขึ้น, หรือปัดลงครับ/ค่ะ
-   ประเภทค่าเอาต์พุต: ตัวเลข
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 00:00:00` วันที่เปรียบเทียบคือ `2024-7-16 06:00:00` หน่วยเป็น "วัน" ไม่ใช้ค่าสัมบูรณ์ และคงทศนิยมไว้ ผลลัพธ์ที่ได้คือ `-1.25` ครับ/ค่ะ

:::info{title=เคล็ดลับ}
หากตั้งค่าค่าสัมบูรณ์และการปัดเศษพร้อมกัน ระบบจะคำนวณค่าสัมบูรณ์ก่อน แล้วจึงปัดเศษครับ/ค่ะ
:::

### ดึงค่าเวลาในหน่วยที่กำหนด

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   หน่วยเวลา
-   ประเภทค่าเอาต์พุต: ตัวเลข
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 00:00:00` และหน่วยคือ "วัน" ผลลัพธ์ที่ได้คือ `15` ครับ/ค่ะ

### กำหนดวันที่เป็นจุดเริ่มต้นของหน่วยเวลาที่กำหนด

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   หน่วยเวลา
-   ประเภทค่าเอาต์พุต: วันที่
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 14:26:30` และหน่วยคือ "วัน" ผลลัพธ์ที่ได้คือ `2024-7-15 00:00:00` ครับ/ค่ะ

### กำหนดวันที่เป็นจุดสิ้นสุดของหน่วยเวลาที่กำหนด

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   หน่วยเวลา
-   ประเภทค่าเอาต์พุต: วันที่
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 14:26:30` และหน่วยคือ "วัน" ผลลัพธ์ที่ได้คือ `2024-7-15 23:59:59` ครับ/ค่ะ

### ตรวจสอบปีอธิกสุรทิน

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   ไม่มีพารามิเตอร์
-   ประเภทค่าเอาต์พุต: บูลีน (Boolean)
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 14:26:30` ผลลัพธ์ที่ได้คือ `true` ครับ/ค่ะ

### จัดรูปแบบเป็นสตริง

-   ประเภทค่าอินพุตที่รับ: วันที่
-   พารามิเตอร์
    -   รูปแบบ (Format) ดูเพิ่มเติมได้ที่ [Day.js: Format](https://day.js.org/docs/en/display/format) ครับ/ค่ะ
-   ประเภทค่าเอาต์พุต: สตริง (String)
-   ตัวอย่าง: หากค่าอินพุตคือ `2024-7-15 14:26:30` และรูปแบบ (Format) คือ `the time is YYYY/MM/DD HH:mm:ss` ผลลัพธ์ที่ได้คือ `the time is 2024/07/15 14:26:30` ครับ/ค่ะ

### แปลงหน่วย

-   ประเภทค่าอินพุตที่รับ: ตัวเลข
-   พารามิเตอร์
    -   หน่วยเวลาเดิมก่อนการแปลง
    -   หน่วยเวลาที่ต้องการแปลง
    -   การปัดเศษ: สามารถเลือกได้ว่าจะคงทศนิยมไว้, ปัดเศษขึ้นลงตามปกติ, ปัดขึ้น, หรือปัดลงครับ/ค่ะ
-   ประเภทค่าเอาต์พุต: ตัวเลข
-   ตัวอย่าง: หากค่าอินพุตคือ `2` หน่วยเดิมคือ "สัปดาห์" หน่วยที่แปลงคือ "วัน" และไม่คงทศนิยมไว้ ผลลัพธ์ที่ได้คือ `14` ครับ/ค่ะ

## ตัวอย่างการใช้งาน

![โหนดการคำนวณวันที่_ตัวอย่าง](https://static-docs.nocobase.com/20240817184137.png)

สมมติว่ามีกิจกรรมโปรโมชัน และเราต้องการเพิ่มเวลาสิ้นสุดโปรโมชันลงในฟิลด์ของสินค้าทุกครั้งที่มีการสร้างสินค้าขึ้นมาครับ/ค่ะ โดยเวลาสิ้นสุดนี้คือ 23:59:59 น. ของวันสุดท้ายในสัปดาห์ถัดไปนับจากเวลาที่สร้างสินค้า เราจึงสามารถสร้างฟังก์ชันเวลาสองฟังก์ชันและให้ทำงานแบบไปป์ไลน์ (pipeline) ดังนี้:

-   คำนวณเวลาสำหรับสัปดาห์ถัดไป
-   รีเซ็ตผลลัพธ์ให้เป็น 23:59:59 น. ของวันสุดท้ายในสัปดาห์นั้น

ด้วยวิธีนี้ เราก็จะได้ค่าเวลาที่ต้องการ และส่งต่อไปยังโหนดถัดไป เช่น โหนดแก้ไข**คอลเลกชัน** เพื่อเพิ่มเวลาสิ้นสุดโปรโมชันลงใน**คอลเลกชัน**ครับ/ค่ะ