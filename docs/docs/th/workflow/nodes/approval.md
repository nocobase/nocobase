---
pkg: '@nocobase/plugin-workflow-approval'
---
:::tip
เอกสารนี้แปลโดย AI หากมีข้อมูลที่ไม่ถูกต้อง โปรดดู[เวอร์ชันภาษาอังกฤษ](/en)
:::

# การอนุมัติ

## บทนำ

ใน เวิร์กโฟลว์ การอนุมัติ เราจำเป็นต้องใช้โหนด "การอนุมัติ" โดยเฉพาะ เพื่อกำหนดตรรกะการทำงานให้ผู้ อนุมัติ สามารถดำเนินการ (อนุมัติ, ปฏิเสธ หรือส่งคืน) คำขออนุมัติที่ถูกสร้างขึ้นได้ครับ/ค่ะ โหนด "การอนุมัติ" นี้สามารถใช้ได้เฉพาะในกระบวนการอนุมัติเท่านั้นครับ/ค่ะ

:::info{title=เคล็ดลับ}
ความแตกต่างจากโหนด "การดำเนินการด้วยตนเอง" ทั่วไป: โหนด "การดำเนินการด้วยตนเอง" ทั่วไปถูกออกแบบมาสำหรับสถานการณ์ที่กว้างขึ้น สามารถใช้ในเวิร์กโฟลว์หลายประเภท เช่น การป้อนข้อมูลด้วยตนเอง หรือการตัดสินใจด้วยตนเองว่าจะดำเนินการต่อในกระบวนการหรือไม่ครับ/ค่ะ ส่วน "โหนดการอนุมัติ" เป็นโหนดประมวลผลที่ออกแบบมาโดยเฉพาะสำหรับกระบวนการอนุมัติเท่านั้น โดยจะจัดการเฉพาะข้อมูลของคำขออนุมัติที่ถูกสร้างขึ้น และไม่สามารถนำไปใช้ในเวิร์กโฟลว์อื่น ๆ ได้ครับ/ค่ะ
:::

## การสร้างโหนด

คลิกปุ่มเครื่องหมายบวก ("+") ใน เวิร์กโฟลว์ เพื่อเพิ่มโหนด "การอนุมัติ" จากนั้นเลือกโหมดการอนุมัติแบบใดแบบหนึ่งเพื่อสร้างโหนดการอนุมัติครับ/ค่ะ

![การสร้างโหนดการอนุมัติ](https://static-docs.nocobase.com/20251107000938.png)

## การตั้งค่าโหนด

### โหมดการอนุมัติ

โหมดการอนุมัติมีสองแบบครับ/ค่ะ:

1.  **โหมดทางตรง (Pass-through mode)**: มักใช้สำหรับกระบวนการที่ไม่ซับซ้อน การอนุมัติหรือไม่ของโหนดนี้จะตัดสินใจว่ากระบวนการจะสิ้นสุดลงหรือไม่ หากไม่ได้รับการอนุมัติ กระบวนการจะสิ้นสุดลงทันทีครับ/ค่ะ

    ![โหมดการอนุมัติแบบทางตรง](https://static-docs.nocobase.com/20251107001043.png)

2.  **โหมดแยกสาขา (Branch mode)**: มักใช้สำหรับตรรกะข้อมูลที่ซับซ้อนมากขึ้น หลังจากโหนดการอนุมัติสร้างผลลัพธ์ใด ๆ แล้ว โหนดอื่น ๆ สามารถดำเนินการต่อได้ภายในสาขาผลลัพธ์นั้นครับ/ค่ะ

    ![โหมดการอนุมัติแบบแยกสาขา](https://static-docs.nocobase.com/20251107001234.png)

    หลังจากโหนดนี้ถูก "อนุมัติ" นอกจากจะดำเนินการในสาขาอนุมัติแล้ว กระบวนการที่ตามมาก็จะดำเนินต่อไปด้วยครับ/ค่ะ หลังจากการดำเนินการ "ปฏิเสธ" โดยค่าเริ่มต้น กระบวนการที่ตามมาก็สามารถดำเนินต่อไปได้เช่นกัน หรือคุณสามารถตั้งค่าโหนดให้สิ้นสุดกระบวนการหลังจากดำเนินการในสาขาแล้วก็ได้ครับ/ค่ะ

:::info{title=เคล็ดลับ}
โหมดการอนุมัติไม่สามารถแก้ไขได้หลังจากสร้างโหนดแล้วครับ/ค่ะ
:::

### ผู้ อนุมัติ

ผู้ อนุมัติ คือกลุ่มผู้ใช้ที่รับผิดชอบการดำเนินการอนุมัติของโหนดนี้ครับ/ค่ะ ซึ่งอาจเป็นผู้ใช้คนเดียวหรือหลายคนก็ได้ โดยแหล่งที่มาของการเลือกสามารถเป็นค่าคงที่ที่เลือกจากรายการผู้ใช้ หรือเป็นค่าไดนามิกที่ระบุโดยตัวแปรก็ได้ครับ/ค่ะ

![การตั้งค่าผู้ อนุมัติ](https://static-docs.nocobase.com/20251107001433.png)

เมื่อเลือกตัวแปร คุณสามารถเลือกได้เฉพาะคีย์หลัก (Primary Key) หรือคีย์นอก (Foreign Key) ของข้อมูลผู้ใช้จากบริบทและผลลัพธ์ของโหนดเท่านั้นครับ/ค่ะ หากตัวแปรที่เลือกเป็นอาร์เรย์ (ความสัมพันธ์แบบหนึ่งต่อหลาย) ในระหว่างการดำเนินการ ผู้ใช้แต่ละคนในอาร์เรย์จะถูกรวมเข้ากับชุดผู้ อนุมัติ ทั้งหมดครับ/ค่ะ

นอกจากการเลือกผู้ใช้หรือตัวแปรโดยตรงแล้ว คุณยังสามารถกรองผู้ใช้ที่ตรงตามเงื่อนไขเพื่อเป็นผู้ อนุมัติ ได้แบบไดนามิก โดยอิงตามเงื่อนไขการค้นหาของ ตารางผู้ใช้ ครับ/ค่ะ

![การกรองผู้ใช้เพื่อเป็นผู้ อนุมัติ](https://static-docs.nocobase.com/20251107001703.png)

### โหมดการตกลงร่วมกัน

หากมีผู้ อนุมัติ เพียงคนเดียวในการดำเนินการขั้นสุดท้าย (รวมถึงกรณีที่ตัวแปรหลายตัวถูกตัดซ้ำออกไปแล้ว) ไม่ว่าจะเลือกโหมดการตกลงร่วมกันแบบใด ผู้ใช้คนนั้นก็จะดำเนินการอนุมัติเพียงคนเดียว และผลลัพธ์ก็จะถูกตัดสินโดยผู้ใช้คนนั้นเท่านั้นครับ/ค่ะ

เมื่อมีผู้ใช้หลายคนอยู่ในชุดผู้ อนุมัติ การเลือกโหมดการตกลงร่วมกันที่แตกต่างกันจะแสดงถึงวิธีการประมวลผลที่ต่างกันครับ/ค่ะ:

1.  **อนุมัติแบบใดก็ได้ (Anyone)**: เพียงแค่มีคนใดคนหนึ่งอนุมัติ โหนดก็จะถือว่าผ่านครับ/ค่ะ โหนดจะถูกปฏิเสธก็ต่อเมื่อทุกคนปฏิเสธเท่านั้น
2.  **อนุมัติแบบร่วมกัน (Countersign)**: ทุกคนต้องอนุมัติ โหนดจึงจะถือว่าผ่านครับ/ค่ะ หากมีคนใดคนหนึ่งปฏิเสธ โหนดก็จะถูกปฏิเสธทันที
3.  **โหมดโหวต (Vote)**: จำนวนผู้อนุมัติที่ผ่านต้องเกินสัดส่วนที่กำหนด โหนดจึงจะถือว่าผ่านครับ/ค่ะ มิฉะนั้น โหนดจะถูกปฏิเสธ

สำหรับการดำเนินการส่งคืน ในทุกโหมด หากมีผู้ใช้คนใดในชุดผู้ อนุมัติ เลือกดำเนินการเป็น "ส่งคืน" โหนดจะออกจากกระบวนการทันทีครับ/ค่ะ

### ลำดับการดำเนินการ

เช่นเดียวกันครับ/ค่ะ เมื่อมีผู้ใช้หลายคนอยู่ในชุดผู้ อนุมัติ การเลือกลำดับการดำเนินการที่แตกต่างกันจะแสดงถึงวิธีการประมวลผลที่ต่างกัน:

1.  **แบบขนาน (Parallel)**: ผู้ อนุมัติ ทุกคนสามารถดำเนินการได้ตามลำดับใดก็ได้ครับ/ค่ะ ลำดับก่อนหลังไม่มีผล
2.  **แบบตามลำดับ (Sequential)**: ผู้ อนุมัติ จะดำเนินการตามลำดับที่อยู่ในชุดผู้ อนุมัติ ครับ/ค่ะ ผู้ อนุมัติ คนถัดไปจะสามารถดำเนินการได้หลังจากที่คนก่อนหน้าส่งงานแล้วเท่านั้น

ไม่ว่าจะตั้งค่าเป็นการดำเนินการแบบ "ตามลำดับ" หรือไม่ก็ตาม ผลลัพธ์ที่ได้จากการดำเนินการตามลำดับจริงก็จะยังคงเป็นไปตามกฎใน "โหมดการตกลงร่วมกัน" ที่กล่าวมาข้างต้นครับ/ค่ะ โหนดจะดำเนินการเสร็จสิ้นเมื่อตรงตามเงื่อนไขที่กำหนด

### ออกจาก เวิร์กโฟลว์ หลังจากสาขาปฏิเสธสิ้นสุดลง

เมื่อ "โหมดการอนุมัติ" ถูกตั้งค่าเป็น "โหมดแยกสาขา" คุณสามารถเลือกที่จะออกจาก เวิร์กโฟลว์ หลังจากสาขาปฏิเสธสิ้นสุดลงได้ครับ/ค่ะ เมื่อเลือกตัวเลือกนี้ เครื่องหมาย "✗" จะปรากฏขึ้นที่ท้ายสาขาปฏิเสธ ซึ่งหมายความว่าโหนดถัดไปจะไม่ดำเนินการต่อหลังจากสาขานี้สิ้นสุดลงครับ/ค่ะ

![ออกจาก เวิร์กโฟลว์ หลังจากปฏิเสธ](https://static-docs.nocobase.com/20251107001839.png)

### การตั้งค่าหน้าจอผู้ อนุมัติ

การตั้งค่าหน้าจอผู้ อนุมัติ ใช้สำหรับจัดเตรียมหน้าจอการทำงานให้ผู้ อนุมัติ เมื่อ เวิร์กโฟลว์ การอนุมัติมาถึงโหนดนี้ครับ/ค่ะ คลิกปุ่มตั้งค่าเพื่อเปิดหน้าต่างป๊อปอัป:

![หน้าต่างป๊อปอัปการตั้งค่าหน้าจอผู้ อนุมัติ](https://static-docs.nocobase.com/20251107001958.png)

ในหน้าต่างป๊อปอัปการตั้งค่า คุณสามารถเพิ่มบล็อกต่าง ๆ ได้ เช่น เนื้อหาที่ส่งมาแต่แรก, ข้อมูลการอนุมัติ, แบบฟอร์มการดำเนินการ และข้อความแจ้งเตือนที่กำหนดเองครับ/ค่ะ

![การเพิ่มบล็อกในหน้าจอผู้ อนุมัติ](https://static-docs.nocobase.com/20251107002604.png)

#### เนื้อหาที่ส่งมาแต่แรก

บล็อกรายละเอียดเนื้อหาการอนุมัติคือบล็อกข้อมูลที่ผู้ริเริ่มส่งมาครับ/ค่ะ ซึ่งคล้ายกับบล็อกข้อมูลทั่วไป คุณสามารถเพิ่มคอมโพเนนต์ฟิลด์จาก ตารางข้อมูล ได้ตามต้องการ และจัดเรียงได้อย่างอิสระ เพื่อจัดระเบียบเนื้อหาที่ผู้ อนุมัติ ต้องการตรวจสอบครับ/ค่ะ

![การตั้งค่าบล็อกรายละเอียด](https://static-docs.nocobase.com/20251107002925.png)

#### แบบฟอร์มการดำเนินการ

ในบล็อกแบบฟอร์มการดำเนินการ คุณสามารถเพิ่มปุ่มการทำงานที่โหนดนี้รองรับได้ครับ/ค่ะ ซึ่งรวมถึง "อนุมัติ", "ปฏิเสธ", "ส่งคืน", "โอนสิทธิ์" และ "เพิ่มผู้ลงนาม"

![บล็อกแบบฟอร์มการดำเนินการ](https://static-docs.nocobase.com/20251107003015.png)

นอกจากนี้ ในแบบฟอร์มการดำเนินการยังสามารถเพิ่มฟิลด์ที่ผู้ อนุมัติ สามารถแก้ไขได้ครับ/ค่ะ ฟิลด์เหล่านี้จะแสดงในแบบฟอร์มการดำเนินการเมื่อผู้ อนุมัติ กำลังประมวลผลคำขออนุมัติ ผู้ อนุมัติ สามารถแก้ไขค่าของฟิลด์เหล่านี้ได้ และเมื่อส่งข้อมูลแล้ว ทั้งข้อมูลที่ใช้ในการอนุมัติและสแนปช็อตของข้อมูลที่เกี่ยวข้องในกระบวนการอนุมัติก็จะได้รับการอัปเดตพร้อมกันครับ/ค่ะ

![การแก้ไขฟิลด์เนื้อหาการอนุมัติ](https://static-docs.nocobase.com/20251107003206.png)

#### "อนุมัติ" และ "ปฏิเสธ"

ในบรรดาปุ่มการทำงานของการอนุมัติ "อนุมัติ" และ "ปฏิเสธ" เป็นการดำเนินการที่เด็ดขาดครับ/ค่ะ หลังจากส่งแล้ว การดำเนินการของผู้ อนุมัติ สำหรับโหนดนี้จะเสร็จสมบูรณ์ ฟิลด์เพิ่มเติมที่ต้องกรอกเมื่อส่งข้อมูล เช่น "ความคิดเห็น" สามารถเพิ่มได้ในหน้าต่างป๊อปอัป "การตั้งค่าการดำเนินการ" ของปุ่มการทำงานครับ/ค่ะ

![การตั้งค่าการดำเนินการ](https://static-docs.nocobase.com/20251107003314.png)

#### "ส่งคืน"

"ส่งคืน" ก็เป็นการดำเนินการที่เด็ดขาดเช่นกันครับ/ค่ะ นอกจากการตั้งค่าความคิดเห็นแล้ว คุณยังสามารถตั้งค่าโหนดที่สามารถส่งคืนได้อีกด้วย:

![การตั้งค่าโหนดที่สามารถส่งคืนได้](https://static-docs.nocobase.com/20251107003555.png)

#### "โอนสิทธิ์" และ "เพิ่มผู้ลงนาม"

"โอนสิทธิ์" และ "เพิ่มผู้ลงนาม" เป็นการดำเนินการที่ไม่เด็ดขาดครับ/ค่ะ ใช้สำหรับปรับเปลี่ยนผู้ อนุมัติ ในกระบวนการอนุมัติแบบไดนามิก "โอนสิทธิ์" คือการมอบหมายงานอนุมัติของผู้ใช้ปัจจุบันให้ผู้ใช้อื่นดำเนินการแทน ส่วน "เพิ่มผู้ลงนาม" คือการเพิ่มผู้ อนุมัติ ก่อนหรือหลังผู้ อนุมัติ ปัจจุบัน เพื่อให้ผู้ อนุมัติ ที่เพิ่มเข้ามาใหม่ดำเนินการอนุมัติร่วมกันครับ/ค่ะ

หลังจากเปิดใช้งานปุ่มการทำงาน "โอนสิทธิ์" หรือ "เพิ่มผู้ลงนาม" แล้ว คุณจะต้องเลือก "ขอบเขตการมอบหมายบุคคล" ในเมนูการตั้งค่าของปุ่ม เพื่อกำหนดขอบเขตของผู้ใช้ที่สามารถมอบหมายให้เป็นผู้ อนุมัติ ใหม่ได้ครับ/ค่ะ

![ขอบเขตการมอบหมายบุคคล](https://static-docs.nocobase.com/20241226232321.png)

เช่นเดียวกับการตั้งค่าผู้ อนุมัติ เริ่มต้นของโหนด ขอบเขตการมอบหมายบุคคลสามารถเป็นผู้ อนุมัติ ที่เลือกโดยตรง หรืออิงตามเงื่อนไขการค้นหาของ คอลเลกชัน ผู้ใช้ครับ/ค่ะ ซึ่งสุดท้ายจะถูกรวมเข้าเป็นชุดเดียวกัน และจะไม่รวมผู้ใช้ที่อยู่ในชุดผู้ อนุมัติ อยู่แล้ว

:::warning{title=สำคัญ}
หากคุณเปิดหรือปิดปุ่มการทำงานใด ๆ หรือแก้ไขขอบเขตการมอบหมายบุคคล คุณจะต้องบันทึกการตั้งค่าของโหนดนี้หลังจากปิดหน้าต่างป๊อปอัปการตั้งค่าหน้าจอการทำงานครับ/ค่ะ มิฉะนั้น การเปลี่ยนแปลงของปุ่มการทำงานนั้นจะไม่ส่งผล
:::

## ผลลัพธ์ของโหนด

หลังจากกระบวนการอนุมัติเสร็จสมบูรณ์ สถานะและข้อมูลที่เกี่ยวข้องจะถูกบันทึกไว้ในผลลัพธ์ของโหนด ซึ่งสามารถนำไปใช้เป็นตัวแปรโดยโหนดถัดไปได้ครับ/ค่ะ

![ผลลัพธ์ของโหนด](https://static-docs.nocobase.com/20250614095052.png)

### สถานะการอนุมัติของโหนด

แสดงถึงสถานะการประมวลผลของโหนดการอนุมัติปัจจุบันครับ/ค่ะ ผลลัพธ์จะเป็นค่าแบบ Enumerated Value (ค่าที่กำหนดไว้ล่วงหน้า)

### ข้อมูลหลังการอนุมัติ

หากผู้ อนุมัติ แก้ไขเนื้อหาการอนุมัติในแบบฟอร์มการดำเนินการ ข้อมูลที่แก้ไขจะถูกบันทึกไว้ในผลลัพธ์ของโหนด เพื่อให้โหนดถัดไปนำไปใช้ครับ/ค่ะ หากต้องการใช้ฟิลด์ความสัมพันธ์ คุณจะต้องตั้งค่าการโหลดล่วงหน้า (Preloading) สำหรับฟิลด์ความสัมพันธ์ในทริกเกอร์ครับ/ค่ะ

### บันทึกการอนุมัติ

> v1.8.0+

บันทึกการดำเนินการอนุมัติเป็นอาร์เรย์ (Array) ที่ประกอบด้วยบันทึกการดำเนินการของผู้ อนุมัติ ทุกคนในโหนดนี้ครับ/ค่ะ บันทึกการดำเนินการแต่ละรายการประกอบด้วยฟิลด์ดังต่อไปนี้:

| ฟิลด์ | ประเภท | คำอธิบาย |
| --- | --- | --- |
| id | number | ตัวระบุเฉพาะสำหรับบันทึกการดำเนินการ |
| userId | number | ID ผู้ใช้ที่ดำเนินการบันทึกนี้ |
| status | number | สถานะการดำเนินการ |
| comment | string | ความคิดเห็น ณ เวลาที่ดำเนินการ |
| updatedAt | string | เวลาที่อัปเดตบันทึกการดำเนินการ |

คุณสามารถใช้ฟิลด์เหล่านี้เป็นตัวแปรในโหนดถัดไปได้ตามความต้องการครับ/ค่ะ