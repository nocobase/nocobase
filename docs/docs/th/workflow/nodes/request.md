---
pkg: '@nocobase/plugin-workflow-request'
---
:::tip
เอกสารนี้แปลโดย AI หากมีข้อมูลที่ไม่ถูกต้อง โปรดดู[เวอร์ชันภาษาอังกฤษ](/en)
:::

# คำขอ HTTP

## บทนำ

เมื่อคุณต้องการทำงานร่วมกับระบบเว็บอื่น ๆ คุณสามารถใช้โหนด HTTP Request ได้ครับ/ค่ะ โหนดนี้จะส่งคำขอ HTTP ไปยังที่อยู่ปลายทางที่กำหนดไว้ตามการตั้งค่า โดยสามารถส่งข้อมูลในรูปแบบ JSON หรือ `application/x-www-form-urlencoded` เพื่อสื่อสารและแลกเปลี่ยนข้อมูลกับระบบภายนอกได้

หากคุณคุ้นเคยกับเครื่องมือส่งคำขอต่าง ๆ เช่น Postman คุณก็จะสามารถทำความเข้าใจและใช้งานโหนด HTTP Request ได้อย่างรวดเร็วครับ/ค่ะ แต่สิ่งที่แตกต่างจากเครื่องมือเหล่านั้นคือ พารามิเตอร์ต่าง ๆ ในโหนด HTTP Request สามารถใช้ตัวแปรบริบท (context variables) จากเวิร์กโฟลว์ปัจจุบันได้ ซึ่งช่วยให้สามารถผสานรวมกับการประมวลผลทางธุรกิจของระบบได้อย่างราบรื่นและมีประสิทธิภาพ

## การติดตั้ง

เป็นปลั๊กอินในตัว ไม่จำเป็นต้องติดตั้งเพิ่มเติมครับ/ค่ะ

## การสร้างโหนด

ในหน้าจอการตั้งค่าเวิร์กโฟลว์ ให้คลิกปุ่มเครื่องหมายบวก (“+”) ในโฟลว์เพื่อเพิ่มโหนด “HTTP Request” ครับ/ค่ะ

![HTTP Request_Add](https://static-docs.nocobase.com/46f2a6fc3f6869c80f8fbd362a54e644.png)

## การตั้งค่าโหนด

![HTTP Request Node_Configuration](https://static-docs.nocobase.com/2fcb29af66b892fa704add52e2974a52.png)

### เมธอดคำขอ

เมธอด (Method) ของคำขอ HTTP ที่เลือกได้: `GET`, `POST`, `PUT`, `PATCH` และ `DELETE`

### URL คำขอ

URL ของบริการ HTTP ซึ่งต้องระบุส่วนของโปรโตคอลด้วย (`http://` หรือ `https://`) แนะนำให้ใช้ `https://` ครับ/ค่ะ

### รูปแบบข้อมูลคำขอ

คือ `Content-Type` ในส่วนหัว (Header) ของคำขอ สำหรับรูปแบบที่รองรับ โปรดดูที่ส่วน "[ส่วนเนื้อหาคำขอ](#request-body)" ครับ/ค่ะ

### การตั้งค่าส่วนหัวคำขอ

คู่คีย์-ค่า (Key-value pairs) สำหรับส่วน Header ของคำขอ ค่าต่าง ๆ สามารถใช้ตัวแปรจากบริบทของเวิร์กโฟลว์ได้ครับ/ค่ะ

:::info{title=เคล็ดลับ}
สำหรับ `Content-Type` ในส่วนหัวคำขอ ได้ถูกกำหนดค่าผ่านการตั้งค่ารูปแบบข้อมูลคำขอแล้ว ไม่จำเป็นต้องกรอกในส่วนนี้ และการกำหนดค่าทับซ้อนจะไม่มีผลครับ/ค่ะ
:::

### พารามิเตอร์คำขอ

คู่คีย์-ค่าสำหรับส่วน Query ของคำขอ ค่าต่าง ๆ สามารถใช้ตัวแปรจากบริบทของเวิร์กโฟลว์ได้ครับ/ค่ะ

### ส่วนเนื้อหาคำขอ

ส่วน Body ของคำขอ รองรับรูปแบบที่แตกต่างกันไป ขึ้นอยู่กับ `Content-Type` ที่เลือกครับ/ค่ะ

#### `application/json`

รองรับข้อความในรูปแบบ JSON มาตรฐาน คุณสามารถแทรกตัวแปรจากบริบทของเวิร์กโฟลว์ได้โดยใช้ปุ่มตัวแปรที่มุมขวาบนของช่องแก้ไขข้อความครับ/ค่ะ

:::info{title=เคล็ดลับ}
ตัวแปรจะต้องถูกใช้ภายในสตริง JSON เช่น: `{ "a": "{{$context.data.a}}" }`
:::

#### `application/x-www-form-urlencoded`

รูปแบบคู่คีย์-ค่า ค่าต่าง ๆ สามารถใช้ตัวแปรจากบริบทของเวิร์กโฟลว์ได้ เมื่อมีตัวแปรอยู่ ตัวแปรเหล่านั้นจะถูกแยกวิเคราะห์เป็นเทมเพลตสตริงและนำมาต่อกันเป็นค่าสตริงสุดท้ายครับ/ค่ะ

#### `application/xml`

รองรับข้อความในรูปแบบ XML มาตรฐาน คุณสามารถแทรกตัวแปรจากบริบทของเวิร์กโฟลว์ได้โดยใช้ปุ่มตัวแปรที่มุมขวาบนของช่องแก้ไขข้อความครับ/ค่ะ

#### `multipart/form-data` <Badge>v1.8.0+</Badge>

รองรับคู่คีย์-ค่าสำหรับข้อมูลฟอร์ม สามารถอัปโหลดไฟล์ได้เมื่อประเภทข้อมูลถูกตั้งค่าเป็นออบเจกต์ไฟล์ ไฟล์สามารถเลือกได้ผ่านตัวแปรจากออบเจกต์ไฟล์ที่มีอยู่ในบริบทเท่านั้น เช่น ผลลัพธ์จากการสอบถามคอลเลกชันไฟล์ หรือข้อมูลความสัมพันธ์จากคอลเลกชันไฟล์ที่เกี่ยวข้องครับ/ค่ะ

:::info{title=เคล็ดลับ}
เมื่อเลือกข้อมูลไฟล์ ตรวจสอบให้แน่ใจว่าตัวแปรนั้นสอดคล้องกับออบเจกต์ไฟล์เดี่ยว ไม่ใช่รายการไฟล์ (ในการสอบถามความสัมพันธ์แบบหนึ่งต่อหลาย หรือ หลายต่อหลาย ค่าของฟิลด์ความสัมพันธ์จะเป็นอาร์เรย์)
:::

### การตั้งค่าการหมดเวลา

เมื่อคำขอไม่ตอบสนองเป็นเวลานาน สามารถใช้การตั้งค่าการหมดเวลา (timeout) เพื่อยกเลิกการทำงานของคำขอนั้นได้ครับ/ค่ะ หากคำขอหมดเวลา เวิร์กโฟลว์ปัจจุบันจะถูกยกเลิกก่อนกำหนดพร้อมสถานะล้มเหลว

### ละเว้นความล้มเหลว

โหนดคำขอจะถือว่ารหัสสถานะ HTTP มาตรฐานระหว่าง `200` ถึง `299` (รวม) เป็นสถานะสำเร็จ และรหัสอื่น ๆ ทั้งหมดเป็นสถานะล้มเหลวครับ/ค่ะ หากเลือกตัวเลือก “ละเว้นคำขอที่ล้มเหลวและดำเนินการเวิร์กโฟลว์ต่อ” โหนดถัดไปในเวิร์กโฟลว์จะยังคงทำงานต่อไปแม้ว่าคำขอจะล้มเหลวก็ตาม

## การใช้ผลลัพธ์การตอบกลับ

ผลลัพธ์การตอบกลับของคำขอ HTTP สามารถถูกแยกวิเคราะห์โดยโหนด [JSON Query](./json-query.md) เพื่อนำไปใช้ในโหนดถัดไปได้ครับ/ค่ะ

ตั้งแต่เวอร์ชัน `v1.0.0-alpha.16` เป็นต้นไป ผลลัพธ์การตอบกลับของโหนดคำขอสามส่วนสามารถใช้เป็นตัวแปรแยกกันได้:

*   รหัสสถานะการตอบกลับ
*   ส่วนหัวการตอบกลับ
*   ข้อมูลการตอบกลับ

![HTTP Request Node_Using Response Result](https://static-docs.nocobase.com/20240529110610.png)

โดยรหัสสถานะการตอบกลับมักจะเป็นรหัสสถานะ HTTP มาตรฐานในรูปแบบตัวเลข เช่น `200`, `403` เป็นต้น (ซึ่งกำหนดโดยผู้ให้บริการ)

ส่วนหัวการตอบกลับ (Response headers) อยู่ในรูปแบบ JSON รวมถึงข้อมูลการตอบกลับในรูปแบบ JSON ยังคงต้องถูกแยกวิเคราะห์โดยโหนด JSON ก่อนจึงจะสามารถนำไปใช้งานได้ครับ/ค่ะ

## ตัวอย่าง

ตัวอย่างเช่น เราสามารถใช้โหนดคำขอเพื่อเชื่อมต่อกับแพลตฟอร์มคลาวด์เพื่อส่ง SMS แจ้งเตือนได้ครับ/ค่ะ การตั้งค่าสำหรับ API ส่ง SMS บนคลาวด์อาจมีลักษณะดังนี้ (คุณจะต้องศึกษาเอกสารประกอบของ API นั้น ๆ เพื่อปรับพารามิเตอร์ให้เหมาะสม)

![HTTP Request Node_Configuration](https://static-docs.nocobase.com/20240515124004.png)

เมื่อเวิร์กโฟลว์เรียกใช้งานโหนดนี้ ระบบจะเรียกใช้ API ส่ง SMS ด้วยเนื้อหาที่กำหนดค่าไว้ หากคำขอสำเร็จ จะมีการส่ง SMS ผ่านบริการ SMS บนคลาวด์ครับ/ค่ะ