---
pkg: '@nocobase/plugin-workflow-sql'
---
:::tip
เอกสารนี้แปลโดย AI หากมีข้อมูลที่ไม่ถูกต้อง โปรดดู[เวอร์ชันภาษาอังกฤษ](/en)
:::

# แอคชัน SQL

## บทนำ

ในบางสถานการณ์พิเศษ โหนดการทำงานของคอลเลกชันแบบง่ายๆ ที่กล่าวมาข้างต้นอาจไม่สามารถจัดการกับการดำเนินการที่ซับซ้อนได้ ในกรณีเช่นนี้ คุณสามารถใช้โหนด SQL ได้โดยตรง เพื่อให้ฐานข้อมูลดำเนินการคำสั่ง SQL ที่ซับซ้อนสำหรับการจัดการข้อมูลครับ/ค่ะ

ความแตกต่างจากการเชื่อมต่อฐานข้อมูลโดยตรงจากภายนอกแอปพลิเคชันเพื่อดำเนินการ SQL คือ ภายในเวิร์กโฟลว์ คุณสามารถใช้ตัวแปรจากบริบทของกระบวนการ (process context) เป็นพารามิเตอร์บางส่วนในคำสั่ง SQL ได้ครับ/ค่ะ

## การติดตั้ง

ปลั๊กอินนี้เป็นแบบ Built-in ครับ/ค่ะ ไม่ต้องติดตั้งเพิ่มเติม

## การสร้างโหนด

ในหน้าจอการตั้งค่าเวิร์กโฟลว์ ให้คลิกปุ่มเครื่องหมายบวก (“+”) ในโฟลว์ เพื่อเพิ่มโหนด “แอคชัน SQL” ครับ/ค่ะ:

![เพิ่มแอคชัน SQL](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

## การตั้งค่าโหนด

![โหนด SQL_การตั้งค่าโหนด](https://static-docs.nocobase.com/20240904002334.png)

### แหล่งข้อมูล

เลือกแหล่งข้อมูลที่จะใช้รันคำสั่ง SQL ครับ/ค่ะ

แหล่งข้อมูลที่เลือกต้องเป็นประเภทฐานข้อมูล เช่น แหล่งข้อมูลหลัก (main data source), PostgreSQL หรือแหล่งข้อมูลอื่นๆ ที่เข้ากันได้กับ Sequelize ครับ/ค่ะ

### เนื้อหา SQL

แก้ไขคำสั่ง SQL ครับ/ค่ะ ปัจจุบันรองรับเพียงหนึ่งคำสั่ง SQL เท่านั้น

คุณสามารถแทรกตัวแปรที่ต้องการได้โดยใช้ปุ่มตัวแปรที่มุมขวาบนของช่องแก้ไขครับ/ค่ะ ก่อนที่จะรัน ตัวแปรเหล่านี้จะถูกแทนที่ด้วยค่าที่เกี่ยวข้อง จากนั้นข้อความที่ถูกแทนที่แล้วจะถูกใช้เป็นคำสั่ง SQL สุดท้ายและส่งไปยังฐานข้อมูลเพื่อทำการคิวรี

## ผลลัพธ์การทำงานของโหนด

ตั้งแต่ `v1.3.15-beta` เป็นต้นไป ผลลัพธ์ของการทำงานของโหนด SQL จะเป็นอาร์เรย์ของข้อมูลดิบ (pure data) ครับ/ค่ะ ก่อนหน้านั้นจะเป็นโครงสร้างที่ Sequelize ส่งคืนมาโดยตรง ซึ่งรวมถึงข้อมูลเมตาของการคิวรีด้วย (ดูเพิ่มเติมที่: [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query))

ตัวอย่างเช่น การคิวรีต่อไปนี้:

```sql
select count(id) from posts;
```

ผลลัพธ์ก่อน `v1.3.15-beta`:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

ผลลัพธ์หลัง `v1.3.15-beta`:

```json
[
    { "count": 1 }
]
```

## คำถามที่พบบ่อย

### จะใช้ผลลัพธ์ของโหนด SQL ได้อย่างไร?

หากมีการใช้คำสั่ง `SELECT` ผลลัพธ์การคิวรีจะถูกบันทึกไว้ในโหนดในรูปแบบ JSON ของ Sequelize ครับ/ค่ะ ซึ่งสามารถนำไปแยกวิเคราะห์และใช้งานได้ด้วย [ปลั๊กอิน JSON-query](./json-query.md)

### การทำงาน SQL จะทริกเกอร์เหตุการณ์คอลเลกชันหรือไม่?

**ไม่ครับ/ค่ะ** การทำงาน SQL จะส่งคำสั่ง SQL ไปยังฐานข้อมูลโดยตรงเพื่อประมวลผล การดำเนินการที่เกี่ยวข้องกับ `CREATE` / `UPDATE` / `DELETE` ทั้งหมดจะเกิดขึ้นในฐานข้อมูล ในขณะที่เหตุการณ์คอลเลกชัน (collection events) จะเกิดขึ้นที่เลเยอร์แอปพลิเคชันของ Node.js (ซึ่งจัดการโดย ORM) ดังนั้นจึงไม่มีการทริกเกอร์เหตุการณ์คอลเลกชันครับ/ค่ะ