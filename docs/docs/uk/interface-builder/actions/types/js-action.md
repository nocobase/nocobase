:::tip Повідомлення про переклад ШІ
Ця документація була автоматично перекладена штучним інтелектом.
:::


# JS Дія

## Вступ

JS Дія використовується для виконання JavaScript при натисканні кнопки, дозволяючи налаштовувати будь-яку бізнес-логіку. Її можна використовувати в панелях інструментів форм, панелях інструментів таблиць (на рівні колекції), рядках таблиць (на рівні запису) та інших місцях для виконання таких операцій, як валідація, відображення сповіщень, виклики API, відкриття спливаючих вікон/бічних панелей та оновлення даних.

![jsaction-add-20251029](https://static-docs.nocobase.com/jsaction-add-20251029.png)

## API контексту виконання (часто використовувані)

- `ctx.api.request(options)`: Здійснює HTTP-запит;
- `ctx.openView(viewUid, options)`: Відкриває налаштований вигляд (бічну панель/діалогове вікно/сторінку);
- `ctx.message` / `ctx.notification`: Глобальні повідомлення та сповіщення;
- `ctx.t()` / `ctx.i18n.t()`: Інтернаціоналізація;
- `ctx.resource`: Ресурс даних для контексту рівня колекції (наприклад, панель інструментів таблиці), що включає такі методи, як `getSelectedRows()` та `refresh()`;
- `ctx.record`: Поточний запис рядка для контексту рівня запису (наприклад, кнопка рядка таблиці);
- `ctx.form`: Екземпляр форми AntD для контексту рівня форми (наприклад, кнопка панелі інструментів форми);
- `ctx.collection`: Метаінформація поточної колекції;
- Редактор коду підтримує фрагменти `Snippets` та попереднє виконання `Run` (див. нижче).

- `ctx.requireAsync(url)`: Асинхронно завантажує бібліотеку AMD/UMD за URL-адресою;
- `ctx.importAsync(url)`: Динамічно імпортує модуль ESM за URL-адресою;

> Фактично доступні змінні можуть відрізнятися залежно від розташування кнопки. Наведений вище список є оглядом загальних можливостей.

## Редактор та фрагменти

- `Snippets`: Відкриває список вбудованих фрагментів коду, які можна шукати та вставляти в поточну позицію курсору одним кліком.
- `Run`: Безпосередньо виконує поточний код та виводить журнали виконання на панель `Logs` внизу. Підтримує `console.log/info/warn/error` та підсвічування помилок для легкого визначення їх місцезнаходження.

![jsaction-toolbars-20251029](https://static-docs.nocobase.com/jsaction-toolbars-20251029.png)

- Ви можете використовувати AI-співробітників для генерації/модифікації скриптів: [AI-співробітник · Натан: Frontend-інженер](/ai-employees/built-in/ai-coding)

## Поширені випадки використання (спрощені приклади)

### 1) Запит API та сповіщення

```js
const resp = await ctx.api.request({ url: 'users:list', method: 'get', params: { pageSize: 10 } });
ctx.message.success(ctx.t('Request finished'));
console.log(ctx.t('Response data:'), resp?.data);
```

### 2) Кнопка колекції: Валідація вибору та обробка

```js
const rows = ctx.resource?.getSelectedRows?.() || [];
if (!rows.length) {
  ctx.message.warning(ctx.t('Please select records'));
  return;
}
// TODO: Implement business logic...
ctx.message.success(ctx.t('Selected {n} items', { n: rows.length }));
```

### 3) Кнопка запису: Зчитування поточного запису рядка

```js
if (!ctx.record) {
  ctx.message.error(ctx.t('No record'));
} else {
  ctx.message.success(ctx.t('Record ID: {id}', { id: ctx.record.id }))
}
```

### 4) Відкриття вигляду (бічної панелі/діалогового вікна)

```js
const popupUid = ctx.model.uid + '-open'; // Bind to the current button for stability
await ctx.openView(popupUid, { mode: 'drawer', title: ctx.t('Details'), size: 'large' });
```

### 5) Оновлення даних після відправлення

```js
// Загальне оновлення: пріоритет надається ресурсам таблиці/списку, потім ресурсу блоку, що містить форму.
if (ctx.resource?.refresh) await ctx.resource.refresh();
else if (ctx.blockModel?.resource?.refresh) await ctx.blockModel.resource.refresh();
```

## Важливі зауваження

- **Ідемпотентність дій**: Щоб запобігти багаторазовим відправленням через повторні натискання, ви можете додати перемикач стану або вимкнути кнопку в логіці.
- **Обробка помилок**: Додайте блоки try/catch для викликів API та надайте користувачеві відповідні сповіщення.
- **Взаємодія з виглядами**: При відкритті спливаючого вікна/бічної панелі за допомогою `ctx.openView` рекомендується явно передавати параметри і, за необхідності, активно оновлювати батьківський ресурс після успішного відправлення.

## Пов'язані документи

- [Змінні та контекст](/interface-builder/variables)
- [Правила взаємодії](/interface-builder/linkage-rule)
- [Вигляди та спливаючі вікна](/interface-builder/actions/types/view)