---
pkg: '@nocobase/plugin-file-storage-s3-pro'
---
:::tip Повідомлення про переклад ШІ
Ця документація була автоматично перекладена штучним інтелектом.
:::

# Рушій сховища: S3 (Pro)

## Вступ

На основі плагіна для керування файлами, цей плагін додає підтримку типів файлового сховища, сумісних з протоколом S3. Будь-який сервіс об'єктного сховища, що підтримує протокол S3, можна легко інтегрувати, наприклад, Amazon S3, Aliyun OSS, Tencent COS, MinIO, Cloudflare R2 тощо, що ще більше підвищує сумісність та гнучкість сервісів зберігання.

## Особливості

1. Клієнтське завантаження: Процес завантаження файлів не проходить через сервер NocoBase, а безпосередньо підключається до сервісу файлового сховища, забезпечуючи більш ефективне та швидке завантаження.
    
2. Приватний доступ: При доступі до файлів усі URL-адреси є підписаними тимчасовими авторизованими адресами, що гарантує безпеку та актуальність доступу до файлів.


## Сценарії використання

1. **Керування колекціями файлів**: Централізоване керування та зберігання всіх завантажених файлів, підтримка різних типів файлів та методів зберігання для легкої класифікації та пошуку.
    
2. **Зберігання в полях вкладень**: Використовується для зберігання даних вкладень, завантажених у форми або записи, підтримуючи зв'язок з конкретними записами даних.
  

## Налаштування плагіна

1. Увімкніть плагін `plugin-file-storage-s3-pro`.
    
2. Натисніть "Setting-> FileManager", щоб перейти до налаштувань файлового менеджера.

3. Натисніть кнопку "Add new" та оберіть "S3 Pro".

![](https://static-docs.nocobase.com/20250102160704938.png)

4. Після появи спливаючого вікна ви побачите форму з багатьма полями для заповнення. Ви можете звернутися до подальшої документації, щоб отримати відповідну інформацію про параметри для відповідного файлового сервісу та правильно заповнити її у формі.

![](https://static-docs.nocobase.com/20250413190828536.png)


## Налаштування постачальника послуг

### Amazon S3

#### Створення бакета

1. Відкрийте https://ap-southeast-1.console.aws.amazon.com/s3/home, щоб увійти до консолі S3.
    
2. Натисніть кнопку "Create bucket" праворуч.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355969452.png)

2. Введіть назву бакета (Bucket Name). Інші поля можна залишити зі значеннями за замовчуванням. Прокрутіть сторінку донизу та натисніть кнопку "**Create**", щоб завершити створення.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355969622.png)

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355969811.png)

#### Налаштування CORS

1. Перейдіть до списку бакетів, знайдіть і натисніть на щойно створений бакет, щоб перейти на сторінку його деталей.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355969980.png)

2. Перейдіть на вкладку "Permission", потім прокрутіть униз, щоб знайти розділ налаштувань CORS.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355970155.png)

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355970303.png)

3. Введіть наступну конфігурацію (ви можете додатково налаштувати її) та збережіть.
    
```json
[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "POST",
            "PUT"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": [
            "ETag"
        ],
        "MaxAgeSeconds": 3000
    }
]
```

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355970494.png)

#### Отримання AccessKey та SecretAccessKey

1. Натисніть кнопку "Security credentials" у верхньому правому куті сторінки.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355970651.png)

2. Прокрутіть униз до розділу "Access Keys" та натисніть кнопку "Create Access Key".

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355970832.png)

3. Натисніть "Згоден" (це демонстрація з використанням кореневого облікового запису; у виробничому середовищі рекомендується використовувати IAM).

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355970996.png)

4. Збережіть Access key та Secret access key, що відображаються на сторінці.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355971168.png)

#### Отримання та налаштування параметрів

1. AccessKey ID та AccessKey Secret — це значення, які ви отримали на попередньому кроці. Будь ласка, заповніть їх точно.
    
2. Перейдіть на панель властивостей сторінки деталей бакета, де ви можете отримати назву бакета (Bucket name) та інформацію про регіон (Region).

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355971345.png)

#### Публічний доступ (необов'язково)

Це необов'язкова конфігурація. Налаштуйте її, якщо вам потрібно зробити завантажені файли повністю публічними.

1. Перейдіть на панель "Permissions", прокрутіть униз до "Object Ownership", натисніть "edit" та увімкніть ACLs.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355971508.png)

2. Прокрутіть до "Block public access", натисніть "edit" та встановіть дозвіл на керування ACLs.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355971668.png)

3. Увімкніть "Public access" у NocoBase.


#### Налаштування мініатюр (необов'язково)

Ця конфігурація є необов'язковою і використовується для оптимізації розміру або ефектів попереднього перегляду зображень. **Зверніть увагу, що це рішення для розгортання може призвести до додаткових витрат. Щодо конкретних тарифів, будь ласка, зверніться до відповідних умов AWS.**

1. Відвідайте [Dynamic Image Transformation for Amazon CloudFront](https://aws.amazon.com/solutions/implementations/dynamic-image-transformation-for-amazon-cloudfront/?nc1=h_ls).

2. Натисніть кнопку `Launch in the AWS Console` внизу сторінки, щоб розпочати розгортання рішення.
   ![](https://static-docs.nocobase.com/20250221164214117.png)

3. Дотримуйтесь підказок, щоб завершити налаштування. Зверніть особливу увагу на наступні опції:
   1. Під час створення стека вам потрібно вказати назву бакета Amazon S3, який містить вихідні зображення. Будь ласка, введіть назву бакета, який ви створили раніше.
   2. Якщо ви вирішите розгорнути демонстраційний інтерфейс користувача, ви зможете протестувати функції обробки зображень через цей інтерфейс після розгортання. У консолі AWS CloudFormation виберіть свій стек, перейдіть на вкладку "Outputs", знайдіть значення, що відповідає ключу DemoUrl, і натисніть на посилання, щоб відкрити демонстраційний інтерфейс.
   3. Це рішення використовує бібліотеку `sharp` Node.js для ефективної обробки зображень. Ви можете завантажити вихідний код з репозиторію GitHub та налаштувати його за потреби.
   
   ![](https://static-docs.nocobase.com/20250221164315472.png)
   ![](https://static-docs.nocobase.com/20250221164404755.png)

4. Після завершення налаштування дочекайтеся, доки статус розгортання зміниться на `CREATE_COMPLETE`.

5. У налаштуваннях NocoBase є кілька моментів, на які варто звернути увагу:
   1. `Thumbnail rule`: Заповніть параметри, пов'язані з обробкою зображень, наприклад, `?width=100`. Детальніше дивіться в [документації AWS](https://docs.aws.amazon.com/solutions/latest/serverless-image-handler/use-supported-query-param-edits.html).
   2. `Access endpoint`: Заповніть значення Outputs -> ApiEndpoint після розгортання.
   3. `Full access URL style`: Вам потрібно встановити прапорець **Ignore** (оскільки назва бакета вже була заповнена під час налаштування, вона більше не потрібна для доступу).
   
   ![](https://static-docs.nocobase.com/20250414152135514.png)

#### Приклад налаштування

![](https://static-docs.nocobase.com/20250414152344959.png)


### Aliyun OSS

#### Створення бакета

1. Відкрийте консоль OSS https://oss.console.aliyun.com/overview

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355972149.png)

2. Натисніть "Buckets" у лівому меню, потім натисніть кнопку "Create Bucket", щоб розпочати створення бакета.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355972413.png)

3. Заповніть інформацію, пов'язану з бакетом, і нарешті натисніть кнопку "Create".
    
    1. Назва бакета (Bucket Name) має відповідати вашим бізнес-потребам; назва може бути довільною.
        
    2. Оберіть регіон (Region), найближчий до ваших користувачів.
        
    3. Інші налаштування можна залишити за замовчуванням або налаштувати відповідно до ваших вимог.    

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355972730.png)


#### Налаштування CORS

1. Перейдіть на сторінку деталей бакета, створеного на попередньому кроці.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355973018.png)

2. Натисніть "Content Security -> CORS" у центральному меню.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355973319.png)

3. Натисніть кнопку "Create Rule", заповніть відповідний вміст, прокрутіть униз і натисніть "OK". Ви можете звернутися до скріншота нижче або налаштувати більш детальні параметри.

![](https://static-docs.nocobase.com/20250219171042784.png)

#### Отримання AccessKey та SecretAccessKey

1. Натисніть "AccessKey" під вашим зображенням профілю у верхньому правому куті.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355973884.png)

2. Для демонстраційних цілей ми створюємо AccessKey за допомогою основного облікового запису. У виробничому середовищі рекомендується використовувати RAM для його створення. Ви можете звернутися до https://www.alibabacloud.com/help/en/ram/user-guide/create-an-accesskey-pair
    
3. Натисніть кнопку "Create AccessKey". 

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355974171.png)

4. Виконайте перевірку облікового запису.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355974509.png)

5. Збережіть Access key та Secret access key, що відображаються на сторінці.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355974781.png)


#### Отримання та налаштування параметрів

1. AccessKey ID та AccessKey Secret — це значення, отримані на попередньому кроці.
    
2. Перейдіть на сторінку деталей бакета, щоб отримати назву бакета.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355975063.png)

3. Прокрутіть униз, щоб отримати регіон (Region) (суфікс ".aliyuncs.com" не потрібен).

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355975437.png)

4. Отримайте адресу кінцевої точки (endpoint) та додайте префікс https:// при заповненні її в NocoBase.

![](https://static-docs.nocobase.com/file-storage-s3-pro-1735355975715.png)

#### Налаштування мініатюр (необов'язково)

Ця конфігурація є необов'язковою і повинна використовуватися лише тоді, коли вам потрібно оптимізувати розмір або ефекти попереднього перегляду зображень.

1. Заповніть параметри, пов'язані з `Thumbnail rule`. Щодо конкретних налаштувань параметрів, зверніться до [Параметрів обробки зображень](https://www.alibabacloud.com/help/en/object-storage-service/latest/process-images).

2. `Full upload URL style` та `Full access URL style` можуть бути однаковими.

#### Приклад налаштування

![](https://static-docs.nocobase.com/20250414152525600.png)


### MinIO

#### Створення бакета

1. Натисніть меню "Buckets" ліворуч -> натисніть "Create Bucket", щоб перейти на сторінку створення.
2. Введіть назву бакета (Bucket name) та натисніть кнопку збереження.
#### Отримання AccessKey та SecretAccessKey

1. Перейдіть до "Access Keys" -> натисніть кнопку "Create access key", щоб перейти на сторінку створення.

![](https://static-docs.nocobase.com/20250106111922957.png)

2. Натисніть кнопку збереження.

![](https://static-docs.nocobase.com/20250106111850639.png)

1. Збережіть Access Key та Secret Key зі спливаючого вікна для подальшого налаштування.

![](https://static-docs.nocobase.com/20250106112831483.png)

#### Налаштування параметрів

1. Перейдіть на сторінку NocoBase -> File manager.

2. Натисніть кнопку "Add new" та оберіть "S3 Pro".

3. Заповніть форму:
   - **AccessKey ID** та **AccessKey Secret** — це значення, збережені на попередньому кроці.
   - **Region**: Самостійно розгорнутий MinIO не має концепції регіону, тому його можна налаштувати як "auto".
   - **Endpoint**: Введіть доменне ім'я або IP-адресу вашого розгортання.
   - **Full access URL style** має бути встановлено як Path-Style.

#### Приклад налаштування

![](https://static-docs.nocobase.com/20250414152700671.png)


### Tencent COS

Ви можете звернутися до налаштувань файлових сервісів, згаданих вище, оскільки логіка схожа.

#### Приклад налаштування

![](https://static-docs.nocobase.com/20250414153252872.png)


### Cloudflare R2

Ви можете звернутися до налаштувань файлових сервісів, згаданих вище, оскільки логіка схожа.

#### Приклад налаштування

![](https://static-docs.nocobase.com/20250414154500264.png)