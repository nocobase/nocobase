:::tip Повідомлення про переклад ШІ
Ця документація була автоматично перекладена штучним інтелектом.
:::


# Команди

У NocoBase команди використовуються для виконання операцій, пов'язаних із застосунками або плагінами, безпосередньо в командному рядку. Наприклад, це може бути запуск системних завдань, виконання міграцій або операцій синхронізації, ініціалізація конфігурації, або взаємодія з запущеними екземплярами застосунків. Розробники можуть визначати власні команди для плагінів та реєструвати їх через об'єкт `app`, виконуючи їх у CLI у форматі `nocobase <command>`.

## Типи команд

У NocoBase реєстрація команд поділяється на два типи:

| Тип             | Метод реєстрації                      | Чи потрібно вмикати плагін | Типові сценарії                               |
| :-------------- | :------------------------------------ | :------------------------ | :-------------------------------------------- |
| Динамічна команда | `app.command()`                       | ✅ Так                     | Команди, пов'язані з бізнес-логікою плагіна   |
| Статична команда | `Application.registerStaticCommand()` | ❌ Ні                      | Команди для встановлення, ініціалізації, обслуговування |

## Динамічні команди

Використовуйте `app.command()` для визначення команд плагінів. Ці команди можна виконувати лише після ввімкнення плагіна. Файли команд слід розміщувати в каталозі плагіна за шляхом `src/server/commands/*.ts`.

Приклад

```ts
import { Application } from '@nocobase/server';

export default function (app: Application) {
  app
    .command('echo')
    .option('-v, --version')
    .action(async ([options]) => {
      console.log('Hello World!');
      if (options.version) {
        console.log('Current version:', await app.version.get());
      }
    });
}
```

Опис

- `app.command('echo')`: Визначає команду з назвою `echo`.
- `.option('-v, --version')`: Додає опцію до команди.
- `.action()`: Визначає логіку виконання команди.
- `app.version.get()`: Отримує поточну версію застосунку.

Виконання команди

```bash
nocobase echo
nocobase echo -v
```

## Статичні команди

Використовуйте `Application.registerStaticCommand()` для реєстрації. Статичні команди можуть виконуватися без ввімкнення плагінів, що робить їх ідеальними для завдань встановлення, ініціалізації, міграції або налагодження. Реєструйте їх у методі `staticImport()` класу плагіна.

Приклад

```ts
import { Application, Plugin } from '@nocobase/server';

export default class PluginHelloServer extends Plugin {
  static staticImport() {
    Application.registerStaticCommand((app: Application) => {
      app
        .command('echo')
        .option('-v, --version')
        .action(async ([options]) => {
          console.log('Hello World!');
          if (options.version) {
            console.log('Current version:', await app.version.get());
          }
        });
    });
  }
}
```

Виконання команди

```bash
nocobase echo
nocobase echo --version
```

Опис

- `Application.registerStaticCommand()`: Реєструє команди до того, як застосунок буде інстанційовано.
- Статичні команди зазвичай використовуються для виконання глобальних завдань, які не залежать від стану застосунку або плагіна.

## Command API

Об'єкти команд надають три додаткові допоміжні методи для керування контекстом виконання команди:

| Метод     | Призначення                                       | Приклад                               |
| :-------- | :------------------------------------------------ | :------------------------------------ |
| `ipc()`   | Взаємодія з запущеними екземплярами застосунку (через IPC) | `app.command('reload').ipc().action()` |
| `auth()`  | Перевірка коректності конфігурації бази даних     | `app.command('seed').auth().action()` |
| `preload()` | Попереднє завантаження конфігурації застосунку (виконання `app.load()`) | `app.command('sync').preload().action()` |

Опис конфігурації

- **`ipc()`**
  За замовчуванням команди виконуються в новому екземплярі застосунку. Після ввімкнення `ipc()` команди взаємодіють із поточним запущеним екземпляром застосунку через міжпроцесну комунікацію (IPC), що підходить для команд реального часу (наприклад, оновлення кешу, надсилання сповіщень).

- **`auth()`**
  Перевіряє доступність конфігурації бази даних перед виконанням команди. Якщо конфігурація бази даних некоректна або з'єднання не вдалося, команда не буде продовжена. Часто використовується для завдань, що передбачають запис або читання з бази даних.

- **`preload()`**
  Попередньо завантажує конфігурацію застосунку перед виконанням команди, що еквівалентно виконанню `app.load()`. Підходить для команд, які залежать від конфігурації або контексту плагіна.

Більше методів API дивіться в [AppCommand](/api/server/app-command).

## Поширені приклади

Ініціалізація даних за замовчуванням

```ts
app
  .command('init-data')
  .auth()
  .preload()
  .action(async () => {
    const repo = app.db.getRepository('users');
    await repo.create({ values: { username: 'admin' } });
    console.log('Ініціалізовано стандартного користувача admin.');
  });
```

Перезавантаження кешу для запущеного екземпляра (режим IPC)

```ts
app
  .command('reload-cache')
  .ipc()
  .action(async () => {
    console.log('Запит до запущеного застосунку на перезавантаження кешу...');
  });
```

Статична реєстрація команди встановлення

```ts
Application.registerStaticCommand((app) => {
  app
    .command('setup')
    .action(async () => {
      console.log('Налаштування середовища NocoBase...');
    });
});
```