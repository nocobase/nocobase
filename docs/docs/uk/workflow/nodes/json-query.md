---
pkg: '@nocobase/plugin-workflow-json-query'
---
:::tip Повідомлення про переклад ШІ
Ця документація була автоматично перекладена штучним інтелектом.
:::

# Обчислення JSON

## Вступ

На основі різних механізмів обчислення JSON, цей вузол обчислює або трансформує складні JSON-дані, згенеровані попередніми вузлами, для їх подальшого використання. Наприклад, результати операцій SQL та вузлів HTTP-запитів можна перетворити за допомогою цього вузла у потрібні значення та формати змінних для використання наступними вузлами.

## Створення вузла

В інтерфейсі конфігурації робочого процесу натисніть кнопку плюса («+») у процесі, щоб додати вузол «Обчислення JSON»:

![Створення вузла](https://static-docs.nocobase.com/7de76517539ad9dfc88b7160f1d0dd7.png)

:::info{title=Примітка}
Зазвичай вузол «Обчислення JSON» створюється під іншими вузлами даних для їхнього аналізу.
:::

## Конфігурація вузла

### Механізм аналізу

Вузол «Обчислення JSON» підтримує різні синтаксиси за допомогою різних механізмів аналізу. Ви можете обрати той, що відповідає вашим уподобанням та особливостям кожного механізму. Наразі підтримуються три механізми аналізу:

- [JMESPath](https://jmespath.org/)
- [JSONPath Plus](https://jsonpath-plus.github.io/JSONPath/docs/ts/)
- [JSONata](https://jsonata.org/)

![Вибір механізму](https://static-docs.nocobase.com/29be3b92a62b7d20312d1673e749f2ec.png)

### Джерело даних

Джерелом даних може бути результат попереднього вузла або об'єкт даних у контексті робочого процесу. Зазвичай це об'єкт даних без вбудованої структури, наприклад, результат вузла SQL або вузла HTTP-запиту.

![Джерело даних](https://static-docs.nocobase.com/f5a97e20693b3d30b3a994a576aa282d.png)

:::info{title=Примітка}
Зазвичай об'єкти даних вузлів, пов'язаних з колекціями, вже структуровані за допомогою конфігурації колекції і, як правило, не потребують аналізу за допомогою вузла «Обчислення JSON».
:::

### Вираз для аналізу

Налаштуйте вираз для аналізу відповідно до ваших потреб та обраного механізму аналізу.

![Вираз для аналізу](https://static-docs.nocobase.com/181abd162fd32c09b62f6aa1d1cb3ed4.png)

:::info{title=Примітка}
Різні механізми надають різний синтаксис аналізу. Для отримання детальної інформації зверніться до документації за посиланнями.
:::

Починаючи з версії `v1.0.0-alpha.15`, вирази підтримують використання змінних. Змінні попередньо аналізуються перед виконанням конкретним механізмом, замінюючи їх на конкретні рядкові значення відповідно до правил строкових шаблонів, і об'єднуються з іншими статичними рядками у виразі для формування кінцевого виразу. Ця функція дуже корисна, коли вам потрібно динамічно створювати вирази, наприклад, коли деякий JSON-вміст потребує динамічного ключа для аналізу.

### Мапування властивостей

Коли результатом обчислення є об'єкт (або масив об'єктів), ви можете за допомогою мапування властивостей додатково зіставити потрібні властивості з дочірніми змінними для використання наступними вузлами.

![Мапування властивостей](https://static-docs.nocobase.com/b876abe4ccf6b4709eb8748f21ef3527.png)

:::info{title=Примітка}
Для результату у вигляді об'єкта (або масиву об'єктів), якщо не виконати мапування властивостей, то весь об'єкт (або масив об'єктів) буде збережено як єдина змінна в результаті вузла, і значення властивостей об'єкта не можна буде використовувати безпосередньо як змінні.
:::

## Приклад

Припустімо, що дані для аналізу надходять від попереднього вузла SQL, який використовується для запиту даних, і його результатом є набір даних про замовлення:

```json
[
  {
    "id": 1,
    "products": [
      {
        "id": 1,
        "title": "Product 1",
        "price": 100,
        "quantity": 1
      },
      {
        "id": 2,
        "title": "Product 2",
        "price": 120,
        "quantity": 2
      }
    ]
  },
  {
    "id": 2,
    "products": [
      {
        "id": 3,
        "title": "Product 3",
        "price": 130,
        "quantity": 1
      },
      {
        "id": 4,
        "title": "Product 4",
        "price": 140,
        "quantity": 2
      }
    ]
  }
]
```

Якщо нам потрібно проаналізувати та обчислити загальну вартість двох замовлень у даних, і зібрати її разом з відповідними ідентифікаторами замовлень в об'єкт, щоб оновити загальну вартість замовлень, ми можемо налаштувати це наступним чином:

![Приклад - Конфігурація аналізу SQL](https://static-docs.nocobase.com/e62322a868b26ff98120bfcd6dcdb3bd.png)

1. Виберіть механізм аналізу JSONata;
2. Виберіть результат вузла SQL як джерело даних;
3. Використайте вираз JSONata `$[0].{"id": id, "total": products.(price * quantity)}` для аналізу;
4. Виберіть мапування властивостей, щоб зіставити `id` та `total` з дочірніми змінними;

Кінцевий результат аналізу виглядає так:

```json
[
  {
    "id": 1,
    "total": 340
  },
  {
    "id": 2,
    "total": 410
  }
]
```

Потім пройдіться циклом по отриманому масиву замовлень і оновіть загальну вартість замовлень.

![Оновлення загальної вартості відповідного замовлення](https://static-docs.nocobase.com/b3329b0efe4471f5eed1f0673bef740e.png)