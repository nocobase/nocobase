---
pkg: '@nocobase/plugin-workflow-sql'
---
:::tip Повідомлення про переклад ШІ
Ця документація була автоматично перекладена штучним інтелектом.
:::

# SQL Операція

## Вступ

У деяких особливих сценаріях прості вузли для роботи з колекціями, описані вище, можуть не впоратися зі складними операціями. У таких випадках ви можете безпосередньо використовувати вузол SQL, щоб база даних виконувала складні SQL-запити для маніпуляції даними.

Відмінність від прямого підключення до бази даних для SQL-операцій поза застосунком полягає в тому, що всередині робочого процесу ви можете використовувати змінні з контексту процесу як параметри в SQL-запиті.

## Встановлення

Вбудований плагін, встановлення не потрібне.

## Створення вузла

В інтерфейсі конфігурації робочого процесу натисніть кнопку плюса («+») у потоці, щоб додати вузол «SQL Операція»:

![SQL Операція_додати](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

## Конфігурація вузла

![SQL Вузол_Конфігурація вузла](https://static-docs.nocobase.com/20240904002334.png)

### Джерело даних

Виберіть джерело даних для виконання SQL-запиту.

Джерело даних має бути типу бази даних, наприклад, основне джерело даних, PostgreSQL або інші джерела даних, сумісні з Sequelize.

### SQL Вміст

Редагуйте SQL-запит. Наразі підтримується лише один SQL-запит.

Вставте потрібні змінні за допомогою кнопки змінних у верхньому правому куті редактора. Перед виконанням ці змінні будуть замінені на відповідні значення шляхом текстової підстановки. Отриманий текст потім буде використаний як остаточний SQL-запит і відправлений до бази даних для виконання.

## Результат виконання вузла

Починаючи з версії `v1.3.15-beta`, результатом виконання SQL-вузла є масив, що складається з чистих даних. До цього це була нативна структура повернення Sequelize, яка містила метаінформацію запиту (див.: [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query)).

Наприклад, наступний запит:

```sql
select count(id) from posts;
```

Результат до `v1.3.15-beta`:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

Результат після `v1.3.15-beta`:

```json
[
    { "count": 1 }
]
```

## Часті запитання

### Як використовувати результат SQL-вузла?

Якщо використовується оператор `SELECT`, результат запиту буде збережено у вузлі у форматі JSON Sequelize. Його можна розібрати та використовувати за допомогою плагіна [JSON-query](./json-query.md).

### Чи запускає SQL-операція події колекції?

**Ні**. SQL-операція надсилає SQL-запит безпосередньо до бази даних для обробки. Пов'язані операції `CREATE` / `UPDATE` / `DELETE` відбуваються в базі даних, тоді як події колекції відбуваються на рівні застосунку Node.js (обробляються ORM), тому події колекції не будуть запускатися.