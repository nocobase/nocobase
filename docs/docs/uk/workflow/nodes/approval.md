---
pkg: '@nocobase/plugin-workflow-approval'
---
:::tip Повідомлення про переклад ШІ
Ця документація була автоматично перекладена штучним інтелектом.
:::

# Схвалення

## Вступ

У робочому процесі схвалення потрібно використовувати спеціальний вузол «Схвалення», щоб налаштувати логіку операцій для осіб, які затверджують (схвалюють, відхиляють або повертають) ініційоване схвалення. Вузол «Схвалення» можна використовувати лише в процесах схвалення.

:::info{title=Підказка}
Відмінність від звичайного вузла «Ручна обробка»: звичайний вузол «Ручна обробка» призначений для більш загальних сценаріїв, таких як ручне введення даних або ручне прийняття рішень щодо продовження процесу в різних типах робочих процесів. Вузол «Схвалення» — це спеціалізований вузол обробки, призначений виключно для процесів схвалення. Він обробляє лише дані ініційованого схвалення і не може використовуватися в інших робочих процесах.
:::

## Створення вузла

Натисніть кнопку плюса («+») у робочому процесі, додайте вузол «Схвалення», а потім виберіть один із режимів проходження, щоб створити вузол схвалення:

![Створення вузла схвалення](https://static-docs.nocobase.com/20251107000938.png)

## Конфігурація вузла

### Режим проходження

Існує два режими проходження:

1.  **Наскрізний режим**: Зазвичай використовується для простіших процесів. Чи проходить вузол схвалення, чи ні, лише визначає, чи завершується процес. Якщо він не проходить, процес негайно завершується.

    ![Режим проходження - Наскрізний](https://static-docs.nocobase.com/20251107001043.png)

2.  **Режим розгалуження**: Зазвичай використовується для складнішої логіки даних. Після того, як вузол схвалення видає будь-який результат, інші вузли можуть продовжувати виконуватися в його гілці результатів.

    ![Режим проходження - Розгалуження](https://static-docs.nocobase.com/20251107001234.png)

    Після «Схвалення» цього вузла, окрім виконання гілки схвалення, також продовжуватиметься подальший робочий процес. Після дії «Відхилити» подальший робочий процес також може продовжуватися за замовчуванням, або ви можете налаштувати вузол на завершення процесу після виконання гілки.

:::info{title=Підказка}
Режим проходження не можна змінити після створення вузла.
:::

### Особа, яка затверджує

Особа, яка затверджує, — це набір користувачів, відповідальних за дію схвалення цього вузла. Це може бути один або кілька користувачів. Джерелом вибору може бути статичне значення, вибране зі списку користувачів, або динамічне значення, вказане змінною:

![Конфігурація особи, яка затверджує](https://static-docs.nocobase.com/20251107001433.png)

При виборі змінної ви можете вибрати лише первинний або зовнішній ключ даних користувача з контексту та результатів вузла. Якщо вибрана змінна під час виконання є масивом (відношення «багато до багатьох»), кожен користувач у масиві буде об'єднаний у весь набір осіб, які затверджують.

Окрім прямого вибору користувачів або змінних, ви також можете динамічно фільтрувати користувачів, які відповідають умовам, на основі умов запиту таблиці користувачів, щоб призначити їх як осіб, які затверджують:

![Динамічний вибір осіб, які затверджують](https://static-docs.nocobase.com/20251107001703.png)

### Режим погодження

Якщо під час остаточного виконання є лише одна особа, яка затверджує (включно з випадками після дедуплікації кількох змінних), то незалежно від обраного режиму погодження, лише цей користувач виконуватиме операцію схвалення, і результат також визначатиметься лише цим користувачем.

Коли в наборі осіб, які затверджують, є кілька користувачів, вибір різних режимів погодження представляє різні способи обробки:

1.  **Будь-хто**: Достатньо, щоб одна особа схвалила, щоб вузол вважався схваленим. Вузол відхиляється лише тоді, коли всі відхиляють.
2.  **Колективне підписання**: Потрібно, щоб усі схвалили, щоб вузол вважався схваленим. Достатньо, щоб одна особа відхилила, щоб вузол вважався відхиленим.
3.  **Голосування**: Кількість осіб, які схвалили, повинна перевищувати встановлену пропорцію, щоб вузол вважався схваленим; інакше вузол відхиляється.

Щодо операції повернення, у будь-якому режимі, якщо будь-який користувач у наборі осіб, які затверджують, обробляє її як повернення, вузол негайно вийде з процесу.

### Порядок обробки

Так само, коли в наборі осіб, які затверджують, є кілька користувачів, вибір різних порядків обробки представляє різні способи обробки:

1.  **Паралельно**: Усі особи, які затверджують, можуть обробляти в будь-якому порядку; послідовність обробки не має значення.
2.  **Послідовно**: Особи, які затверджують, обробляють послідовно відповідно до порядку в наборі осіб, які затверджують. Наступна особа може обробляти лише після того, як попередня подала.

Незалежно від того, чи встановлено «Послідовну» обробку, результат, отриманий відповідно до фактичного порядку обробки, також відповідатиме правилам, зазначеним у «Режимі погодження». Вузол завершує своє виконання, як тільки будуть виконані відповідні умови.

### Вихід з робочого процесу після завершення гілки відхилення

Коли «Режим проходження» встановлено на «Режим розгалуження», ви можете вибрати вихід з робочого процесу після завершення гілки відхилення. Після встановлення цього прапорця в кінці гілки відхилення відображатиметься «✗», що вказує на те, що подальші вузли не продовжуватимуться після завершення цієї гілки:

![Вихід після відхилення](https://static-docs.nocobase.com/20251107001839.png)

### Конфігурація інтерфейсу особи, яка затверджує

Конфігурація інтерфейсу особи, яка затверджує, використовується для надання інтерфейсу операцій для особи, яка затверджує, коли робочий процес схвалення досягає цього вузла. Натисніть кнопку конфігурації, щоб відкрити спливаюче вікно:

![Спливаюче вікно конфігурації інтерфейсу особи, яка затверджує](https://static-docs.nocobase.com/20251107001958.png)

У спливаючому вікні конфігурації ви можете додати блоки, такі як оригінальний вміст подання, інформація про схвалення, форма обробки та власний текст підказки:

![Додавання блоків до інтерфейсу особи, яка затверджує](https://static-docs.nocobase.com/20251107002604.png)

#### Оригінальний вміст подання

Блок деталей вмісту схвалення — це блок даних, поданий ініціатором. Подібно до звичайного блоку даних, ви можете довільно додавати компоненти полів з колекції та довільно їх розташовувати, щоб організувати вміст, який потрібно переглянути особі, яка затверджує:

![Конфігурація блоку деталей](https://static-docs.nocobase.com/20251107002925.png)

#### Форма обробки

У блоці форми дій ви можете додати кнопки дій, які підтримує цей вузол, включаючи «Схвалити», «Відхилити», «Повернути», «Перепризначити» та «Додати підписанта»:

![Блок форми дій](https://static-docs.nocobase.com/20251107003015.png)

Крім того, до форми дій можна додати поля, які можуть бути змінені особою, яка затверджує. Ці поля відображатимуться у формі дій, коли особа, яка затверджує, обробляє схвалення. Особа, яка затверджує, може змінювати значення цих полів, і після подання одночасно оновлюватимуться як дані для схвалення, так і знімок відповідних даних у процесі схвалення.

![Зміна полів вмісту схвалення](https://static-docs.nocobase.com/20251107003206.png)

#### «Схвалити» та «Відхилити»

Серед кнопок дій схвалення, «Схвалити» та «Відхилити» є вирішальними діями. Після подання обробка цього вузла особою, яка затверджує, завершується. Додаткові поля, які потрібно заповнити під час подання, такі як «Коментар», можна додати у спливаючому вікні «Конфігурація обробки» для кнопки дії.

![Конфігурація обробки](https://static-docs.nocobase.com/20251107003314.png)

#### «Повернути»

«Повернути» також є вирішальною операцією. Окрім налаштування коментарів, ви також можете налаштувати вузли, до яких можна повернути:

![Налаштування повернення](https://static-docs.nocobase.com/20251107003555.png)

#### «Перепризначити» та «Додати підписанта»

«Перепризначити» та «Додати підписанта» — це невирішальні дії, які використовуються для динамічного коригування осіб, які затверджують, у процесі схвалення. «Перепризначити» означає передачу завдання схвалення поточного користувача іншому користувачеві для обробки. «Додати підписанта» означає додавання особи, яка затверджує, до або після поточного затверджувача, і новододана особа продовжуватиме схвалення разом.

Після ввімкнення кнопок дій «Перепризначити» або «Додати підписанта» вам потрібно вибрати «Область призначення» в меню конфігурації кнопки, щоб встановити діапазон користувачів, яким можна призначити нових осіб, які затверджують:

![Область призначення](https://static-docs.nocobase.com/20241226232321.png)

Як і в оригінальній конфігурації осіб, які затверджують, для вузла, область призначення також може бути безпосередньо вибраними особами, які затверджують, або базуватися на умовах запиту колекції користувачів. Вона зрештою буде об'єднана в один набір і не включатиме користувачів, які вже є в наборі осіб, які затверджують.

:::warning{title=Важливо}
Якщо кнопку дії ввімкнено або вимкнено, або змінено область призначення, ви повинні зберегти конфігурацію вузла після закриття спливаючого вікна конфігурації інтерфейсу дії. В іншому випадку зміни кнопки дії не набудуть чинності.
:::

## Результат вузла

Після завершення схвалення відповідний статус і дані будуть записані в результат вузла та можуть використовуватися як змінні наступними вузлами.

![Результат вузла](https://static-docs.nocobase.com/20250614095052.png)

### Статус схвалення вузла

Представляє статус обробки поточного вузла схвалення. Результатом є перелічуване значення.

### Дані після схвалення

Якщо особа, яка затверджує, змінює вміст схвалення у формі дій, змінені дані будуть записані в результат вузла для використання наступними вузлами. Щоб використовувати поля зв'язків, вам потрібно налаштувати попереднє завантаження для полів зв'язків у тригері.

### Записи схвалення

> v1.8.0+

Запис обробки схвалення — це масив, який містить записи обробки всіх осіб, які затверджують, у цьому вузлі. Кожен запис обробки включає такі поля:

| Поле | Тип | Опис |
| --- | --- | --- |
| `id` | `number` | Унікальний ідентифікатор запису обробки |
| `userId` | `number` | ID користувача, який обробив цей запис |
| `status` | `number` | Статус обробки |
| `comment` | `string` | Коментар під час обробки |
| `updatedAt` | `string` | Час оновлення запису обробки |

Ви можете використовувати ці поля як змінні в наступних вузлах за потреби.